{
  "version": 3,
  "sources": ["../node_modules/.pnpm/uri-templates@0.2.0/node_modules/uri-templates/uri-templates.js", "../lib/factories/octironFactory.ts", "../lib/utils/isJSONObject.ts", "../lib/utils/unravelArgs.ts", "../lib/renderers/SelectionRenderer.ts", "../lib/factories/selectionFactory.ts", "../lib/utils/mithrilRedraw.ts", "../lib/consts.ts", "../lib/renderers/PresentRenderer.ts", "../lib/utils/getComponent.ts", "../lib/utils/isTypedObject.ts", "../lib/utils/getValueType.ts", "../lib/utils/selectComponentFromArgs.ts", "../lib/utils/isIterable.ts", "../lib/utils/getIterableValue.ts", "../lib/factories/actionFactory.ts", "../node_modules/.pnpm/json-ptr@3.1.1/node_modules/json-ptr/src/util.ts", "../node_modules/.pnpm/json-ptr@3.1.1/node_modules/json-ptr/src/pointer.ts", "../lib/renderers/ActionStateRenderer.ts", "../lib/utils/getSubmitDetails.ts", "../lib/factories/actionSelectionFactory.ts", "../lib/renderers/EditRenderer.ts", "../lib/utils/expandValue.ts", "../lib/utils/escapeJSONPointerParts.ts", "../lib/utils/isIRIObject.ts", "../lib/utils/isMetadataObject.ts", "../lib/utils/isValueObject.ts", "../lib/utils/parseSelectorString.ts", "../lib/utils/resolvePropertyValueSpecification.ts", "../lib/utils/getSelection.ts", "../lib/renderers/ActionSelectionRenderer.ts", "../lib/renderers/PerformRenderer.ts", "../lib/factories/rootFactory.ts", "../lib/alternatives/htmlFragments.ts", "../lib/failures.ts", "../lib/utils/flattenIRIObjects.ts", "../lib/store.ts", "../lib/utils/makeTypeDefs.ts", "../lib/utils/classes.ts", "../lib/utils/makeTypeDef.ts", "../lib/handlers/jsonLDHandler.ts", "../lib/handlers/longformHandler.ts", "../lib/components/OctironJSON.ts", "../lib/components/OctironDebug.ts", "../lib/components/OctironExplorer.ts", "../lib/components/OctironForm.ts", "../lib/components/OctironSubmitButton.ts", "../lib/octiron.ts"],
  "sourcesContent": ["(function (global, factory) {\n\tif (typeof define === 'function' && define.amd) {\n\t\tdefine('uri-templates', [], factory);\n\t} else if (typeof module !== 'undefined' && module.exports){\n\t\tmodule.exports = factory();\n\t} else {\n\t\tglobal.UriTemplate = factory();\n\t}\n})(this, function () {\n\tvar uriTemplateGlobalModifiers = {\n\t\t\"+\": true,\n\t\t\"#\": true,\n\t\t\".\": true,\n\t\t\"/\": true,\n\t\t\";\": true,\n\t\t\"?\": true,\n\t\t\"&\": true\n\t};\n\tvar uriTemplateSuffices = {\n\t\t\"*\": true\n\t};\n\tvar urlEscapedChars = /[:/&?#]/;\n\n\tfunction notReallyPercentEncode(string) {\n\t\treturn encodeURI(string).replace(/%25[0-9][0-9]/g, function (doubleEncoded) {\n\t\t\treturn \"%\" + doubleEncoded.substring(3);\n\t\t});\n\t}\n\n\tfunction isPercentEncoded(string) {\n\t\tstring = string.replace(/%../g, '');\n\t\treturn encodeURIComponent(string) === string;\n\t}\n\n\tfunction uriTemplateSubstitution(spec) {\n\t\tvar modifier = \"\";\n\t\tif (uriTemplateGlobalModifiers[spec.charAt(0)]) {\n\t\t\tmodifier = spec.charAt(0);\n\t\t\tspec = spec.substring(1);\n\t\t}\n\t\tvar separator = \"\";\n\t\tvar prefix = \"\";\n\t\tvar shouldEscape = true;\n\t\tvar showVariables = false;\n\t\tvar trimEmptyString = false;\n\t\tif (modifier == '+') {\n\t\t\tshouldEscape = false;\n\t\t} else if (modifier == \".\") {\n\t\t\tprefix = \".\";\n\t\t\tseparator = \".\";\n\t\t} else if (modifier == \"/\") {\n\t\t\tprefix = \"/\";\n\t\t\tseparator = \"/\";\n\t\t} else if (modifier == '#') {\n\t\t\tprefix = \"#\";\n\t\t\tshouldEscape = false;\n\t\t} else if (modifier == ';') {\n\t\t\tprefix = \";\";\n\t\t\tseparator = \";\",\n\t\t\tshowVariables = true;\n\t\t\ttrimEmptyString = true;\n\t\t} else if (modifier == '?') {\n\t\t\tprefix = \"?\";\n\t\t\tseparator = \"&\",\n\t\t\tshowVariables = true;\n\t\t} else if (modifier == '&') {\n\t\t\tprefix = \"&\";\n\t\t\tseparator = \"&\",\n\t\t\tshowVariables = true;\n\t\t}\n\n\t\tvar varNames = [];\n\t\tvar varList = spec.split(\",\");\n\t\tvar varSpecs = [];\n\t\tvar varSpecMap = {};\n\t\tfor (var i = 0; i < varList.length; i++) {\n\t\t\tvar varName = varList[i];\n\t\t\tvar truncate = null;\n\t\t\tif (varName.indexOf(\":\") != -1) {\n\t\t\t\tvar parts = varName.split(\":\");\n\t\t\t\tvarName = parts[0];\n\t\t\t\ttruncate = parseInt(parts[1]);\n\t\t\t}\n\t\t\tvar suffices = {};\n\t\t\twhile (uriTemplateSuffices[varName.charAt(varName.length - 1)]) {\n\t\t\t\tsuffices[varName.charAt(varName.length - 1)] = true;\n\t\t\t\tvarName = varName.substring(0, varName.length - 1);\n\t\t\t}\n\t\t\tvar varSpec = {\n\t\t\t\ttruncate: truncate,\n\t\t\t\tname: varName,\n\t\t\t\tsuffices: suffices\n\t\t\t};\n\t\t\tvarSpecs.push(varSpec);\n\t\t\tvarSpecMap[varName] = varSpec;\n\t\t\tvarNames.push(varName);\n\t\t}\n\t\tvar subFunction = function (valueFunction) {\n\t\t\tvar result = \"\";\n\t\t\tvar startIndex = 0;\n\t\t\tfor (var i = 0; i < varSpecs.length; i++) {\n\t\t\t\tvar varSpec = varSpecs[i];\n\t\t\t\tvar value = valueFunction(varSpec.name);\n\t\t\t\tif (value == null || (Array.isArray(value) && value.length == 0) || (typeof value == 'object' && Object.keys(value).length == 0)) {\n\t\t\t\t\tstartIndex++;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (i == startIndex) {\n\t\t\t\t\tresult += prefix;\n\t\t\t\t} else {\n\t\t\t\t\tresult += (separator || \",\");\n\t\t\t\t}\n\t\t\t\tif (Array.isArray(value)) {\n\t\t\t\t\tif (showVariables) {\n\t\t\t\t\t\tresult += varSpec.name + \"=\";\n\t\t\t\t\t}\n\t\t\t\t\tfor (var j = 0; j < value.length; j++) {\n\t\t\t\t\t\tif (j > 0) {\n\t\t\t\t\t\t\tresult += varSpec.suffices['*'] ? (separator || \",\") : \",\";\n\t\t\t\t\t\t\tif (varSpec.suffices['*'] && showVariables) {\n\t\t\t\t\t\t\t\tresult += varSpec.name + \"=\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresult += shouldEscape ? encodeURIComponent(value[j]).replace(/!/g, \"%21\") : notReallyPercentEncode(value[j]);\n\t\t\t\t\t}\n\t\t\t\t} else if (typeof value == \"object\") {\n\t\t\t\t\tif (showVariables && !varSpec.suffices['*']) {\n\t\t\t\t\t\tresult += varSpec.name + \"=\";\n\t\t\t\t\t}\n\t\t\t\t\tvar first = true;\n\t\t\t\t\tfor (var key in value) {\n\t\t\t\t\t\tif (!first) {\n\t\t\t\t\t\t\tresult += varSpec.suffices['*'] ? (separator || \",\") : \",\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfirst = false;\n\t\t\t\t\t\tresult += shouldEscape ? encodeURIComponent(key).replace(/!/g, \"%21\") : notReallyPercentEncode(key);\n\t\t\t\t\t\tresult += varSpec.suffices['*'] ? '=' : \",\";\n\t\t\t\t\t\tresult += shouldEscape ? encodeURIComponent(value[key]).replace(/!/g, \"%21\") : notReallyPercentEncode(value[key]);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (showVariables) {\n\t\t\t\t\t\tresult += varSpec.name;\n\t\t\t\t\t\tif (!trimEmptyString || value != \"\") {\n\t\t\t\t\t\t\tresult += \"=\";\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (varSpec.truncate != null) {\n\t\t\t\t\t\tvalue = value.substring(0, varSpec.truncate);\n\t\t\t\t\t}\n\t\t\t\t\tresult += shouldEscape ? encodeURIComponent(value).replace(/!/g, \"%21\"): notReallyPercentEncode(value);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn result;\n\t\t};\n\t\tvar guessFunction = function (stringValue, resultObj, strict) {\n\t\t\tif (prefix) {\n\t\t\t\tstringValue = stringValue.substring(prefix.length);\n\t\t\t}\n\t\t\tif (varSpecs.length == 1 && varSpecs[0].suffices['*']) {\n\t\t\t\tvar varSpec = varSpecs[0];\n\t\t\t\tvar varName = varSpec.name;\n\t\t\t\tvar arrayValue = varSpec.suffices['*'] ? stringValue.split(separator || \",\") : [stringValue];\n\t\t\t\tvar hasEquals = (shouldEscape && stringValue.indexOf('=') != -1);\t// There's otherwise no way to distinguish between \"{value*}\" for arrays and objects\n\t\t\t\tfor (var i = 1; i < arrayValue.length; i++) {\n\t\t\t\t\tvar stringValue = arrayValue[i];\n\t\t\t\t\tif (hasEquals && stringValue.indexOf('=') == -1) {\n\t\t\t\t\t\t// Bit of a hack - if we're expecting \"=\" for key/value pairs, and values can't contain \"=\", then assume a value has been accidentally split\n\t\t\t\t\t\tarrayValue[i - 1] += (separator || \",\") + stringValue;\n\t\t\t\t\t\tarrayValue.splice(i, 1);\n\t\t\t\t\t\ti--;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (var i = 0; i < arrayValue.length; i++) {\n\t\t\t\t\tvar stringValue = arrayValue[i];\n\t\t\t\t\tif (shouldEscape && stringValue.indexOf('=') != -1) {\n\t\t\t\t\t\thasEquals = true;\n\t\t\t\t\t}\n\t\t\t\t\tvar innerArrayValue = stringValue.split(\",\");\n\t\t\t\t\tif (innerArrayValue.length == 1) {\n\t\t\t\t\t\tarrayValue[i] = innerArrayValue[0];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tarrayValue[i] = innerArrayValue;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (showVariables || hasEquals) {\n\t\t\t\t\tvar objectValue = resultObj[varName] || {};\n\t\t\t\t\tfor (var j = 0; j < arrayValue.length; j++) {\n\t\t\t\t\t\tvar innerValue = stringValue;\n\t\t\t\t\t\tif (showVariables && !innerValue) {\n\t\t\t\t\t\t\t// The empty string isn't a valid variable, so if our value is zero-length we have nothing\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (typeof arrayValue[j] == \"string\") {\n\t\t\t\t\t\t\tvar stringValue = arrayValue[j];\n\t\t\t\t\t\t\tvar innerVarName = stringValue.split(\"=\", 1)[0];\n\t\t\t\t\t\t\tvar stringValue = stringValue.substring(innerVarName.length + 1);\n\t\t\t\t\t\t\tif (shouldEscape) {\n\t\t\t\t\t\t\t\tif (strict && !isPercentEncoded(stringValue)) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tstringValue = decodeURIComponent(stringValue);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tinnerValue = stringValue;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar stringValue = arrayValue[j][0];\n\t\t\t\t\t\t\tvar innerVarName = stringValue.split(\"=\", 1)[0];\n\t\t\t\t\t\t\tvar stringValue = stringValue.substring(innerVarName.length + 1);\n\t\t\t\t\t\t\tif (shouldEscape) {\n\t\t\t\t\t\t\t\tif (strict && !isPercentEncoded(stringValue)) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tstringValue = decodeURIComponent(stringValue);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tarrayValue[j][0] = stringValue;\n\t\t\t\t\t\t\tinnerValue = arrayValue[j];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (shouldEscape) {\n\t\t\t\t\t\t\tif (strict && !isPercentEncoded(innerVarName)) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tinnerVarName = decodeURIComponent(innerVarName);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (objectValue[innerVarName] !== undefined) {\n\t\t\t\t\t\t\tif (Array.isArray(objectValue[innerVarName])) {\n\t\t\t\t\t\t\t\tobjectValue[innerVarName].push(innerValue);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tobjectValue[innerVarName] = [objectValue[innerVarName], innerValue];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tobjectValue[innerVarName] = innerValue;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (Object.keys(objectValue).length == 1 && objectValue[varName] !== undefined) {\n\t\t\t\t\t\tresultObj[varName] = objectValue[varName];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresultObj[varName] = objectValue;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (shouldEscape) {\n\t\t\t\t\t\tfor (var j = 0; j < arrayValue.length; j++) {\n\t\t\t\t\t\t\tvar innerArrayValue = arrayValue[j];\n\t\t\t\t\t\t\tif (Array.isArray(innerArrayValue)) {\n\t\t\t\t\t\t\t\tfor (var k = 0; k < innerArrayValue.length; k++) {\n\t\t\t\t\t\t\t\t\tif (strict && !isPercentEncoded(innerArrayValue[k])) {\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tinnerArrayValue[k] = decodeURIComponent(innerArrayValue[k]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (strict && !isPercentEncoded(innerArrayValue)) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tarrayValue[j] = decodeURIComponent(innerArrayValue);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (resultObj[varName] !== undefined) {\n\t\t\t\t\t\tif (Array.isArray(resultObj[varName])) {\n\t\t\t\t\t\t\tresultObj[varName] = resultObj[varName].concat(arrayValue);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresultObj[varName] = [resultObj[varName]].concat(arrayValue);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (arrayValue.length == 1 && !varSpec.suffices['*']) {\n\t\t\t\t\t\t\tresultObj[varName] = arrayValue[0];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresultObj[varName] = arrayValue;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tvar arrayValue = (varSpecs.length == 1) ? [stringValue] : stringValue.split(separator || \",\");\n\t\t\t\tvar specIndexMap = {};\n\t\t\t\tfor (var i = 0; i < arrayValue.length; i++) {\n\t\t\t\t\t// Try from beginning\n\t\t\t\t\tvar firstStarred = 0;\n\t\t\t\t\tfor (; firstStarred < varSpecs.length - 1 && firstStarred < i; firstStarred++) {\n\t\t\t\t\t\tif (varSpecs[firstStarred].suffices['*']) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (firstStarred == i) {\n\t\t\t\t\t\t// The first [i] of them have no \"*\" suffix\n\t\t\t\t\t\tspecIndexMap[i] = i;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Try from the end\n\t\t\t\t\t\tfor (var lastStarred = varSpecs.length - 1; lastStarred > 0 && (varSpecs.length - lastStarred) < (arrayValue.length - i); lastStarred--) {\n\t\t\t\t\t\t\tif (varSpecs[lastStarred].suffices['*']) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ((varSpecs.length - lastStarred) == (arrayValue.length - i)) {\n\t\t\t\t\t\t\t// The last [length - i] of them have no \"*\" suffix\n\t\t\t\t\t\t\tspecIndexMap[i] = lastStarred;\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// Just give up and use the first one\n\t\t\t\t\tspecIndexMap[i] = firstStarred;\n\t\t\t\t}\n\t\t\t\tfor (var i = 0; i < arrayValue.length; i++) {\n\t\t\t\t\tvar stringValue = arrayValue[i];\n\t\t\t\t\tif (!stringValue && showVariables) {\n\t\t\t\t\t\t// The empty string isn't a valid variable, so if our value is zero-length we have nothing\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tvar innerArrayValue = stringValue.split(\",\");\n\t\t\t\t\tvar hasEquals = false;\n\n\t\t\t\t\tif (showVariables) {\n\t\t\t\t\t\tvar stringValue = innerArrayValue[0]; // using innerArrayValue\n\t\t\t\t\t\tvar varName = stringValue.split(\"=\", 1)[0];\n\t\t\t\t\t\tvar stringValue = stringValue.substring(varName.length + 1);\n\t\t\t\t\t\tinnerArrayValue[0] = stringValue;\n\t\t\t\t\t\tvar varSpec = varSpecMap[varName] || varSpecs[0];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar varSpec = varSpecs[specIndexMap[i]];\n\t\t\t\t\t\tvar varName = varSpec.name;\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (var j = 0; j < innerArrayValue.length; j++) {\n\t\t\t\t\t\tif (shouldEscape) {\n\t\t\t\t\t\t\tif (strict && !isPercentEncoded(innerArrayValue[j])) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tinnerArrayValue[j] = decodeURIComponent(innerArrayValue[j]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif ((showVariables || varSpec.suffices['*'])&& resultObj[varName] !== undefined) {\n\t\t\t\t\t\tif (Array.isArray(resultObj[varName])) {\n\t\t\t\t\t\t\tresultObj[varName] = resultObj[varName].concat(innerArrayValue);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresultObj[varName] = [resultObj[varName]].concat(innerArrayValue);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (innerArrayValue.length == 1 && !varSpec.suffices['*']) {\n\t\t\t\t\t\t\tresultObj[varName] = innerArrayValue[0];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresultObj[varName] = innerArrayValue;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn 1;\n\t\t};\n\t\treturn {\n\t\t\tvarNames: varNames,\n\t\t\tprefix: prefix,\n\t\t\tsubstitution: subFunction,\n\t\t\tunSubstitution: guessFunction\n\t\t};\n\t}\n\n\tfunction UriTemplate(template) {\n\t\tif (!(this instanceof UriTemplate)) {\n\t\t\treturn new UriTemplate(template);\n\t\t}\n\t\tvar parts = template.split(\"{\");\n\t\tvar textParts = [parts.shift()];\n\t\tvar prefixes = [];\n\t\tvar substitutions = [];\n\t\tvar unSubstitutions = [];\n\t\tvar varNames = [];\n\t\twhile (parts.length > 0) {\n\t\t\tvar part = parts.shift();\n\t\t\tvar spec = part.split(\"}\")[0];\n\t\t\tvar remainder = part.substring(spec.length + 1);\n\t\t\tvar funcs = uriTemplateSubstitution(spec);\n\t\t\tsubstitutions.push(funcs.substitution);\n\t\t\tunSubstitutions.push(funcs.unSubstitution);\n\t\t\tprefixes.push(funcs.prefix);\n\t\t\ttextParts.push(remainder);\n\t\t\tvarNames = varNames.concat(funcs.varNames);\n\t\t}\n\t\tthis.fill = function (valueFunction) {\n\t\t\tif (valueFunction && typeof valueFunction !== 'function') {\n\t\t\t\tvar value = valueFunction;\n\t\t\t\tvalueFunction = function (varName) {\n\t\t\t\t\treturn value[varName];\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tvar result = textParts[0];\n\t\t\tfor (var i = 0; i < substitutions.length; i++) {\n\t\t\t\tvar substitution = substitutions[i];\n\t\t\t\tresult += substitution(valueFunction);\n\t\t\t\tresult += textParts[i + 1];\n\t\t\t}\n\t\t\treturn result;\n\t\t};\n\t\tthis.fromUri = function (substituted, options) {\n\t\t\toptions = options || {};\n\t\t\tvar result = {};\n\t\t\tfor (var i = 0; i < textParts.length; i++) {\n\t\t\t\tvar part = textParts[i];\n\t\t\t\tif (substituted.substring(0, part.length) !== part) {\n\t\t\t\t\treturn /*undefined*/;\n\t\t\t\t}\n\t\t\t\tsubstituted = substituted.substring(part.length);\n\t\t\t\tif (i >= textParts.length - 1) {\n\t\t\t\t\t// We've run out of input - is there any template left?\n\t\t\t\t\tif (substituted == \"\") {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn /*undefined*/;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tvar prefix = prefixes[i];\n\t\t\t\tif (prefix && substituted.substring(0, prefix.length) !== prefix) {\n\t\t\t\t\t// All values are optional - if we have a prefix and it doesn't match, move along\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Find the next part to un-substitute\n\t\t\t\tvar nextPart = textParts[i + 1];\n\t\t\t\tvar offset = i;\n\t\t\t\twhile (true) {\n\t\t\t\t\tif (offset == textParts.length - 2) {\n\t\t\t\t\t\tvar endPart = substituted.substring(substituted.length - nextPart.length);\n\t\t\t\t\t\tif (endPart !== nextPart) {\n\t\t\t\t\t\t\treturn /*undefined*/;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar stringValue = substituted.substring(0, substituted.length - nextPart.length);\n\t\t\t\t\t\tsubstituted = endPart;\n\t\t\t\t\t} else if (nextPart) {\n\t\t\t\t\t\tvar nextPartPos = substituted.indexOf(nextPart);\n\t\t\t\t\t\tvar stringValue = substituted.substring(0, nextPartPos);\n\t\t\t\t\t\tsubstituted = substituted.substring(nextPartPos);\n\t\t\t\t\t} else if (prefixes[offset + 1]) {\n\t\t\t\t\t\tvar nextPartPos = substituted.indexOf(prefixes[offset + 1]);\n\t\t\t\t\t\tif (nextPartPos === -1) nextPartPos = substituted.length;\n\t\t\t\t\t\tvar stringValue = substituted.substring(0, nextPartPos);\n\t\t\t\t\t\tsubstituted = substituted.substring(nextPartPos);\n\t\t\t\t\t} else if (textParts.length > offset + 2) {\n\t\t\t\t\t\t// If the separator between this variable and the next is blank (with no prefix), continue onwards\n\t\t\t\t\t\toffset++;\n\t\t\t\t\t\tnextPart = textParts[offset + 1];\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar stringValue = substituted;\n\t\t\t\t\t\tsubstituted = \"\";\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (!unSubstitutions[i](stringValue, result, options.strict)) {\n\t\t\t\t\treturn /*undefined*/;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\t\tthis.varNames = varNames;\n\t\tthis.template = template;\n\t}\n\tUriTemplate.prototype = {\n\t\ttoString: function () {\n\t\t\treturn this.template;\n\t\t},\n\t\tfillFromObject: function (obj) {\n\t\t\treturn this.fill(obj);\n\t\t},\n\t\ttest: function (uri, options) {\n\t\t\treturn !!this.fromUri(uri, options)\n\t\t}\n\t};\n\n\treturn UriTemplate;\n});\n", "import m from 'mithril';\nimport type { Octiron } from \"../types/octiron.ts\";\nimport type { Mutable } from \"../types/common.ts\";\nimport type { ActionParentArgs, ActionSelectionParentArgs, AnyAttrs, AnyComponent, BaseAttrs, CommonParentArgs, CommonRendererArgs, EditAttrs, EditComponent, OctironAction, OctironActionSelection, OctironActionSelectionArgs, OctironDefaultArgs, OctironPerformArgs, OctironPresentArgs, OctironRoot, OctironSelectArgs, OctironSelection, PerformView, Predicate, PresentAttrs, PresentComponent, SelectionParentArgs, Selector, SelectView, TypeDefs } from \"../types/octiron.ts\";\nimport { isJSONObject } from \"../utils/isJSONObject.ts\";\nimport { unravelArgs } from \"../utils/unravelArgs.ts\";\nimport type { Store } from \"../store.ts\";\nimport { SelectionRenderer } from \"../renderers/SelectionRenderer.ts\";\nimport { PresentRenderer } from '../renderers/PresentRenderer.ts';\nimport { getDataType } from \"../utils/getValueType.ts\";\nimport { isIterable } from \"../utils/isIterable.ts\";\nimport { getIterableValue } from \"../utils/getIterableValue.ts\";\nimport { PerformRenderer } from \"../renderers/PerformRenderer.ts\";\nimport { isIRIObject } from \"../utils/isIRIObject.ts\";\n\nconst TypeKeys = {\n  'root': 0,\n  'selection': 1,\n  'action': 2,\n  'action-selection': 3,\n} as const;\n\nexport type CommonArgs = {\n  pre?: m.Children,\n  sep?: m.Children,\n  post?: m.Children,\n  start?: number,\n  end?: number,\n  predicate?: Predicate,\n  store?: Store,\n  typeDefs?: TypeDefs,\n  attrs?: PresentAttrs | EditAttrs | AnyAttrs,\n  component?: PresentComponent | EditComponent | AnyComponent,\n  fallbackComponent?: AnyComponent,\n};\n\nexport type ChildArgs =\n  & Partial<SelectionParentArgs>\n  & Partial<ActionParentArgs>\n  & Partial<ActionSelectionParentArgs>\n  & CommonParentArgs\n;\n\nexport type InstanceHooks = {\n  _updateArgs: (\n    type: 'args' | 'renderer' | 'parent',\n    args: OctironSelectArgs | OctironPerformArgs | OctironActionSelectionArgs,\n  ) => void;\n}\n\nexport function octironFactory(\n  octironType: 'root',\n  factoryArgs: CommonArgs,\n  parentArgs: CommonParentArgs,\n): Mutable<OctironRoot>;\n\nexport function octironFactory(\n  octironType: 'selection',\n  factoryArgs: CommonArgs,\n  parentArgs: CommonParentArgs,\n  rendererArgs: CommonRendererArgs,\n  childArgs: ChildArgs,\n): Mutable<OctironSelection & InstanceHooks>;\n\nexport function octironFactory(\n  octironType: 'action',\n  factoryArgs: CommonArgs,\n  parentArgs: CommonParentArgs,\n  rendererArgs: CommonRendererArgs,\n  childArgs: ChildArgs,\n): Mutable<OctironAction & InstanceHooks>;\n\nexport function octironFactory(\n  octironType: 'action-selection',\n  factoryArgs: CommonArgs,\n  parentArgs: CommonParentArgs,\n  rendererArgs: CommonRendererArgs,\n  childArgs: ChildArgs,\n): Mutable<OctironActionSelection & InstanceHooks>;\n\n/**\n * Creates the base Octiron instance.\n *\n * @param octironType - The Octiron instance type to create.\n * @param factoryArgs - User specified args passed to the Octiron method creating the factory.\n * @param parentArgs - Args passed from the Octiron parent instance of this instance.\n * @param rendererArgs - Args passed from the Mithril renderer component.\n * @param childArgs - Args to pass through to any child renderers, to be their parent args.\n */\nexport function octironFactory<O extends Octiron>(\n  octironType: 'root' | 'selection' | 'action' | 'action-selection',\n  factoryArgs: CommonArgs,\n  parentArgs: CommonParentArgs,\n  rendererArgs: CommonRendererArgs = {} as CommonRendererArgs,\n  childArgs: ChildArgs = {} as ChildArgs,\n): Mutable<O> {\n  const typeKey = TypeKeys[octironType];\n  const name = isIRIObject(rendererArgs.value) ? rendererArgs.value['@id'] : rendererArgs.propType ?? 'octiron';\n\n  // hack to give the function a dynamically set name...\n  const self: Mutable<O & InstanceHooks> = ({ [name]: (\n    predicate: Predicate,\n    children: m.Children,\n  ): m.Children => {\n    const passes = predicate(self as O);\n\n    if (passes) {\n      return children;\n    }\n\n    return null;\n  } })[name] as unknown as O & InstanceHooks;\n\n  self.id = parentArgs.store.key();\n  self.isOctiron = true;\n  self.octironType = octironType;\n  self.readonly = true;\n  self.value = rendererArgs.value ?? null;\n  self.store = parentArgs.store;\n  self.index = rendererArgs.index ?? 0;\n  self.position = -1;\n  self.expand = (typeOrTerm: string) => parentArgs.store.expand(typeOrTerm);\n\n  // easiest to define the common child args here\n  // but the object is passed in from the parent factory\n  // so it has references and control over the values.\n  childArgs.parent = self as unknown as Octiron;\n  childArgs.store = factoryArgs.store ?? parentArgs.store;\n  childArgs.typeDefs = factoryArgs.typeDefs ?? parentArgs.typeDefs;\n\n  if (typeKey !== TypeKeys['root']) {\n    self.propType = rendererArgs.propType;\n    self.dataType = getDataType(rendererArgs.value);\n  }\n\n  self.not = (\n    predicate: Predicate,\n    children: m.Children,\n  ): m.Children => {\n    if (self == null) {\n      return null;\n    }\n\n    const passes = predicate(self as O);\n\n    if (!passes) {\n      return children;\n    }\n\n    return null;\n  };\n\n  self.get = (termOrType) => {\n    if (!isJSONObject(self.value)) {\n      return null;\n    }\n\n    if (termOrType.startsWith('@')) {\n      return self.value[termOrType];\n    }\n\n    const type = self.store.expand(termOrType);\n    const value = self.value[type] ?? null;\n\n    if (isIterable(value)) {\n      return getIterableValue(value);\n    }\n\n    return self.value[type] ?? null;\n  }\n\n  self.enter = (\n    arg1: Selector,\n    arg2?: OctironSelectArgs | SelectView,\n    arg3?: SelectView,\n  ): m.Children => {\n    const [selector, args, view] = unravelArgs(arg1, arg2, arg3);\n\n    return m(SelectionRenderer, {\n      entity: true,\n      selector,\n      args,\n      view,\n      parentArgs: childArgs as SelectionParentArgs,\n    });\n  };\n\n  const rootChildArgs = {\n    ...childArgs,\n    value: parentArgs.store.entity(parentArgs.store.rootIRI)?.value,\n  }\n\n  self.root = (\n    arg1?: Selector | OctironSelectArgs | SelectView,\n    arg2?: OctironSelectArgs | SelectView,\n    arg3?: SelectView,\n  ): m.Children => {\n    let selector: string;\n    const [childSelector, args, view] = unravelArgs(arg1, arg2, arg3);\n\n    if (childSelector == null) {\n      selector = parentArgs.store.rootIRI;\n    } else {\n      selector = `${parentArgs.store.rootIRI} ${childSelector}`;\n    }\n\n    return m(SelectionRenderer, {\n      entity: true,\n      selector,\n      args,\n      view,\n      parentArgs: rootChildArgs as SelectionParentArgs,\n    });\n\n    // return self.enter(selector, args, view);\n  };\n\n  // action and action selection define their own select method\n  switch (typeKey) {\n    case TypeKeys['root']:\n      self.select = self.root;\n    break;\n    case TypeKeys['selection']:\n      self.select = (\n        arg1: Selector,\n        arg2?: OctironSelectArgs | SelectView,\n        arg3?: SelectView,\n    ): m.Children => {\n      const [selector, args, view] = unravelArgs(arg1, arg2, arg3);\n\n      if (!isJSONObject(rendererArgs.value)) {\n        return null;\n      }\n\n      return m(\n        SelectionRenderer,\n        {\n          selector,\n          args,\n          view,\n          parentArgs: childArgs as SelectionParentArgs,\n        },\n      );\n    };\n  }\n\n  switch (typeKey) {\n    case TypeKeys['root']:\n      self.present = self.root;\n    break;\n    default:\n      self.present = (\n        args?: OctironPresentArgs<BaseAttrs>,\n    ): m.Children => {\n      return m(PresentRenderer, {\n        o: self as unknown as Octiron,\n        args: args as OctironPresentArgs,\n        factoryArgs: factoryArgs as OctironPresentArgs,\n        parentArgs,\n        rendererArgs,\n      });\n    };\n  }\n\n  self.default = (\n    args?: OctironDefaultArgs,\n  ) => {\n    return self.present(Object.assign({ component: null }, args));\n  };\n\n  switch (typeKey) {\n    case TypeKeys['root']:\n      self.perform = (\n        arg1?: Selector | OctironPerformArgs | PerformView,\n        arg2?: OctironPerformArgs | PerformView,\n        arg3?: PerformView,\n    ) => {\n        const [selector, args, view] = unravelArgs(arg1, arg2, arg3);\n        \n        return self.root(selector, args, (o) => o.perform(\n          args,\n          view,\n        ));\n      };\n      break;\n    default: {\n      self.perform = (\n        arg1?: Selector | OctironPerformArgs | PerformView,\n        arg2?: OctironPerformArgs | PerformView,\n        arg3?: PerformView,\n      ) => {\n        const [selector, args, view] = unravelArgs(arg1, arg2, arg3);\n\n        if (typeof selector === 'string') {\n          return self.select(selector, args, (o: OctironAction) => o.perform(args, view));\n        }\n\n        return m(PerformRenderer, {\n          selector,\n          args,\n          view,\n          parentArgs: childArgs as SelectionParentArgs & ActionParentArgs,\n        });\n      };\n      break;\n    }\n  }\n\n  if (typeKey !== TypeKeys['root']) {\n    const updateArgs: InstanceHooks['_updateArgs'] = (type, args) => {\n      const currentArgs = type === 'args'\n        ? factoryArgs\n        : type === 'parent'\n        ? parentArgs\n        : rendererArgs;\n\n      // Hack, still don't know if it will work...\n      for (const key of Object.keys(currentArgs)) {\n        // deno-lint-ignore no-explicit-any\n        delete (currentArgs as Record<string, any>)[key];\n      }\n\n      for (const [key, value] of Object.entries(args)) {\n        // deno-lint-ignore no-explicit-any\n        (currentArgs as Record<string, any>)[key] = value;\n      }\n    };\n\n    // deno-lint-ignore no-explicit-any\n    self._updateArgs = updateArgs as any;\n  }\n\n  return self;\n}\n", "import type { JSONObject, JSONValue } from '../types/common.ts';\n\n/**\n * @description\n * Returns true if the input value is an object.\n *\n * @param value Any value which should come from a JSON source.\n */\nexport function isJSONObject(value: JSONValue): value is JSONObject {\n  return typeof value === 'object' && !Array.isArray(value) && value !== null;\n}\n", "import type { ActionSelectView, Octiron, OctironActionSelectionArgs, OctironDefaultArgs, OctironEditArgs, OctironPerformArgs, OctironPresentArgs, OctironSelectArgs, PerformView, Selector, SelectView } from '../types/octiron.ts';\n\ntype AllArgs =\n  | OctironSelectArgs\n  | OctironPresentArgs\n  | OctironPerformArgs\n  | OctironActionSelectionArgs\n  | OctironEditArgs\n  | OctironDefaultArgs\n;\n\ntype AllViews =\n  | SelectView\n  | PerformView\n  | ActionSelectView\n;\n\n/**\n * @description\n * Numerous Octiron view functions take a combination of string selector,\n * object args and function view arguments.\n *\n * This `unravelArgs` identifies which arguments are present and returns\n * defaults for the missing arguments.\n *\n * @param arg1 - A selector string, args object or view function if present.\n * @param arg2 - An args object or view function if present.\n * @param arg3 - A view function if present.\n */\nexport function unravelArgs(\n  arg1?: Selector | OctironSelectArgs | SelectView,\n  arg2?: OctironSelectArgs | SelectView,\n  arg3?: SelectView,\n): [Selector, OctironSelectArgs, SelectView];\n\n\n/**\n * @description\n * Numerous Octiron view functions take a combination of string selector,\n * object args and function view arguments.\n *\n * This `unravelArgs` identifies which arguments are present and returns\n * defaults for the missing arguments.\n *\n * @param arg1 - A selector string, args object or view function if present.\n * @param arg2 - An args object or view function if present.\n * @param arg3 - A view function if present.\n */\nexport function unravelArgs(\n  arg1?: Selector | OctironPerformArgs | PerformView,\n  arg2?: OctironPerformArgs | PerformView,\n  arg3?: PerformView,\n): [Selector, OctironPerformArgs, PerformView];\n\n\n/**\n * @description\n * Numerous Octiron view functions take a combination of string selector,\n * object args and function view arguments.\n *\n * This `unravelArgs` identifies which arguments are present and returns\n * defaults for the missing arguments.\n *\n * @param arg1 - A selector string, args object or view function if present.\n * @param arg2 - An args object or view function if present.\n * @param arg3 - A view function if present.\n */\nexport function unravelArgs(\n  arg1?: Selector,\n  arg2?: OctironActionSelectionArgs | ActionSelectView,\n  arg3?: ActionSelectView,\n): [Selector, OctironActionSelectionArgs, ActionSelectView];\n\n/**\n * @description\n * Numerous Octiron view functions take a combination of string selector,\n * object args and function view arguments.\n *\n * This `unravelArgs` identifies which arguments are present and returns\n * defaults for the missing arguments.\n *\n * @param arg1 - A selector string, args object or view function if present.\n * @param arg2 - An args object or view function if present.\n */\nexport function unravelArgs(\n  arg1?: Selector | OctironPresentArgs,\n  arg2?: OctironPresentArgs,\n): [Selector, OctironSelectArgs];\n\n/**\n * @description\n * Numerous Octiron view functions take a combination of string selector,\n * object args and function view arguments.\n *\n * This `unravelArgs` identifies which arguments are present and returns\n * defaults for the missing arguments.\n *\n * @param arg1 - A selector string, args object or view function if present.\n * @param arg2 - An args object or view function if present.\n */\nexport function unravelArgs(\n  arg1?: Selector | OctironEditArgs,\n  arg2?: OctironEditArgs,\n): [Selector, OctironEditArgs];\n\n/**\n * @description\n * Numerous Octiron view functions take a combination of string selector,\n * object args and function view arguments.\n *\n * This `unravelArgs` identifies which arguments are present and returns\n * defaults for the missing arguments.\n *\n * @param arg1 - A selector string, args object or view function if present.\n * @param arg2 - An args object or view function if present.\n */\nexport function unravelArgs(\n  arg1?: Selector | OctironDefaultArgs,\n  arg2?: OctironDefaultArgs,\n): [Selector, OctironDefaultArgs];\n\n/**\n * @description\n * Numerous Octiron view functions take a combination of string selector,\n * object args and function view arguments.\n *\n * This `unravelArgs` identifies which arguments are present and returns\n * defaults for the missing arguments.\n *\n * @param arg1 - A selector string, args object or view function if present.\n * @param arg2 - An args object or view function if present.\n * @param arg3 - A view function if present.\n */\nexport function unravelArgs(\n  arg1?: Selector | AllArgs | AllViews,\n  arg2?: AllArgs | AllViews,\n  arg3?: AllViews,\n): [Selector | undefined, AllArgs, AllViews] | [Selector | undefined, AllArgs] {\n  let selector: Selector | undefined;\n  let args: AllArgs = {} as AllArgs;\n  let view: AllViews | undefined;\n\n  if (typeof arg1 === \"string\") {\n    selector = arg1;\n  } else if (typeof arg1 === \"function\") {\n    view = arg1 as SelectView;\n  } else if (arg1 != null) {\n    args = arg1;\n  }\n\n  if (typeof arg2 === 'function') {\n    view = arg2 as SelectView;\n  } else if (arg2 != null) {\n    args = arg2;\n  }\n\n  if (typeof arg3 === 'function') {\n    view = arg3;\n  }\n\n  if (typeof view === \"undefined\") {\n    view = ((o: Octiron) => o.default(args as OctironDefaultArgs)) as AllViews;\n  }\n\n  return [\n    selector,\n    args,\n    view,\n  ];\n}\n", "import type { JSONObject, Mutable } from \"../types/common.ts\";\nimport type {\nCommonRendererArgs,\n  OctironSelectArgs,\n  OctironSelection,\n  SelectionParentArgs,\n  Selector,\n  SelectView,\n} from \"../types/octiron.ts\";\nimport type {\n  Failure,\n  ReadonlySelectionResult,\n  SelectionDetails,\n} from \"../types/store.ts\";\nimport m from \"mithril\";\nimport { selectionFactory } from \"../factories/selectionFactory.ts\";\nimport { isJSONObject } from \"../utils/isJSONObject.ts\";\nimport { mithrilRedraw } from \"../utils/mithrilRedraw.ts\";\nimport {isBrowserRender} from \"../consts.ts\";\n\n\nexport type SelectionRendererAttrs = {\n  entity?: boolean;\n  selector: Selector;\n  fragment?: string;\n  args: OctironSelectArgs;\n  view: SelectView;\n  parentArgs: SelectionParentArgs;\n};\n\nconst preKey = Symbol.for('@pre');\nconst postKey = Symbol.for('@post');\n\nfunction shouldReselect(\n  next: SelectionRendererAttrs,\n  prev: SelectionRendererAttrs,\n) {\n  return next.parentArgs.store !== prev.parentArgs.store ||\n    next.selector !== prev.selector ||\n    next.parentArgs.value !== prev.parentArgs.value;\n}\n\n/**\n * @description\n * Subscribes to a selection's result using the Octiron store. Each selection\n * result is feed to an Octiron instance and is only removed if a later\n * selection update does not include the same result. Selection results are\n * given a unique key in the form of a json-path.\n *\n * Once an Octiron instance is created using a selection, further changes via\n * the upstream parentArgs object or user given args applied to the downstream\n * Octiron instances using their internal update hooks.\n */\nexport const SelectionRenderer: m.FactoryComponent<SelectionRendererAttrs> = (\n  vnode,\n) => {\n  const key = Symbol(`SelectionRenderer`);\n  let deferring: boolean = false;\n  let currentAttrs = vnode.attrs;\n  let details: undefined | SelectionDetails<ReadonlySelectionResult>;\n\n  const instances: Record<symbol, {\n    octiron: OctironSelection;\n    selectionResult: ReadonlySelectionResult;\n  }> = {};\n\n  function createInstances() {\n    let hasChanges = false;\n    let initialDetails = details == null;\n    const nextKeys: Array<symbol> = [];\n\n    if (details == null) {\n      const prevKeys = Reflect.ownKeys(instances) as symbol[];\n\n      for (const key of prevKeys) {\n        if (!nextKeys.includes(key)) {\n          hasChanges = true;\n\n          delete instances[key];\n        }\n      }\n\n      if (hasChanges) {\n        mithrilRedraw();\n      }\n\n      return;\n    }\n\n    for (let index = 0; index < details.result.length; index++) {\n      const selectionResult = details.result[index];\n      const key = Symbol.for(selectionResult.pointer);\n\n      nextKeys.push(key);\n\n      if (Object.hasOwn(instances, key)) {\n        const next = selectionResult;\n        const prev = instances[key].selectionResult;\n\n        if (\n          prev.type === 'value' &&\n          next.type === 'value' &&\n          next.value === prev.value\n        ) {\n          continue;\n        } else if (\n          prev.type === 'entity' &&\n          next.type === 'entity' &&\n          next.ok === prev.ok &&\n          next.status === prev.status &&\n          next.value === prev.value\n        ) {\n          continue;\n        }\n      }\n\n      hasChanges = true;\n\n      const rendererArgs: CommonRendererArgs = {\n        index,\n        value: selectionResult.value,\n        propType: selectionResult.type === 'entity' ? undefined : selectionResult.propType,\n      }\n      const octiron = selectionFactory(\n        currentAttrs.args,\n        currentAttrs.parentArgs,\n        rendererArgs,\n      );\n\n      instances[key] = {\n        octiron,\n        selectionResult,\n      };\n    }\n\n    const prevKeys = Reflect.ownKeys(instances) as symbol[];\n\n    for (const key of prevKeys) {\n      if (!nextKeys.includes(key)) {\n        hasChanges = true;\n\n        delete instances[key];\n      }\n    }\n\n    if (!initialDetails && hasChanges) {\n      mithrilRedraw();\n    }\n  }\n\n  async function fetchRequired(\n    required: string[],\n  ) {\n    console.log('SHOULD DEFER?', currentAttrs.args.defer)\n    if (required.length === 0) {\n      return;\n    } else if (\n      !isBrowserRender &&\n      !currentAttrs.args.mainEntity &&\n      currentAttrs.args.defer\n    ) {\n      deferring = true;\n      return;\n    }\n\n    // deno-lint-ignore no-explicit-any\n    const promises: Promise<any>[] = [];\n\n    for (const iri of required) {\n      promises.push(currentAttrs.parentArgs.store.fetch(iri, currentAttrs.args.accept));\n    }\n\n    await Promise.allSettled(promises);\n  }\n\n  function listener(next: SelectionDetails<ReadonlySelectionResult>) {\n    let required: string[] = [];\n\n    if (typeof details === 'undefined') {\n      required = next.required;\n    } else {\n      for (const iri of next.required) {\n        if (!details.required.includes(iri)) {\n          required.push(iri);\n        }\n      }\n    }\n\n    details = next;\n\n    if (required.length > 0) {\n      fetchRequired(required);\n    }\n\n    createInstances();\n  }\n\n  function subscribe() {\n    const { entity, selector, parentArgs: { value, store } } = currentAttrs;\n\n    if (\n      !entity &&\n      !isJSONObject(value)\n    ) {\n      store.unsubscribe(key);\n      createInstances();\n\n      return;\n    }\n\n    details = store.subscribe({\n      key,\n      selector,\n      fragment: currentAttrs.args.fragment,\n      accept: currentAttrs.args.accept,\n      value: entity ? undefined : value as JSONObject,\n      listener,\n    });\n\n    fetchRequired(details.required);\n\n    createInstances();\n  }\n\n  return {\n    oninit: ({ attrs }) => {\n      currentAttrs = attrs;\n\n      subscribe();\n    },\n    onbeforeupdate: ({ attrs }) => {\n      const reselect = shouldReselect(attrs, currentAttrs);\n\n      currentAttrs = attrs;\n\n      if (reselect) {\n        attrs.parentArgs.store.unsubscribe(key);\n        subscribe();\n      }\n    },\n    onbeforeremove: ({ attrs }) => {\n      currentAttrs = attrs;\n\n      attrs.parentArgs.store.unsubscribe(key);\n    },\n    view: ({ attrs }): m.Children => {\n      if (deferring) {\n        return currentAttrs.args.loading;\n      }\n\n      if (details == null || !details.complete) {\n        return attrs.args.loading;\n      } else if ((details.hasErrors || details.hasMissing) && typeof attrs.args.fallback !== 'function') {\n        return attrs.args.fallback;\n      } else if (details.result[0] != null && details.result[0].type === 'alternative') {\n        return details.result[0].integration.render(null, attrs.args.fragment);\n      }\n\n      const view = attrs.view;\n      const {\n        pre,\n        sep,\n        post,\n        start,\n        end,\n        predicate,\n        loading,\n        fallback,\n      } = currentAttrs.args;\n\n      const children: m.Children = [];\n      let list = Reflect.ownKeys(instances).map(((key) => {\n        const instance = instances[key as symbol];\n\n        (instance.octiron as Mutable<OctironSelection>).position = -1;\n\n        return instance;\n      }));\n\n      if (start != null || end != null) {\n        list = list.slice(\n          start ?? 0,\n          end,\n        );\n      }\n\n      if (predicate != null) {\n        list = list.filter(({ octiron }) => predicate(octiron));\n      }\n\n      if (pre != null) {\n        children.push(m.fragment({}, [pre]));\n      }\n\n      for (let index = 0; index < list.length; index++) {\n        const { selectionResult, octiron } = list[index];\n\n        (octiron as Mutable<OctironSelection>).position = index + 1;\n\n\n        if (index !== 0) {\n          children.push(m.fragment({}, [sep]));\n        }\n\n        if (selectionResult.type === 'value') {\n          children.push(m.fragment({}, [view(octiron)]));\n        } else if (!selectionResult.ok && typeof fallback === 'function') {\n          children.push(\n            m.fragment({}, [fallback(octiron, selectionResult.reason as Failure)]),\n          );\n        } else if (!selectionResult.ok) {\n          children.push(m.fragment({}, [fallback as m.Children]));\n        } else {\n          children.push(m.fragment({}, [view(octiron)]));\n        }\n      }\n\n      if (post != null) {\n        children.push(m.fragment({}, [post]));\n      }\n\n      return children;\n    },\n  };\n};\n", "import type { ActionParentArgs, BaseAttrs, CommonRendererArgs, OctironSelectArgs, OctironSelection, SelectionParentArgs } from '../types/octiron.ts';\nimport { type CommonArgs, type InstanceHooks, octironFactory } from \"./octironFactory.ts\";\n\n/**\n  * Creates an Octiron selection instance.\n  *\n  * @param args - User specified args passed to the Octiron method creating the factory.\n  * @param parentArgs - Args passed from the Octiron parent instance of this instance.\n  * @param rendererArgs - Args passed from the Mithril renderer component.\n  */\nexport function selectionFactory<Attrs extends BaseAttrs>(\n  args: OctironSelectArgs<Attrs>,\n  parentArgs: SelectionParentArgs,\n  rendererArgs: CommonRendererArgs,\n): OctironSelection & InstanceHooks {\n  const factoryArgs = Object.assign({}, args);\n  const childArgs = {\n    // value: parentArgs.value,\n    value: rendererArgs.value,\n  } as SelectionParentArgs & ActionParentArgs;\n  const self = octironFactory(\n    'selection',\n    factoryArgs as CommonArgs,\n    parentArgs,\n    rendererArgs,\n    childArgs,\n  );\n\n  return self as OctironSelection & InstanceHooks;\n}\n", "import m from 'mithril';\nimport { isBrowserRender } from \"../consts.ts\";\n\n/**\n * @description\n * Calls Mithril's redraw function if the window object exists.\n */\nexport function mithrilRedraw(): void {\n  if (isBrowserRender) {\n    m.redraw();\n  }\n}\n", "\nexport const isBrowserRender = typeof window !== 'undefined';\n", "import m from 'mithril';\nimport type { Octiron, OctironPresentArgs, CommonParentArgs, CommonRendererArgs } from '../types/octiron.ts';\nimport { selectComponentFromArgs } from '../utils/selectComponentFromArgs.ts';\n\n\nexport type PresentRendererAttrs = {\n  o: Octiron;\n  args: OctironPresentArgs;\n  factoryArgs: OctironPresentArgs;\n  parentArgs: CommonParentArgs;\n  rendererArgs: CommonRendererArgs;\n};\n\nexport const PresentRenderer: m.ComponentTypes<PresentRendererAttrs> = ({\n  attrs: {\n    args,\n    factoryArgs,\n    parentArgs,\n    rendererArgs,\n  },\n}) => {\n  let [attrs, component] = selectComponentFromArgs(\n    'present',\n    parentArgs,\n    rendererArgs,\n    args,\n    factoryArgs,\n  );\n\n  return {\n    //onbeforeupdate({ attrs: { args, factoryArgs, parentArgs, rendererArgs }}) {\n      // [attrs, component] = selectComponentFromArgs(\n      //   'present',\n      //   parentArgs,\n      //   rendererArgs,\n      //   args,\n      //   factoryArgs,\n      // );\n    //},\n    view({ attrs: { o, rendererArgs }, children }) {\n      if (component == null) {\n        return null;\n      }\n\n      // deno-lint-ignore no-explicit-any\n      return m(component as any, {\n        o,\n        renderType: \"present\",\n        value: rendererArgs.value,\n        attrs,\n      }, children);\n    },\n  };\n};\n", "import type { AnyComponent, BaseAttrs, EditComponent, PresentComponent, TypeDefs } from \"../types/octiron.ts\";\n\n/**\n * @description\n * Returns a component based of Octiron's selection rules:\n *\n * 1. If the first pick component is given, return it.\n * 2. If a typedef is defined for the propType (jsonld term or type)\n *    for the given style, return it.\n * 3. If a typedef is defined for the (or one of the) types (jsonld '@type')\n *    value for the given style, return it.\n * 4. If a fallback component is given, return it.\n *\n * @param args.style - The style of presentation.\n * @param args.propType - The propType the component should be configured to\n *                        handle.\n * @param args.type - The type the component should be configured to handle.\n * @param args.firstPickComponent - The component to use if passed by upstream.\n * @param args.fallbackComponent - The component to use if no other component\n *                                 is picked.\n */\nexport function getComponent<\n  Style extends 'present' | 'edit',\n  Component extends (\n    Style extends 'present'\n      ? PresentComponent | AnyComponent\n      : EditComponent | AnyComponent\n  )\n>({\n  style,\n  propType,\n  type,\n  firstPickComponent,\n  typeDefs,\n  fallbackComponent,\n}: {\n  style: Style;\n  propType?: string;\n  type?: string | string[];\n  typeDefs: TypeDefs;\n  firstPickComponent?: Component;\n  fallbackComponent?: Component;\n}): Component | undefined {\n  if (firstPickComponent != null) {\n    return firstPickComponent;\n  }\n\n  if (\n    propType != null &&\n    typeDefs[propType]?.[style] != null\n  ) {\n    return typeDefs[propType][style] as Component;\n  }\n\n  if (\n    !Array.isArray(type) &&\n    type != null &&\n    typeDefs[type]?.[style] != null\n  ) {\n    return typeDefs[type][style] as Component;\n  }\n\n  if (Array.isArray(type)) {\n    for (const item of type) {\n      if (\n        typeDefs[item]?.[style] != null\n      ) {\n        return typeDefs[item][style] as Component;\n      }\n    }\n  }\n\n  if (fallbackComponent != null) {\n    return fallbackComponent as Component;\n  }\n}\n", "import type { JSONObject, JSONValue, TypeObject } from '../types/common.ts';\nimport { isJSONObject } from \"./isJSONObject.ts\";\n\n/**\n * @description\n * Returns true if the given value is a JSON object with a JSON-ld @type value.\n *\n * @param value Any value which should come from a JSON source.\n */\nexport function isTypeObject<\n  Properties extends JSONObject = JSONObject\n>(value: JSONValue): value is TypeObject<Properties> {\n  if (!isJSONObject(value)) {\n    return false;\n  } else if (typeof value['@type'] === 'string') {\n    return true;\n  } else if (!Array.isArray(value['@type'])) {\n    return false;\n  }\n\n  for (const item of value['@type']) {\n    if (typeof item !== 'string') {\n      return false;\n    }\n  }\n\n  return true;\n}\n", "import type { JSONValue } from \"../types/common.ts\";\nimport { isTypeObject } from \"./isTypedObject.ts\";\n\n\n/**\n * @description\n * Returns the type value of the input if it is a type object.\n *\n * @param value A JSON value which might be a typed JSON-ld object.\n */\nexport function getDataType(value: JSONValue): string | string[] | undefined {\n  if (isTypeObject(value)) {\n    return value['@type'];\n  }\n}\n", "import type { AnyComponent, BaseAttrs, CommonParentArgs, CommonRendererArgs, EditComponent, OctironEditArgs, OctironPresentArgs, PresentComponent } from \"../types/octiron.ts\";\nimport { getComponent } from \"./getComponent.ts\";\nimport { getDataType } from \"./getValueType.ts\";\n\n\n/**\n * Selects the component and attrs to render with from args provided to an Octiron\n * factory instance or the render method.\n */\nexport const selectComponentFromArgs = <\n  Style extends 'present' | 'edit',\n  Args extends (\n    Style extends 'present'\n      ? OctironPresentArgs\n      : OctironEditArgs\n  ),\n  Attrs extends BaseAttrs,\n  Component extends (\n    Style extends 'present'\n      ? PresentComponent | AnyComponent\n      : EditComponent | AnyComponent\n  )\n>(\n  style: Style,\n  parentArgs: CommonParentArgs,\n  rendererArgs: CommonRendererArgs,\n  args?: Args,\n  factoryArgs?: Args,\n): [Attrs, Component | undefined] => {\n  const attrs: Attrs = Object.assign({}, args?.attrs ?? factoryArgs?.attrs) as Attrs;\n  // null for a component arg indicates this is being called by a `o.default()` method\n  // which will cause infinite recursion if it ends up re-selecting itself via factory args.\n  const firstPickComponent = (args?.component ?? (args?.component !== null ? factoryArgs?.component : null)) as Component;\n  const fallbackComponent = (args?.fallbackComponent ?? (args?.component !== null ? factoryArgs?.fallbackComponent : null)) as Component;\n\n  const component = getComponent({\n    style,\n    propType: rendererArgs?.propType,\n    type: getDataType(rendererArgs.value),\n    firstPickComponent,\n    fallbackComponent,\n    typeDefs: args?.typeDefs ?? parentArgs.typeDefs,\n  });\n\n  return [attrs, component];\n}\n", "import type { IterableJSONLD, JSONValue } from '../types/common.ts';\nimport { isJSONObject } from \"./isJSONObject.ts\";\n\n/**\n * @description\n * Returns true if a json-ld value is an array or has an iterable value,\n * i.e.: an object with an `@list` or `@set` array value.\n *\n * @param {JSONValue} value - A json-ld value\n */\nexport function isIterable(value: JSONValue): value is IterableJSONLD {\n  if (Array.isArray(value)) {\n    return true;\n  } else if (isJSONObject(value)) {\n    if (Array.isArray(value[\"@list\"])) {\n      return true;\n    } else if (Array.isArray(value[\"@set\"])) {\n      return true;\n    }\n  }\n\n  return false;\n}\n", "import type { IterableJSONLD, JSONArray } from '../types/common.ts';\n\n\n/**\n * @description\n * Returns true if a json-ld value is an array or has an iterable value,\n * i.e.: an object with an `@list` or `@set` array value.\n *\n * This function returns an empty array in the cases where a non-iterable value\n * is given.\n *\n * @param {JSONValue} value - A json-ld value\n */\nexport function getIterableValue(value: IterableJSONLD): JSONArray {\n  if (Array.isArray(value)) {\n    return value;\n  } else if (Array.isArray(value['@list'])) {\n    return value['@list'];\n  } else if (Array.isArray(value['@set'])) {\n    return value['@set'];\n  }\n\n  return [];\n}\n", "import m from 'mithril';\nimport { JsonPointer } from 'json-ptr';\nimport { ActionStateRenderer } from \"../renderers/ActionStateRenderer.ts\";\nimport type { Store } from \"../store.ts\";\nimport type { JSONArray, JSONObject, JSONValue, SCMAction } from \"../types/common.ts\";\nimport type { ActionParentArgs, ActionSelectionParentArgs, ActionSelectView, CommonParentArgs, CommonRendererArgs, OctironAction, OctironActionSelectionArgs, OctironPerformArgs, OctironSelectArgs, PayloadValueMapper, PerformRendererArgs, Predicate, PresentComponent, SelectionParentArgs, Selector, SelectView, Submitable, TypeDefs, UpdateArgs, UpdatePointer } from \"../types/octiron.ts\";\nimport type { EntityState } from \"../types/store.ts\";\nimport { getSubmitDetails } from \"../utils/getSubmitDetails.ts\";\nimport { unravelArgs } from \"../utils/unravelArgs.ts\";\nimport { mithrilRedraw } from \"../utils/mithrilRedraw.ts\";\nimport { ActionSelectionRenderer } from \"../renderers/ActionSelectionRenderer.ts\";\nimport { isJSONObject } from \"../utils/isJSONObject.ts\";\nimport { type ChildArgs, type CommonArgs, type InstanceHooks, octironFactory } from \"./octironFactory.ts\";\nimport {expandValue} from '../utils/expandValue.ts';\n\nexport type ActionRefs = {\n  url?: string;\n  method?: string;\n  submitting: boolean;\n  payload: JSONObject;\n  store: Store;\n  typeDefs: TypeDefs;\n  submitResult?: EntityState;\n};\n\nexport function actionFactory<\n  Attrs extends Record<string, unknown> = Record<string, unknown>,\n>(\n  args: OctironPerformArgs<Attrs>,\n  parentArgs: ActionParentArgs,\n  rendererArgs: PerformRendererArgs,\n): OctironAction & InstanceHooks {\n  const factoryArgs = Object.assign(Object.create(null), args);\n  let payload: JSONObject = Object.create(null);\n  let submitResult: EntityState | undefined;\n\n  if (isJSONObject(args.initialValue)) {\n    payload = expandValue(parentArgs.store, args.initialValue);\n  } else if (args.initialValue != null) {\n    console.warn('o.perform() only supports receiving JSON objects as initial values.');\n  }\n\n  async function submit() {\n    const { url, method, body, contentType, encodingType } = getSubmitDetails({\n      payload,\n      action: rendererArgs.value as SCMAction,\n      store: parentArgs.store,\n    });\n\n    self.submitting = true;\n    self.url = new URL(url, self.store.rootIRI);\n\n    mithrilRedraw();\n\n    try {\n      submitResult = await parentArgs.store.submit(url, {\n        method,\n        body,\n        contentType,\n        encodingType,\n      });\n    } catch (err) {\n      console.error(err);\n    }\n\n    self.submitting = false;\n\n    mithrilRedraw();\n  }\n\n  function update(value: JSONObject) {\n    const prev = payload;\n    const next = {\n      ...prev,\n      ...value,\n    };\n\n    if (typeof args.interceptor === 'function') {\n      payload = args.interceptor(\n        next,\n        prev,\n        parentArgs.parent.value as SCMAction,\n      );\n    } else {\n      payload = next;\n    }\n\n    childArgs.value = self.value = value;\n\n    mithrilRedraw();\n  }\n\n  const updatePointer: UpdatePointer = (\n    pointer: string,\n    value: JSONValue,\n    _args?: UpdateArgs,\n  ) => {\n    const next: Partial<JSONObject> = Object.assign({}, payload);\n    const ptr = JsonPointer.create(pointer);\n\n    if (value == null) {\n      ptr.unset(next);\n    } else {\n      ptr.set(next, value, true);\n    }\n\n    update(next);\n  }\n\n  const childArgs = {\n    value: payload,\n    submitting: false,\n    submit,\n    updatePointer,\n  } as Partial<SelectionParentArgs & ActionParentArgs & ActionSelectionParentArgs>;\n\n  const self = octironFactory(\n    'action',\n    factoryArgs as CommonArgs,\n    parentArgs as CommonParentArgs,\n    rendererArgs as CommonRendererArgs,\n    childArgs as ChildArgs,\n  );\n\n  self.value = payload;\n  self.action = parentArgs.parent;\n  self.actionValue = rendererArgs.actionValue;\n\n  childArgs.action = self as unknown as OctironAction;\n  childArgs.submitting = self.submitting;\n\n  self.select = (\n    arg1: Selector,\n    arg2?: OctironActionSelectionArgs | ActionSelectView,\n    arg3?: ActionSelectView,\n  ): m.Children => {\n    const [selector, args, view] = unravelArgs(arg1, arg2, arg3);\n\n    return m(\n      ActionSelectionRenderer,\n      {\n        parentArgs: childArgs as ActionSelectionParentArgs,\n        selector,\n        value: self.value,\n        actionValue: parentArgs.parent.value as JSONObject,\n        args,\n        view,\n      }\n    );\n  };\n\n  self.submit = async function (\n    arg1?: PayloadValueMapper<JSONObject> | JSONObject\n  ): Promise<void> {\n    if (typeof arg1 === 'function') {\n      update(arg1(payload));\n    } else if (arg1 != null) {\n      update(arg1);\n    }\n\n    return await submit();\n  } as OctironAction['submit'];\n\n  self.update = async function (\n    arg1: PayloadValueMapper<JSONObject> | JSONObject,\n    args?: UpdateArgs,\n  ): Promise<void> {\n    if (typeof arg1 === 'function') {\n      update(arg1(payload));\n    } else if (arg1 != null) {\n      update(arg1);\n    }\n\n    if (args?.submit || args?.submitOnChange) {\n      await submit();\n    } else {\n      mithrilRedraw();\n    }\n  } as OctironAction['update'];\n\n  self.append = (\n    termOrType: string,\n    value: JSONValue = {},\n    args: UpdateArgs = {},\n  ) => {\n    const type = parentArgs.store.expand(termOrType);\n\n    if (!isJSONObject(self.value)) {\n      return;\n    }\n    const prevValue = self.value[type];\n    let nextValue: JSONArray = [];\n\n    if (prevValue != null && !Array.isArray(prevValue)) {\n      nextValue.push(prevValue);\n    } else if (Array.isArray(prevValue)) {\n      nextValue = [...prevValue.filter((value) => value != undefined)];\n    }\n\n    nextValue.push(value);\n\n    return self.update({\n      ...self.value,\n      [type]: nextValue,\n    }, args);\n  };\n\n  const makeInitialStateMethod = (\n    not?: true,\n  ) => {\n    return (\n      children: m.Children,\n    ) => {\n      return m(\n        ActionStateRenderer,\n        {\n          not,\n          type: 'initial',\n          args: {},\n          submitResult,\n          parentArgs: childArgs as SelectionParentArgs,\n        },\n        children,\n      );\n    }\n  }\n\n  const makeActionStateMethod = (\n    type: 'success' | 'failure',\n    not?: true,\n  ) => {\n    return (\n      arg1?: Selector | OctironSelectArgs | SelectView,\n      arg2?: OctironSelectArgs | SelectView,\n      arg3?: SelectView,\n    ) => {\n      const [selector, args, view] = unravelArgs(arg1, arg2, arg3);\n\n      return m(ActionStateRenderer, {\n        not,\n        type,\n        selector,\n        args,\n        view,\n        submitResult,\n        parentArgs: childArgs as SelectionParentArgs,\n      });\n    }\n  }\n\n  self.initial = makeInitialStateMethod();\n  self.not.initial = makeInitialStateMethod(true);\n  self.success = makeActionStateMethod('success');\n  self.not.success = makeActionStateMethod('success', true);\n  self.failure = makeActionStateMethod('failure');\n  self.not.failure = makeActionStateMethod('failure', true);\n\n  try {\n    const submitDetails = getSubmitDetails({\n      payload: self.value,\n      action: rendererArgs.value as SCMAction,\n      store: parentArgs.store,\n    });\n    self.url = new URL(submitDetails.url);\n    self.method = submitDetails.method;\n  } catch (err) {\n    console.error(err);\n  }\n\n  if (self.url != null) {\n    submitResult = parentArgs.store.entity(self.url.toString());\n  }\n\n  if (\n    typeof window === 'undefined' && args.submitOnInit &&\n    submitResult == null\n  ) {\n    self.submit();\n  } else if (typeof window !== 'undefined' && args.submitOnInit) {\n    self.submit();\n  }\n\n  return self as OctironAction & InstanceHooks;\n}\n", "import {\n  JsonStringPointer,\n  UriFragmentIdentifierPointer,\n  Pointer,\n  RelativeJsonPointer,\n  PathSegment,\n  PathSegments,\n  Decoder,\n} from './types';\n\nexport function replace(source: string, find: string, repl: string): string {\n  let res = '';\n  let rem = source;\n  let beg = 0;\n  let end = -1;\n  while ((end = rem.indexOf(find)) > -1) {\n    res += source.substring(beg, beg + end) + repl;\n    rem = rem.substring(end + find.length, rem.length);\n    beg += end + find.length;\n  }\n  if (rem.length > 0) {\n    res += source.substring(source.length - rem.length, source.length);\n  }\n  return res;\n}\n\nexport function decodeFragmentSegments(segments: PathSegments): PathSegments {\n  let i = -1;\n  const len = segments.length;\n  const res = new Array(len);\n  while (++i < len) {\n    if (typeof segments[i] === 'string') {\n      res[i] = replace(\n        replace(decodeURIComponent(segments[i] as string), '~1', '/'),\n        '~0',\n        '~',\n      );\n    } else {\n      res[i] = segments[i];\n    }\n  }\n  return res;\n}\n\nexport function encodeFragmentSegments(segments: PathSegments): PathSegments {\n  let i = -1;\n  const len = segments.length;\n  const res = new Array(len);\n  while (++i < len) {\n    if (typeof segments[i] === 'string') {\n      res[i] = encodeURIComponent(\n        replace(replace(segments[i] as string, '~', '~0'), '/', '~1'),\n      );\n    } else {\n      res[i] = segments[i];\n    }\n  }\n  return res;\n}\n\nexport function decodePointerSegments(segments: PathSegments): PathSegments {\n  let i = -1;\n  const len = segments.length;\n  const res = new Array(len);\n  while (++i < len) {\n    if (typeof segments[i] === 'string') {\n      res[i] = replace(replace(segments[i] as string, '~1', '/'), '~0', '~');\n    } else {\n      res[i] = segments[i];\n    }\n  }\n  return res;\n}\n\nexport function encodePointerSegments(segments: PathSegments): PathSegments {\n  let i = -1;\n  const len = segments.length;\n  const res = new Array(len);\n  while (++i < len) {\n    if (typeof segments[i] === 'string') {\n      res[i] = replace(replace(segments[i] as string, '~', '~0'), '/', '~1');\n    } else {\n      res[i] = segments[i];\n    }\n  }\n  return res;\n}\n\nexport function decodePointer(ptr: Pointer): PathSegments {\n  if (typeof ptr !== 'string') {\n    throw new TypeError(\n      'Invalid type: JSON Pointers are represented as strings.',\n    );\n  }\n  if (ptr.length === 0) {\n    return [];\n  }\n  if (ptr[0] !== '/') {\n    throw new ReferenceError(\n      'Invalid JSON Pointer syntax. Non-empty pointer must begin with a solidus `/`.',\n    );\n  }\n  return decodePointerSegments(ptr.substring(1).split('/'));\n}\n\nexport function encodePointer(path: PathSegments): JsonStringPointer {\n  if (!path || (path && !Array.isArray(path))) {\n    throw new TypeError('Invalid type: path must be an array of segments.');\n  }\n  if (path.length === 0) {\n    return '';\n  }\n  return '/'.concat(encodePointerSegments(path).join('/'));\n}\n\nexport function decodeUriFragmentIdentifier(\n  ptr: UriFragmentIdentifierPointer,\n): PathSegments {\n  if (typeof ptr !== 'string') {\n    throw new TypeError(\n      'Invalid type: JSON Pointers are represented as strings.',\n    );\n  }\n  if (ptr.length === 0 || ptr[0] !== '#') {\n    throw new ReferenceError(\n      'Invalid JSON Pointer syntax; URI fragment identifiers must begin with a hash.',\n    );\n  }\n  if (ptr.length === 1) {\n    return [];\n  }\n  if (ptr[1] !== '/') {\n    throw new ReferenceError('Invalid JSON Pointer syntax.');\n  }\n  return decodeFragmentSegments(ptr.substring(2).split('/'));\n}\n\nexport function encodeUriFragmentIdentifier(\n  path: PathSegments,\n): UriFragmentIdentifierPointer {\n  if (!path || (path && !Array.isArray(path))) {\n    throw new TypeError('Invalid type: path must be an array of segments.');\n  }\n  if (path.length === 0) {\n    return '#';\n  }\n  return '#/'.concat(encodeFragmentSegments(path).join('/'));\n}\n\nconst InvalidRelativePointerError =\n  'Invalid Relative JSON Pointer syntax. Relative pointer must begin with a non-negative integer, followed by either the number sign (#), or a JSON Pointer.';\n\nexport function decodeRelativePointer(ptr: RelativeJsonPointer): PathSegments {\n  if (typeof ptr !== 'string') {\n    throw new TypeError(\n      'Invalid type: Relative JSON Pointers are represented as strings.',\n    );\n  }\n  if (ptr.length === 0) {\n    // https://tools.ietf.org/id/draft-handrews-relative-json-pointer-00.html#rfc.section.3\n    throw new ReferenceError(InvalidRelativePointerError);\n  }\n  const segments = ptr.split('/');\n  let first = segments[0];\n  // It is a name reference; strip the hash.\n  if (first[first.length - 1] == '#') {\n    if (segments.length > 1) {\n      throw new ReferenceError(InvalidRelativePointerError);\n    }\n    first = first.substr(0, first.length - 1);\n  }\n  let i = -1;\n  const len = first.length;\n  while (++i < len) {\n    if (first[i] < '0' || first[i] > '9') {\n      throw new ReferenceError(InvalidRelativePointerError);\n    }\n  }\n  const path: unknown[] = decodePointerSegments(segments.slice(1));\n  path.unshift(segments[0]);\n  return path as PathSegments;\n}\n\nexport function toArrayIndexReference(\n  arr: readonly unknown[],\n  idx: PathSegment,\n): number {\n  if (typeof idx === 'number') return idx;\n  const len = idx.length;\n  if (!len) return -1;\n  let cursor = 0;\n  if (len === 1 && idx[0] === '-') {\n    if (!Array.isArray(arr)) {\n      return 0;\n    }\n    return arr.length;\n  }\n  while (++cursor < len) {\n    if (idx[cursor] < '0' || idx[cursor] > '9') {\n      return -1;\n    }\n  }\n  return parseInt(idx, 10);\n}\n\nexport type Dereference = (it: unknown) => unknown;\n\nexport function compilePointerDereference(path: PathSegments): Dereference {\n  let body = \"if (typeof(it) !== 'undefined'\";\n  if (path.length === 0) {\n    return (it): unknown => it;\n  }\n  body = path.reduce((body, _, i) => {\n    return (\n      body +\n      \"\\n\\t&& it !== null && typeof((it = it['\" +\n      replace(replace(path[i] + '', '\\\\', '\\\\\\\\'), \"'\", \"\\\\'\") +\n      \"'])) !== 'undefined'\"\n    );\n  }, \"if (typeof(it) !== 'undefined'\") as string;\n  body = body + ') {\\n\\treturn it;\\n }';\n  // eslint-disable-next-line no-new-func\n  return new Function('it', body) as Dereference;\n}\n\nexport function setValueAtPath(\n  target: unknown,\n  val: unknown,\n  path: PathSegments,\n  force = false,\n): unknown {\n  if (path.length === 0) {\n    throw new Error('Cannot set the root object; assign it directly.');\n  }\n  if (typeof target === 'undefined') {\n    throw new TypeError('Cannot set values on undefined');\n  }\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  let it: any = target;\n  const len = path.length;\n  const end = path.length - 1;\n  let step: PathSegment;\n  let cursor = -1;\n  let rem: unknown;\n  let p: number;\n  while (++cursor < len) {\n    step = path[cursor];\n    if (typeof step !== 'string' && typeof step !== 'number') {\n      throw new TypeError('PathSegments must be a string or a number.');\n    }\n    if (\n      // Reconsider this strategy. It disallows legitimate structures on\n      // non - objects, or more precisely, on objects not derived from a class\n      // or constructor function.\n      step === '__proto__' ||\n      step === 'constructor' ||\n      step === 'prototype'\n    ) {\n      throw new Error('Attempted prototype pollution disallowed.');\n    }\n    if (Array.isArray(it)) {\n      if (step === '-' && cursor === end) {\n        it.push(val);\n        return undefined;\n      }\n      p = toArrayIndexReference(it, step);\n      if (it.length > p) {\n        if (cursor === end) {\n          rem = it[p];\n          it[p] = val;\n          break;\n        }\n        it = it[p];\n      } else if (cursor === end && p === it.length) {\n        if (force) {\n          it.push(val);\n          return undefined;\n        }\n      } else if (force) {\n        it = it[p] = cursor === end ? val : {};\n      }\n    } else {\n      if (typeof it[step] === 'undefined') {\n        if (force) {\n          if (cursor === end) {\n            it[step] = val;\n            return undefined;\n          }\n          // if the next step is an array index, this step should be an array.\n          const n = Number(path[cursor + 1]);\n          if (\n            Number.isInteger(n) &&\n            toArrayIndexReference(it[step], n) !== -1\n          ) {\n            it = it[step] = [];\n            continue;\n          }\n          it = it[step] = {};\n          continue;\n        }\n        return undefined;\n      }\n      if (cursor === end) {\n        rem = it[step];\n        it[step] = val;\n        break;\n      }\n      it = it[step];\n    }\n  }\n  return rem;\n}\n\nexport function unsetValueAtPath(target: unknown, path: PathSegments): unknown {\n  if (path.length === 0) {\n    throw new Error('Cannot unset the root object; assign it directly.');\n  }\n  if (typeof target === 'undefined') {\n    throw new TypeError('Cannot unset values on undefined');\n  }\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  let it: any = target;\n  const len = path.length;\n  const end = path.length - 1;\n  let step: PathSegment;\n  let cursor = -1;\n  let rem: unknown;\n  let p: number;\n  while (++cursor < len) {\n    step = path[cursor];\n    if (typeof step !== 'string' && typeof step !== 'number') {\n      throw new TypeError('PathSegments must be a string or a number.');\n    }\n    if (\n      step === '__proto__' ||\n      step === 'constructor' ||\n      step === 'prototype'\n    ) {\n      throw new Error('Attempted prototype pollution disallowed.');\n    }\n    if (Array.isArray(it)) {\n      p = toArrayIndexReference(it, step);\n      if (p >= it.length) return undefined;\n      if (cursor === end) {\n        rem = it[p];\n        delete it[p];\n        break;\n      }\n      it = it[p];\n    } else {\n      if (typeof it[step] === 'undefined') {\n        return undefined;\n      }\n      if (cursor === end) {\n        rem = it[step];\n        delete it[step];\n        break;\n      }\n      it = it[step];\n    }\n  }\n  return rem;\n}\n\nexport function looksLikeFragment(ptr: Pointer): boolean {\n  return typeof ptr === 'string' && ptr.length > 0 && ptr[0] === '#';\n}\n\nexport function pickDecoder(ptr: Pointer): Decoder {\n  return looksLikeFragment(ptr) ? decodeUriFragmentIdentifier : decodePointer;\n}\n\nexport function decodePtrInit(ptr: Pointer | PathSegments): PathSegments {\n  return Array.isArray(ptr)\n    ? ptr.slice(0)\n    : pickDecoder(ptr as Pointer)(ptr as Pointer);\n}\n", "import {\n  Dereference,\n  decodePtrInit,\n  compilePointerDereference,\n  setValueAtPath,\n  encodePointer,\n  encodeUriFragmentIdentifier,\n  pickDecoder,\n  unsetValueAtPath,\n  decodeRelativePointer,\n} from './util';\nimport {\n  JsonStringPointer,\n  UriFragmentIdentifierPointer,\n  Pointer,\n  RelativeJsonPointer,\n  PathSegments,\n  Encoder,\n  JsonStringPointerListItem,\n  UriFragmentIdentifierPointerListItem,\n} from './types';\n\n/**\n * Determines if the value is an object (not null)\n * @param value the value\n * @returns true if the value is a non-null object; otherwise false.\n *\n * @hidden\n */\nfunction isObject(value: unknown): boolean {\n  return typeof value === 'object' && value !== null;\n}\n\n/**\n * Signature of visitor functions, used with [[JsonPointer.visit]] method. Visitors are callbacks invoked for every segment/branch of a target's object graph.\n *\n * Tree descent occurs in-order, breadth first.\n */\nexport type Visitor = (ptr: JsonStringPointer, val: unknown) => void;\n\n/** @hidden */\ninterface Item {\n  obj: unknown;\n  path: PathSegments;\n}\n\n/** @hidden */\nfunction shouldDescend(obj: unknown): boolean {\n  return isObject(obj) && !JsonReference.isReference(obj);\n}\n/** @hidden */\nfunction descendingVisit(\n  target: unknown,\n  visitor: Visitor,\n  encoder: Encoder,\n): void {\n  const distinctObjects = new Map<unknown, JsonPointer>();\n  const q: Item[] = [{ obj: target, path: [] }];\n  while (q.length) {\n    const { obj, path } = q.shift() as Item;\n    visitor(encoder(path), obj);\n    if (shouldDescend(obj)) {\n      distinctObjects.set(\n        obj,\n        new JsonPointer(encodeUriFragmentIdentifier(path)),\n      );\n      if (!Array.isArray(obj)) {\n        const keys = Object.keys(obj as Record<string, unknown>);\n        const len = keys.length;\n        let i = -1;\n        while (++i < len) {\n          const it = (obj as Record<string, unknown>)[keys[i]];\n          if (isObject(it) && distinctObjects.has(it)) {\n            q.push({\n              obj: new JsonReference(distinctObjects.get(it) as JsonPointer),\n              path: path.concat(keys[i]),\n            });\n          } else {\n            q.push({\n              obj: it,\n              path: path.concat(keys[i]),\n            });\n          }\n        }\n      } else {\n        // handleArray\n        let j = -1;\n        const len = obj.length;\n        while (++j < len) {\n          const it = obj[j];\n          if (isObject(it) && distinctObjects.has(it)) {\n            q.push({\n              obj: new JsonReference(distinctObjects.get(it) as JsonPointer),\n              path: path.concat([j + '']),\n            });\n          } else {\n            q.push({\n              obj: it,\n              path: path.concat([j + '']),\n            });\n          }\n        }\n      }\n    }\n  }\n}\n\n/** @hidden */\nconst $ptr = Symbol('pointer');\n/** @hidden */\nconst $frg = Symbol('fragmentId');\n/** @hidden */\nconst $get = Symbol('getter');\n\n/**\n * Represents a JSON Pointer, capable of getting and setting the value on target\n * objects at the pointer's location.\n *\n * While there are static variants for most operations, our recommendation is\n * to use the instance level methods, which enables you avoid repeated\n * compiling/emitting transient accessors. Take a look at the speed comparisons\n * for our justification.\n *\n * In most cases, you should create and reuse instances of JsonPointer within\n * scope that makes sense for your app. We often create constants for frequently\n * used pointers, but your use case may vary.\n *\n * The following is a contrived example showing a function that uses pointers to\n * deal with changes in the structure of data (a version independent function):\n *\n * ```ts\n * import { JsonPointer } from 'json-ptr';\n *\n * export type SupportedVersion = '1.0' | '1.1';\n *\n * interface PrimaryGuestNamePointers {\n *   name: JsonPointer;\n *   surname: JsonPointer;\n *   honorific: JsonPointer;\n * }\n * const versions: Record<SupportedVersion, PrimaryGuestNamePointers> = {\n *   '1.0': {\n *     name: JsonPointer.create('/guests/0/name'),\n *     surname: JsonPointer.create('/guests/0/surname'),\n *     honorific: JsonPointer.create('/guests/0/honorific'),\n *   },\n *   '1.1': {\n *     name: JsonPointer.create('/primary/primaryGuest/name'),\n *     surname: JsonPointer.create('/primary/primaryGuest/surname'),\n *     honorific: JsonPointer.create('/primary/primaryGuest/honorific'),\n *   }\n * };\n *\n * interface Reservation extends Record<string, unknown> {\n *   version?: SupportedVersion;\n * }\n *\n * function primaryGuestName(reservation: Reservation): string {\n *   const pointers = versions[reservation.version || '1.0'];\n *   const name = pointers.name.get(reservation) as string;\n *   const surname = pointers.surname.get(reservation) as string;\n *   const honorific = pointers.honorific.get(reservation) as string;\n *   const names: string[] = [];\n *   if (honorific) names.push(honorific);\n *   if (name) names.push(name);\n *   if (surname) names.push(surname);\n *   return names.join(' ');\n * }\n *\n * // The original layout of a reservation (only the parts relevant to our example)\n * const reservationV1: Reservation = {\n *   guests: [{\n *     name: 'Wilbur',\n *     surname: 'Finkle',\n *     honorific: 'Mr.'\n *   }, {\n *     name: 'Wanda',\n *     surname: 'Finkle',\n *     honorific: 'Mrs.'\n *   }, {\n *     name: 'Wilma',\n *     surname: 'Finkle',\n *     honorific: 'Miss',\n *     child: true,\n *     age: 12\n *   }]\n *   // ...\n * };\n *\n * // The new layout of a reservation (only the parts relevant to our example)\n * const reservationV1_1: Reservation = {\n *   version: '1.1',\n *   primary: {\n *     primaryGuest: {\n *       name: 'Wilbur',\n *       surname: 'Finkle',\n *       honorific: 'Mr.'\n *     },\n *     additionalGuests: [{\n *       name: 'Wanda',\n *       surname: 'Finkle',\n *       honorific: 'Mrs.'\n *     }, {\n *       name: 'Wilma',\n *       surname: 'Finkle',\n *       honorific: 'Miss',\n *       child: true,\n *       age: 12\n *     }]\n *     // ...\n *   }\n *   // ...\n * };\n *\n * console.log(primaryGuestName(reservationV1));\n * console.log(primaryGuestName(reservationV1_1));\n *\n * ```\n *\n * There are many uses for pointers.\n */\nexport class JsonPointer {\n  /** @hidden */\n  private [$ptr]: JsonStringPointer;\n  /** @hidden */\n  private [$frg]: UriFragmentIdentifierPointer;\n  /** @hidden */\n  private [$get]: Dereference;\n\n  /**\n   * Factory function that creates a JsonPointer instance.\n   *\n   * ```ts\n   * const ptr = JsonPointer.create('/deeply/nested/data/0/here');\n   * ```\n   * _or_\n   * ```ts\n   * const ptr = JsonPointer.create(['deeply', 'nested', 'data', 0, 'here']);\n   * ```\n   * @param pointer the pointer or path.\n   */\n  static create(pointer: Pointer | PathSegments): JsonPointer {\n    return new JsonPointer(pointer);\n  }\n\n  /**\n   * Determines if the specified `target`'s object graph has a value at the `pointer`'s location.\n   *\n   * ```ts\n   * const target = {\n   *   first: 'second',\n   *   third: ['fourth', 'fifth', { sixth: 'seventh' }],\n   *   eighth: 'ninth'\n   * };\n   *\n   * console.log(JsonPointer.has(target, '/third/0'));\n   * // true\n   * console.log(JsonPointer.has(target, '/tenth'));\n   * // false\n   * ```\n   *\n   * @param target the target of the operation\n   * @param pointer the pointer or path\n   */\n  static has(\n    target: unknown,\n    pointer: Pointer | PathSegments | JsonPointer,\n  ): boolean {\n    if (typeof pointer === 'string' || Array.isArray(pointer)) {\n      pointer = new JsonPointer(pointer);\n    }\n    return (pointer as JsonPointer).has(target);\n  }\n\n  /**\n   * Gets the `target` object's value at the `pointer`'s location.\n   *\n   * ```ts\n   * const target = {\n   *   first: 'second',\n   *   third: ['fourth', 'fifth', { sixth: 'seventh' }],\n   *   eighth: 'ninth'\n   * };\n   *\n   * console.log(JsonPointer.get(target, '/third/2/sixth'));\n   * // seventh\n   * console.log(JsonPointer.get(target, '/tenth'));\n   * // undefined\n   * ```\n   *\n   * @param target the target of the operation\n   * @param pointer the pointer or path.\n   */\n  static get(\n    target: unknown,\n    pointer: Pointer | PathSegments | JsonPointer,\n  ): unknown {\n    if (typeof pointer === 'string' || Array.isArray(pointer)) {\n      pointer = new JsonPointer(pointer);\n    }\n    return (pointer as JsonPointer).get(target);\n  }\n\n  /**\n   * Sets the `target` object's value, as specified, at the `pointer`'s location.\n   *\n   * ```ts\n   * const target = {\n   *   first: 'second',\n   *   third: ['fourth', 'fifth', { sixth: 'seventh' }],\n   *   eighth: 'ninth'\n   * };\n   *\n   * console.log(JsonPointer.set(target, '/third/2/sixth', 'tenth'));\n   * // seventh\n   * console.log(JsonPointer.set(target, '/tenth', 'eleventh', true));\n   * // undefined\n   * console.log(JSON.stringify(target, null, ' '));\n   * // {\n   * // \"first\": \"second\",\n   * // \"third\": [\n   * //  \"fourth\",\n   * //  \"fifth\",\n   * //  {\n   * //   \"sixth\": \"tenth\"\n   * //  }\n   * // ],\n   * // \"eighth\": \"ninth\",\n   * // \"tenth\": \"eleventh\"\n   * // }\n   * ```\n   *\n   * @param target the target of the operation\n   * @param pointer the pointer or path\n   * @param val a value to write into the object graph at the specified pointer location\n   * @param force indications whether the operation should force the pointer's location into existence in the object graph.\n   *\n   * @returns the prior value at the pointer's location in the object graph.\n   */\n  static set(\n    target: unknown,\n    pointer: Pointer | PathSegments | JsonPointer,\n    val: unknown,\n    force = false,\n  ): unknown {\n    if (typeof pointer === 'string' || Array.isArray(pointer)) {\n      pointer = new JsonPointer(pointer);\n    }\n    return (pointer as JsonPointer).set(target, val, force);\n  }\n\n  /**\n   * Removes the `target` object's value at the `pointer`'s location.\n   *\n   * ```ts\n   * const target = {\n   *   first: 'second',\n   *   third: ['fourth', 'fifth', { sixth: 'seventh' }],\n   *   eighth: 'ninth'\n   * };\n   *\n   * console.log(JsonPointer.unset(target, '/third/2/sixth'));\n   * // seventh\n   * console.log(JsonPointer.unset(target, '/tenth'));\n   * // undefined\n   * console.log(JSON.stringify(target, null, ' '));\n   * // {\n   * // \"first\": \"second\",\n   * // \"third\": [\n   * //  \"fourth\",\n   * //  \"fifth\",\n   * //  {}\n   * // ],\n   * // \"eighth\": \"ninth\",\n   * // }\n   * ```\n   * @param target the target of the operation\n   * @param pointer the pointer or path\n   *\n   * @returns the value that was removed from the object graph.\n   */\n  static unset(\n    target: unknown,\n    pointer: Pointer | PathSegments | JsonPointer,\n  ): unknown {\n    if (typeof pointer === 'string' || Array.isArray(pointer)) {\n      pointer = new JsonPointer(pointer);\n    }\n    return (pointer as JsonPointer).unset(target);\n  }\n\n  /**\n   * Decodes the specified pointer into path segments.\n   * @param pointer a string representation of a JSON Pointer\n   */\n  static decode(pointer: Pointer): PathSegments {\n    return pickDecoder(pointer)(pointer);\n  }\n\n  /**\n   * Evaluates the target's object graph, calling the specified visitor for every unique pointer location discovered while walking the graph.\n   * @param target the target of the operation\n   * @param visitor a callback function invoked for each unique pointer location in the object graph\n   * @param fragmentId indicates whether the visitor should receive fragment identifiers or regular pointers\n   */\n  static visit(target: unknown, visitor: Visitor, fragmentId = false): void {\n    descendingVisit(\n      target,\n      visitor,\n      fragmentId ? encodeUriFragmentIdentifier : encodePointer,\n    );\n  }\n\n  /**\n   * Evaluates the target's object graph, returning a [[JsonStringPointerListItem]] for each location in the graph.\n   * @param target the target of the operation\n   */\n  static listPointers(target: unknown): JsonStringPointerListItem[] {\n    const res: JsonStringPointerListItem[] = [];\n    descendingVisit(\n      target,\n      (pointer, value): void => {\n        res.push({ pointer, value });\n      },\n      encodePointer,\n    );\n    return res;\n  }\n\n  /**\n   * Evaluates the target's object graph, returning a [[UriFragmentIdentifierPointerListItem]] for each location in the graph.\n   * @param target the target of the operation\n   */\n  static listFragmentIds(\n    target: unknown,\n  ): UriFragmentIdentifierPointerListItem[] {\n    const res: UriFragmentIdentifierPointerListItem[] = [];\n    descendingVisit(\n      target,\n      (fragmentId, value): void => {\n        res.push({ fragmentId, value });\n      },\n      encodeUriFragmentIdentifier,\n    );\n    return res;\n  }\n\n  /**\n   * Evaluates the target's object graph, returning a Record&lt;Pointer, unknown> populated with pointers and the corresponding values from the graph.\n   * @param target the target of the operation\n   * @param fragmentId indicates whether the results are populated with fragment identifiers rather than regular pointers\n   */\n  static flatten(\n    target: unknown,\n    fragmentId = false,\n  ): Record<Pointer, unknown> {\n    const res: Record<Pointer, unknown> = {};\n    descendingVisit(\n      target,\n      (p, v) => {\n        res[p] = v;\n      },\n      fragmentId ? encodeUriFragmentIdentifier : encodePointer,\n    );\n    return res;\n  }\n\n  /**\n   * Evaluates the target's object graph, returning a Map&lt;Pointer,unknown>  populated with pointers and the corresponding values form the graph.\n   * @param target the target of the operation\n   * @param fragmentId indicates whether the results are populated with fragment identifiers rather than regular pointers\n   */\n  static map(target: unknown, fragmentId = false): Map<Pointer, unknown> {\n    const res = new Map<Pointer, unknown>();\n    descendingVisit(\n      target,\n      res.set.bind(res),\n      fragmentId ? encodeUriFragmentIdentifier : encodePointer,\n    );\n    return res;\n  }\n\n  /**\n   * The pointer's decoded path segments.\n   */\n  public readonly path: PathSegments;\n\n  /**\n   * Creates a new instance.\n   * @param ptr a string representation of a JSON Pointer, or a decoded array of path segments.\n   */\n  constructor(ptr: Pointer | PathSegments) {\n    this.path = decodePtrInit(ptr);\n  }\n\n  /**\n   * Gets the target object's value at the pointer's location.\n   * @param target the target of the operation\n   */\n  get(target: unknown): unknown {\n    if (!this[$get]) {\n      this[$get] = compilePointerDereference(this.path);\n    }\n    return this[$get](target);\n  }\n\n  /**\n   * Sets the target object's value, as specified, at the pointer's location.\n   *\n   * If any part of the pointer's path does not exist, the operation aborts\n   * without modification, unless the caller indicates that pointer's location\n   * should be created.\n   *\n   * @param target the target of the operation\n   * @param value the value to set\n   * @param force indicates whether the pointer's location should be created if it doesn't already exist.\n   */\n  set(target: unknown, value: unknown, force = false): unknown {\n    return setValueAtPath(target, value, this.path, force);\n  }\n\n  /**\n   * Removes the target object's value at the pointer's location.\n   * @param target the target of the operation\n   *\n   * @returns the value that was removed from the object graph.\n   */\n  unset(target: unknown): unknown {\n    return unsetValueAtPath(target, this.path);\n  }\n\n  /**\n   * Determines if the specified target's object graph has a value at the pointer's location.\n   * @param target the target of the operation\n   */\n  has(target: unknown): boolean {\n    return typeof this.get(target) !== 'undefined';\n  }\n\n  /**\n   * Gets the value in the object graph that is the parent of the pointer location.\n   * @param target the target of the operation\n   */\n  parent(target: unknown): unknown {\n    const p = this.path;\n    if (p.length == 1) return undefined;\n    const parent = new JsonPointer(p.slice(0, p.length - 1));\n    return parent.get(target);\n  }\n\n  /**\n   * Creates a new JsonPointer instance, pointing to the specified relative location in the object graph.\n   * @param ptr the relative pointer (relative to this)\n   * @returns A new instance that points to the relative location.\n   */\n  relative(ptr: RelativeJsonPointer): JsonPointer {\n    const p = this.path;\n    const decoded = decodeRelativePointer(ptr) as string[];\n    const n = parseInt(decoded[0]);\n    if (n > p.length) throw new Error('Relative location does not exist.');\n    const r = p.slice(0, p.length - n).concat(decoded.slice(1));\n    if (decoded[0][decoded[0].length - 1] == '#') {\n      // It references the path segment/name, not the value\n      const name = r[r.length - 1] as string;\n      throw new Error(\n        `We won't compile a pointer that will always return '${name}'. Use JsonPointer.rel(target, ptr) instead.`,\n      );\n    }\n    return new JsonPointer(r);\n  }\n\n  /**\n   * Resolves the specified relative pointer path against the specified target object, and gets the target object's value at the relative pointer's location.\n   * @param target the target of the operation\n   * @param ptr the relative pointer (relative to this)\n   * @returns the value at the relative pointer's resolved path; otherwise undefined.\n   */\n  rel(target: unknown, ptr: RelativeJsonPointer): unknown {\n    const p = this.path;\n    const decoded = decodeRelativePointer(ptr) as string[];\n    const n = parseInt(decoded[0]);\n    if (n > p.length) {\n      // out of bounds\n      return undefined;\n    }\n    const r = p.slice(0, p.length - n).concat(decoded.slice(1));\n    const other = new JsonPointer(r);\n    if (decoded[0][decoded[0].length - 1] == '#') {\n      // It references the path segment/name, not the value\n      const name = r[r.length - 1] as string;\n      const parent = other.parent(target);\n      return Array.isArray(parent) ? parseInt(name, 10) : name;\n    }\n    return other.get(target);\n  }\n\n  /**\n   * Creates a new instance by concatenating the specified pointer's path onto this pointer's path.\n   * @param ptr the string representation of a pointer, it's decoded path, or an instance of JsonPointer indicating the additional path to concatenate onto the pointer.\n   */\n  concat(ptr: JsonPointer | Pointer | PathSegments): JsonPointer {\n    return new JsonPointer(\n      this.path.concat(\n        ptr instanceof JsonPointer ? ptr.path : decodePtrInit(ptr),\n      ),\n    );\n  }\n\n  /**\n   * This pointer's JSON Pointer encoded string representation.\n   */\n  get pointer(): JsonStringPointer {\n    if (this[$ptr] === undefined) {\n      this[$ptr] = encodePointer(this.path);\n    }\n    return this[$ptr];\n  }\n\n  /**\n   * This pointer's URI fragment identifier encoded string representation.\n   */\n  get uriFragmentIdentifier(): UriFragmentIdentifierPointer {\n    if (!this[$frg]) {\n      this[$frg] = encodeUriFragmentIdentifier(this.path);\n    }\n    return this[$frg];\n  }\n\n  /**\n   * Emits the JSON Pointer encoded string representation.\n   */\n  toString(): string {\n    return this.pointer;\n  }\n}\n\n/** @hidden */\nconst $pointer = Symbol('pointer');\n\n/**\n * A reference to a location in an object graph.\n *\n * This type is used by this module to break cycles in an object graph and to\n * reference locations that have already been visited when enumerating pointers.\n */\nexport class JsonReference {\n  /**\n   * Determines if the specified `candidate` is a JsonReference.\n   * @param candidate the candidate\n   */\n  static isReference(candidate: unknown): candidate is JsonReference {\n    if (!candidate) return false;\n    const ref = candidate as unknown as JsonReference;\n    return typeof ref.$ref === 'string' && typeof ref.resolve === 'function';\n  }\n\n  /** @hidden */\n  private readonly [$pointer]: JsonPointer;\n\n  /**\n   * A reference to a position if an object graph.\n   */\n  public readonly $ref: UriFragmentIdentifierPointer;\n\n  /**\n   * Creates a new instance.\n   * @param pointer a JSON Pointer for the reference.\n   */\n  constructor(pointer: JsonPointer | Pointer | PathSegments) {\n    this[$pointer] =\n      pointer instanceof JsonPointer ? pointer : new JsonPointer(pointer);\n    this.$ref = this[$pointer].uriFragmentIdentifier;\n  }\n\n  /**\n   * Resolves the reference against the `target` object, returning the value at\n   * the referenced pointer's location.\n   * @param target the target object\n   */\n  resolve(target: unknown): unknown {\n    return this[$pointer].get(target);\n  }\n\n  /**\n   * Gets the reference's pointer.\n   */\n  pointer(): JsonPointer {\n    return this[$pointer];\n  }\n\n  /**\n   * Gets the reference pointer's string representation (a URI fragment identifier).\n   */\n  toString(): string {\n    return this.$ref;\n  }\n}\n", "import type m from 'mithril';\nimport { selectionFactory } from '../factories/selectionFactory.ts';\nimport type { CommonRendererArgs, OctironSelectArgs, OctironSelection, SelectionParentArgs, SelectView, TypeDefs } from '../types/octiron.ts';\nimport type { EntityState } from '../types/store.ts';\nimport type { Store } from \"../store.ts\";\nimport type { Mutable } from \"../types/common.ts\";\n\nexport type ActionRendererRef = {\n  submitting: boolean;\n  submitResult?: EntityState;\n  store: Store;\n  typeDefs: TypeDefs;\n};\n\nexport type ActionStateRendererAttrs = {\n  not?: boolean;\n  type: 'initial' | 'success' | 'failure';\n  children?: m.Children;\n  selector?: string;\n  args: OctironSelectArgs;\n  view?: SelectView;\n  submitResult?: EntityState;\n  parentArgs: SelectionParentArgs,\n};\n\nexport const ActionStateRenderer: m.ClosureComponent<ActionStateRendererAttrs> = () => {\n  let submitResult: EntityState | undefined;\n  let o: OctironSelection | undefined;\n\n  function setInstance(attrs: ActionStateRendererAttrs) {\n    if (attrs.submitResult == null) {\n      submitResult = undefined;\n      o = undefined;\n    } else if (\n      submitResult == null ||\n      attrs.submitResult.ok !== submitResult.ok ||\n      attrs.submitResult.status !== submitResult.status ||\n      attrs.submitResult.value !== submitResult.value\n    ) {\n      submitResult = attrs.submitResult;\n\n      const rendererArgs: CommonRendererArgs = {\n        index: 0,\n        value: attrs.submitResult.value,\n      }\n      o = selectionFactory(\n        attrs.args,\n        attrs.parentArgs,\n        rendererArgs,\n      );\n    }\n  }\n\n  return {\n    oninit: ({ attrs }) => {\n      setInstance(attrs);\n    },\n    onbeforeupdate: ({ attrs }) => {\n      setInstance(attrs);\n    },\n    view: ({ attrs: { type, selector, args, view, ...attrs }, children }) => {\n      if (type === 'initial' && submitResult == null) {\n        return children;\n      } else if (submitResult == null || o == null) {\n        return null;\n      }\n\n      let shouldRender = (type === 'success' && submitResult.ok) ||\n        (type === 'failure' && !submitResult.ok);\n\n      if (attrs.not) {\n        shouldRender = !shouldRender;\n      }\n\n      (o as Mutable<OctironSelection>).position = 1;\n\n      if (shouldRender && selector != null) {\n        return o.select(selector, args as OctironSelectArgs, view as SelectView);\n      } else if (shouldRender && view != null) {\n        return view(o);\n      } else if (shouldRender && args != null) {\n        return o.present(args);\n      }\n\n      (o as Mutable<OctironSelection>).position = -1\n\n      return null;\n    },\n  };\n};\n", "import uriTemplates from 'uri-templates';\nimport type { JSONObject, SCMAction } from '../types/common.ts';\nimport { isJSONObject } from './isJSONObject.ts';\nimport { isTypeObject } from \"./isTypedObject.ts\";\n\n\nexport type SubmitDetails = {\n  url: string;\n  method: string;\n  contentType?: string;\n  encodingType?: string;\n  body?: string;\n};\n\n/**\n * Gets the details on how to perform a submission\n * based off an action, payload and other context.\n *\n * @param args.payload The current payload value.\n * @param args.action The schema.org styled action object.\n */\nexport function getSubmitDetails({\n  payload,\n  action,\n}: {\n  payload: JSONObject;\n  action: SCMAction;\n}): SubmitDetails {\n  let urlTemplate: string | undefined;\n  let body: string | undefined;\n  let method: string = 'get';\n  let contentType: string | undefined;\n  let encodingType: string | undefined;\n  let target = action['https://schema.org/target'];\n\n  if (Array.isArray(target)) {\n    for (const item of target) {\n      if (item === 'string') {\n        target = item;\n        break;\n      } else if (\n        isJSONObject(target) && (\n          target['https://schema.org/contentType'] == null || (\n            target['https://schema.org/contentType'] === 'mutipart/form-data' ||\n            target['https://schema.org/contentType'] === 'application/ld+json'\n          )\n        )\n      ) {\n        target = item;\n        break;\n      }\n    }\n  }\n\n  if (typeof target === 'string') {\n    urlTemplate = target;\n  } else if (isJSONObject(target)) {\n    if (typeof target['https://schema.org/urlTemplate'] === 'string') {\n      urlTemplate = target['https://schema.org/urlTemplate'];\n    }\n\n    if (typeof target['https://schema.org/httpMethod'] === 'string') {\n      method = target['https://schema.org/httpMethod'].toLowerCase();\n    }\n\n    if (typeof target['https://schema.org/contentType'] === 'string') {\n      contentType = target['https://schema.org/contentType'];\n    }\n\n    if (typeof target['https://schema.org/encodingType'] === 'string') {\n      encodingType = target['https://schema.org/encodingType'];\n    }\n  }\n\n  if (typeof urlTemplate !== 'string') {\n    throw new Error('Action has invalid https://schema.org/target');\n  }\n\n  const fillArgs: JSONObject = {};\n\n  const submitBody = Object.assign({}, payload);\n\n  for (const [type, value] of Object.entries(action)) {\n    if (!isTypeObject(value) ||\n        value['@type'] !== 'https://schema.org/PropertyValueSpecification') {\n      continue;\n    }\n\n    const valueName = value['https://schema.org/valueName'] as string;\n\n    if (valueName != null) {\n      const propType = type.replace(/-input$/, '');\n\n      fillArgs[valueName] = payload[propType];\n      delete submitBody[valueName];\n    }\n  }\n\n  const template = uriTemplates(urlTemplate);\n\n  // deno-lint-ignore no-explicit-any\n  const url: string = template.fill(fillArgs as any);\n\n  // only add body if supporting HTTP method\n  if (method !== 'get' && method !== 'delete') {\n    body = JSON.stringify(submitBody);\n  } else {\n    contentType = undefined\n    encodingType = undefined\n  }\n\n  return {\n    url,\n    method,\n    contentType,\n    encodingType,\n    body,\n  };\n}\n", "import { JsonPointer } from 'json-ptr';\nimport m from 'mithril';\nimport { EditRenderer } from '../renderers/EditRenderer.ts';\nimport { ActionSelectionRenderer } from \"../renderers/ActionSelectionRenderer.ts\";\nimport type { JSONObject, JSONValue } from \"../types/common.ts\";\nimport type { Spec, ActionSelectionParentArgs, ActionSelectionRendererArgs, ActionSelectView, BaseAttrs, CommonParentArgs, CommonRendererArgs, EditComponent, OctironActionSelection, OctironActionSelectionArgs, OctironDefaultArgs, OctironEditArgs, OctironPresentArgs, PayloadValueMapper, Selector, UpdateArgs } from \"../types/octiron.ts\";\nimport { isJSONObject } from \"../utils/isJSONObject.ts\";\nimport { mithrilRedraw } from \"../utils/mithrilRedraw.ts\";\nimport { unravelArgs } from \"../utils/unravelArgs.ts\";\nimport { type ChildArgs, type CommonArgs, type InstanceHooks, octironFactory } from \"./octironFactory.ts\";\nimport { isIterable } from \"../utils/isIterable.ts\";\nimport { getIterableValue } from \"../utils/getIterableValue.ts\";\nimport { selectComponentFromArgs } from \"../utils/selectComponentFromArgs.ts\";\nimport {expandValue} from '../utils/expandValue.ts';\n\n\nexport type OnActionSelectionSubmit = () => Promise<void>;\n\nexport type OnActionSelectionUpdate = (\n  pointer: string,\n  value: JSONValue,\n  args?: UpdateArgs,\n) => void;\n\n\nexport function actionSelectionFactory<\n  // deno-lint-ignore no-explicit-any\n  Attrs extends Record<string, any> = Record<string, any>\n>(\n  args: OctironActionSelectionArgs<Attrs>,\n  parentArgs: ActionSelectionParentArgs,\n  rendererArgs: ActionSelectionRendererArgs,\n): OctironActionSelection & InstanceHooks {\n  const factoryArgs = Object.assign({}, args);\n  const childArgs: Partial<ChildArgs> = {\n    action: parentArgs.action,\n    submitting: parentArgs.submitting,\n    value: rendererArgs.value,\n  };\n\n  const self = octironFactory(\n    'action-selection',\n    factoryArgs as CommonArgs,\n    parentArgs as CommonParentArgs,\n    rendererArgs as CommonRendererArgs,\n    childArgs as ChildArgs,\n  );\n\n  self.readonly = rendererArgs.spec == null ? true : (rendererArgs.spec.readonly ?? false);\n  self.inputName = rendererArgs.spec?.name != null ? rendererArgs.spec?.name : rendererArgs.propType as string;\n  self.submitting = parentArgs.submitting;\n  self.action = parentArgs.action;\n\n  childArgs.updatePointer = (\n    pointer: string,\n    value: JSONValue,\n    args?: UpdateArgs,\n    interceptor = factoryArgs.interceptor,\n  ) => {\n    const prev = rendererArgs.value as JSONObject;\n\n    if (!isJSONObject(prev)) {\n      console.warn(`Non object action change intercepted.`);\n      return;\n    }\n\n    let next: Partial<JSONObject> = Object.assign({}, prev);\n    const ptr = JsonPointer.create(pointer);\n\n    if (value == null) {\n      ptr.unset(next);\n    } else {\n      ptr.set(next, value, true);\n    }\n\n    if (typeof interceptor === 'function') {\n      next = interceptor(next, prev, rendererArgs.actionValue?.value as JSONObject);\n    }\n\n    parentArgs.updatePointer(rendererArgs.pointer, next, args);\n  }\n\n  self.update = async (\n    arg1: PayloadValueMapper<JSONObject> | JSONObject,\n    args?: UpdateArgs,\n  ): Promise<void> => {\n    const value = rendererArgs.value;\n\n    if (!isJSONObject(value)) {\n      throw new Error(`Cannot call update on a non object selection instance`);\n    }\n\n    if (typeof arg1 === 'function') {\n      rendererArgs.update(arg1(value));\n    } else if (arg1 != null) {\n      rendererArgs.update(arg1);\n    }\n\n    if (args?.submit || args?.submitOnChange) {\n      await parentArgs.submit();\n    } else {\n      mithrilRedraw();\n    }\n  };\n\n  self.submit = (): Promise<void> => {\n    return parentArgs.submit();\n  };\n\n  self.select = (\n    arg1: Selector,\n    arg2?: OctironActionSelectionArgs | ActionSelectView,\n    arg3?: ActionSelectView,\n  ): m.Children => {\n    if (!isJSONObject(rendererArgs.value)) {\n      return null;\n    }\n\n    const [selector, args, view] = unravelArgs(arg1, arg2, arg3);\n\n    return m(\n      ActionSelectionRenderer,\n      {\n        parentArgs: childArgs as ActionSelectionParentArgs,\n        selector,\n        value: rendererArgs.value,\n        actionValue: rendererArgs.actionValue.value as JSONObject,\n        args,\n        view,\n      },\n    );\n  };\n\n  self.edit = (\n    args?: OctironEditArgs<BaseAttrs>,\n  ): m.Children => {\n    if (self.readonly) {\n      return self.present(args as OctironPresentArgs<BaseAttrs>);\n    }\n\n    return m(EditRenderer, {\n      o: self,\n      args,\n      factoryArgs,\n      parentArgs,\n      rendererArgs,\n    });\n\n    const [attrs, component] = selectComponentFromArgs(\n      'edit',\n      parentArgs,\n      rendererArgs,\n      args,\n      factoryArgs as OctironEditArgs,\n    );\n\n    if (component == null) {\n      return null;\n    }\n\n    return m(component as EditComponent<JSONValue, BaseAttrs>, {\n      o: self as unknown as OctironActionSelection,\n      spec: rendererArgs.spec as Spec,\n      renderType: \"edit\",\n      name: self.inputName,\n      value: rendererArgs.value,\n      attrs,\n      onchange: rendererArgs.update,\n      onChange: rendererArgs.update,\n    });\n  };\n\n  self.default = (args?: OctironDefaultArgs<BaseAttrs>) => {\n    return self.edit(Object.assign({ component: null }, args) as OctironEditArgs<BaseAttrs>)\n  }\n\n  self.initial = parentArgs.action.initial;\n  self.success = parentArgs.action.success;\n  self.failure = parentArgs.action.failure;\n\n  self.remove = (\n    _args: UpdateArgs = {},\n  ) => {\n    if (rendererArgs.propType == null) {\n      return;\n    }\n\n    const parentValue = parentArgs.parent.value as JSONObject;\n    const value = parentValue[rendererArgs.propType];\n\n    if (isIterable(value)) {\n      const arrValue = getIterableValue(value);\n\n      arrValue.splice(self.index, 1);\n\n      if (arrValue.length === 0) {\n        delete parentValue[rendererArgs.propType];\n      }\n    } else if (isJSONObject(value)) {\n      delete parentValue[rendererArgs.propType];\n    }\n\n    mithrilRedraw()\n  };\n\n  self.append = (\n    termOrType: string,\n    value: JSONValue = {},\n    args: UpdateArgs = {},\n  ) => {\n    if (!isJSONObject(rendererArgs.value)) {\n      console.warn(`Attempt to append to non object octiron selection ${termOrType}`);\n      return;\n    }\n\n    let nextValue: JSONValue;\n    const type = parentArgs.store.expand(termOrType);\n    const lastValue = rendererArgs.value[type];\n\n    if (isJSONObject(value)) {\n      value = expandValue(self.store, value);\n    }\n\n    if (lastValue == null) {\n      nextValue = value;\n    } else if (Array.isArray(lastValue)) {\n      nextValue = [...lastValue, value];\n    } else {\n      nextValue = [lastValue, value];\n    }\n\n    return parentArgs.updatePointer(\n      rendererArgs.pointer,\n      Object.assign({}, rendererArgs.value, { [type]: nextValue }),\n      args,\n    );\n  };\n\n  return self as unknown as OctironActionSelection & InstanceHooks;\n}\n\n", "import m from 'mithril';\nimport type { Spec, OctironActionSelection, OctironEditArgs, ActionSelectionParentArgs, ActionSelectionRendererArgs } from '../types/octiron.ts';\nimport { selectComponentFromArgs } from '../utils/selectComponentFromArgs.ts';\n\n\nexport type EditRendererAttrs = {\n  o: OctironActionSelection;\n  args: OctironEditArgs;\n  factoryArgs: OctironEditArgs;\n  parentArgs: ActionSelectionParentArgs;\n  rendererArgs: ActionSelectionRendererArgs;\n};\n\nexport const EditRenderer: m.ComponentTypes<EditRendererAttrs> = ({\n  attrs: {\n    args,\n    factoryArgs,\n    parentArgs,\n    rendererArgs,\n  },\n}) => {\n  const [attrs, component] = selectComponentFromArgs(\n    'edit',\n    parentArgs,\n    rendererArgs,\n    args,\n    factoryArgs,\n  );\n\n  return {\n    //onbeforeupdate({ attrs: { args, factoryArgs, parentArgs, rendererArgs }}) {\n      // [attrs, component] = selectComponentFromArgs(\n      //   'present',\n      //   parentArgs,\n      //   rendererArgs,\n      //   args,\n      //   factoryArgs,\n      // );\n    //},\n    view({ attrs: { o, rendererArgs }, children }) {\n      if (component == null) {\n        return null;\n      }\n\n      // deno-lint-ignore no-explicit-any\n      return m(component as any, {\n        o,\n        attrs,\n        renderType: \"edit\",\n        name: o.inputName,\n        value: rendererArgs.value,\n        spec: rendererArgs.spec as Spec,\n        onchange: rendererArgs.update,\n        onChange: rendererArgs.update,\n      }, children);\n    },\n  };\n};\n", "import type {JSONObject} from '../types/common.ts';\nimport type {Store} from '../store.ts';\n\n\n/**\n * Expands a object's keys to be their RDF type equivlent.\n *\n * @param store   - An Octiron store with expansion context.\n * @param value   - A JSON object to expand.\n */\nexport function expandValue(store: Store, value: JSONObject): JSONObject {\n  let expanded: JSONObject = {};\n\n  for (let [key, item] of Object.entries(value)) {\n    expanded[store.expand(key)] = item;\n  }\n\n  return expanded;\n}\n", "\n/**\n * @description\n * Espects a list of json pointer parts and returns a json pointer.\n */\nexport function escapeJSONPointerParts(...parts: string[]): string {\n  const escaped = parts\n    .map((part) => part.replace(/~/g, '~0').replace(/\\//g, '~1'))\n    .join('/');\n\n  return `${escaped}`;\n}\n", "import type { IRIObject, JSONObject, JSONValue } from \"../types/common.ts\";\nimport { isJSONObject } from \"./isJSONObject.ts\";\n\n\n/**\n * @description\n * Returns true if the given value is a JSON object with a JSON-ld @id value.\n *\n * @param value Any value which should come from a JSON source.\n */\nexport function isIRIObject<\n  Properties extends JSONObject = JSONObject\n>(value: JSONValue): value is IRIObject<Properties> {\n  return isJSONObject(value)\n    && typeof value['@id'] === 'string'\n    && value['@id'] !== '';\n}\n", "import type { IRIObject, JSONObject } from '../types/common.ts';\n\n/**\n * @description\n * Some JSON-ld objects contain special JSON-ld values, such as @type which\n * can inform the software on what to expect when retrieving the object but\n * otherwise require fetching an entity from an endpoint to get the values\n * they relate to. For Octiron's purposes these are considered metadata objects.\n *\n * Objects containing `@value`, `@list`, `@set` are not considered metadata\n * objects as these properties references concrete values.\n *\n * @param value - The JSON object to check for non special properties in.\n */\nexport function isMetadataObject(value: JSONObject): value is IRIObject {\n  const keys = Object.keys(value);\n\n  if (keys.length === 0) {\n    return false;\n  }\n\n  for (const term of keys) {\n    if (!term.startsWith(\"@\") ||\n      term === '@value' ||\n      term === '@list' ||\n      term === '@set') {\n      return false;\n    }\n  }\n\n  return true;\n}\n", "import type { JSONObject, ValueObject } from '../types/common.ts';\n\n/**\n * @description\n * A value object contains a `@value` value. Often this is used to provide\n * further information about the value like what `@type` it holds, allowing\n * filters to be applied to the referenced value.\n *\n * @param value - A JSON value.\n */\nexport function isValueObject(\n  value: JSONObject,\n): value is ValueObject {\n  return typeof value['@value'] !== 'undefined';\n}\n", "import type { Store } from \"../store.ts\";\n\nexport type SelectorObject = {\n  fragment?: string;\n  filter?: string;\n};\n\nconst selectorRe = /\\s*(?<subject>([^\\[\\s]+))(\\[(?<filter>([^\\]])+)\\])?\\s*/g;\n\n/**\n * @description\n * Parses a selector string producing a selector list\n * The subject value of a selector could be an iri or a type depending on the\n * outer context.\n *\n * @param selector - The selector string to parse.\n */\nexport function parseSelectorString(selector: string, store: Store): SelectorObject[] {\n  let match: RegExpExecArray | null;\n  const selectors: SelectorObject[] = [];\n\n  while ((match = selectorRe.exec(selector))) {\n    const subject = match.groups?.subject;\n    const filter = match.groups?.filter;\n\n    if (typeof filter === 'string' && typeof subject === 'string') {\n      selectors.push({\n        subject: store.expand(subject),\n        filter,\n      });\n    } else if (typeof subject === 'string') {\n      selectors.push({\n        subject: store.expand(subject),\n      });\n    } else {\n      throw new Error(`Invalid selector: ${selector}`);\n    }\n  }\n\n  return selectors;\n}\n", "\nimport type { Store } from \"../store.ts\";\nimport type { JSONObject, SCMPropertyValueSpecification } from '../types/common.ts';\nimport type { Spec } from '../types/octiron.ts';\n\nconst httpRe = /^https?\\:\\/\\//;\nconst scmCtxRe = /^https?\\:\\/\\/schema\\.org/;\nconst scmTypeRe = /^https?\\:\\/\\/schema\\.org\\/(?<term>(readonlyValue|valueName|valueRequired|defaultValue|minValue|maxValue|stepValue|valuePattern|multipleValues|valueMinLength|valueMaxLength))/;\n\nexport function resolvePropertyValueSpecification({\n  spec,\n  store,\n}: {\n  spec: JSONObject;\n  store: Store;\n}): Spec {\n  const pvs: SCMPropertyValueSpecification = {\n    readonlyValue: false,\n    valueRequired: false,\n  };\n\n  let scmAlias: [string, string] | undefined;\n  const scmVocab = store.vocab == null ? false : scmCtxRe.test(store.vocab);\n\n  for (const [key, value] of Object.entries(store.aliases)) {\n    if (scmCtxRe.test(value)) {\n      scmAlias = [key, value];\n\n      break;\n    }\n  }\n\n  for (const [term, value] of Object.entries(spec)) {\n    let type: string | undefined;\n\n    if (!httpRe.test(term)) {\n      if (scmVocab && !term.includes(':')) {\n        type = `${store.vocab}${term}`;\n      } else if (scmAlias && term.startsWith(`${scmAlias[0]}:`)) {\n        type = term.replace(`${scmAlias[0]}:`, scmAlias[1]);\n      }\n    } else {\n      type = term;\n    }\n\n    if (!type) {\n      continue;\n    }\n\n    const result = scmTypeRe.exec(type);\n\n    if (result?.groups?.term) {\n      (pvs as JSONObject)[result.groups.term] = value;\n    }\n  }\n\n  return {\n    readonly: pvs.readonlyValue,\n    required: pvs.valueRequired,\n    name: pvs.valueName,\n    min: pvs.minValue,\n    max: pvs.maxValue,\n    step: pvs.stepValue,\n    pattern: pvs.valuePattern,\n    multiple: pvs.multipleValues,\n    minLength: pvs.valueMinLength,\n    maxLength: pvs.valueMaxLength,\n  };\n}\n", "import type { JSONArray, JSONObject, JSONValue, Mutable, SCMPropertyValueSpecification } from '../types/common.ts';\nimport type { ActionSelectionResult, AlternativeSelectionResult, EntitySelectionResult, EntityState, IntegrationState, SelectionDetails, SelectionResult, ValueSelectionResult } from '../types/store.ts';\nimport { escapeJSONPointerParts } from './escapeJSONPointerParts.ts';\nimport { getIterableValue } from \"./getIterableValue.ts\";\nimport { isIRIObject } from \"./isIRIObject.ts\";\nimport { isIterable } from \"./isIterable.ts\";\nimport { isJSONObject } from './isJSONObject.ts';\nimport { isMetadataObject } from \"./isMetadataObject.ts\";\nimport { isValueObject } from \"./isValueObject.ts\";\nimport { parseSelectorString } from './parseSelectorString.ts';\nimport type { Store } from '../store.ts';\nimport { resolvePropertyValueSpecification } from \"./resolvePropertyValueSpecification.ts\";\nimport { isTypeObject } from \"./isTypedObject.ts\";\n\n/**\n * A circular selection error occurs when two or more\n * entities contain no concrete values and their '@id'\n * values point to each other in a way that creates a\n * loop. The `getSelection` function will throw when\n * this scenario is detected to prevent an infinite\n * loop.\n */\nexport class CircularSelectionError extends Error {}\n\nexport type SelectorObject = {\n  subject: string;\n  filter?: string;\n};\n\ntype SourceSelectionResults =\n  | EntitySelectionResult\n  | ValueSelectionResult\n  | IntegrationState\n;\n\ntype ProcessingEntitySelectionResult = {\n  // used to build the final key value.\n  keySource: string;\n} & Omit<EntitySelectionResult, 'key'>;\n\ntype ProcessingValueSelectionResult = {\n  // used to build the final key value.\n  keySource: string;\n} & Omit<ValueSelectionResult, 'key'>;\n\ntype ProcessingActionSelectionResult = {\n  // used to build the final key value.\n  keySource: string;\n} & Omit<ActionSelectionResult, 'key'>;\n\ntype ProcessingAlternativeSelectionResult = {\n  // used to build the final key value.\n  keySource: string;\n} & Omit<AlternativeSelectionResult, 'key'>;\n\ntype ProcessingSelectionDetails = SelectionDetails<\n  | ProcessingEntitySelectionResult\n  | ProcessingValueSelectionResult\n  | ProcessingActionSelectionResult\n  | ProcessingAlternativeSelectionResult\n>;\n\nexport function transformProcessedDetails<T extends SelectionResult>(\n  processing: ProcessingSelectionDetails,\n): SelectionDetails<T> {\n  for (let index = 0; index < processing.result.length; index++) {\n    const element = processing.result[index];\n\n    (element as unknown as Mutable<SourceSelectionResults>).key = Symbol.for(element.keySource);\n    delete (element as unknown as Mutable<{ keySource?: string }>).keySource;\n  }\n\n  return processing as unknown as SelectionDetails<T>;\n}\n\n/**\n * @description\n * Selects from the given context value and store state.\n *\n * If no `value` is provided the `selector` is assumed to begin with an iri\n * instead of a type. An entity will be selected from the store using the iri,\n * if it exists, to begin the selection.\n *\n * A type selector selects values from the context of a provided value\n * and will pull from the store if any iri objects are selected in the process.\n *\n * @param {string} args.selector            Selector string beginning with a type.\n * @param {string} [args.fragment]          A fragment if passed in as select args.\n * @param {JSONObject} [args.value]         Context object to begin the selection from.\n * @param {JSONObject} [args.actionValue]   The action, or point in the action definition which describes this value.\n * @param {JSONValue} [args.defaultValue]   A default value when used to select action values.\n * @param {Store} args.store                Octiron store to search using.\n * @returns {SelectionDetails}              Selection contained in a details object.\n */\nexport function getSelection<T extends SelectionResult>({\n  selector: selectorStr,\n  value,\n  fragment,\n  accept,\n  actionValue,\n  defaultValue,\n  store,\n}: {\n  selector: string;\n  value?: JSONObject;\n  fragment?: string;\n  accept?: string;\n  actionValue?: JSONObject;\n  defaultValue?: JSONValue;\n  store: Store;\n}): SelectionDetails<T> {\n  const details: ProcessingSelectionDetails = {\n    selector: selectorStr,\n    complete: false,\n    hasErrors: false,\n    hasMissing: false,\n    required: [],\n    dependencies: [],\n    result: [],\n  };\n\n  if (value == null) {\n    const [{ subject, filter }, ...selector] =\n      parseSelectorString(selectorStr, store);\n\n    const [iri, iriFragment] = subject.split('#');\n\n    selectEntity({\n      keySource: '',\n      pointer: '',\n      iri,\n      fragment: iriFragment ?? fragment,\n      accept,\n      filter,\n      selector: selector.length > 0 ? selector : undefined,\n      store,\n      details,\n    });\n\n    details.complete = details.required.length === 0;\n\n    return transformProcessedDetails<T>(details);\n  }\n\n  const selector = parseSelectorString(selectorStr, store);\n\n  traverseSelector({\n    keySource: '',\n    pointer: '',\n    value,\n    actionValue,\n    selector,\n    store,\n    details,\n    defaultValue,\n  });\n\n  details.complete = details.required.length === 0;\n\n  for (let index = 0; index < details.result.length; index++) {\n    const element = details.result[index];\n\n    (element as unknown as Mutable<SourceSelectionResults>).key = Symbol.for(element.keySource);\n  }\n\n  return transformProcessedDetails<T>(details);\n}\n\nfunction makePointer(pointer: string, addition: string | number) {\n  return `${pointer}/${escapeJSONPointerParts(addition.toString())}`;\n}\n\n/**\n * Filters apply to objects with `@type` properties. These can be strings or\n * arrays of strings and are considered a pass if any of the values match the\n * filter.\n *\n * If an object is provided which does not contain an `@type` property it is\n * considered a fail.\n */\nfunction passesFilter({\n  value,\n  filter,\n}: {\n  value: JSONObject;\n  filter?: string;\n}): boolean {\n  if (typeof filter !== 'string') {\n    return true;\n  }\n\n  if (Array.isArray(value['@type'])) {\n    return value['@type'].includes(filter);\n  }\n\n  return value['@type'] === filter;\n}\n\n/**\n * If a scala value is pulled before a selection is complete the branch\n * can exit early.\n */\nfunction isTraversable(value: JSONValue): value is JSONObject | JSONArray {\n  return (\n    value !== null &&\n    typeof value !== 'undefined' &&\n    typeof value !== 'boolean' &&\n    typeof value !== 'number' &&\n    typeof value !== 'string'\n  );\n}\n\n\n/**\n * Handles the final value found in a selection.\n * If a @id, @value jsonld object is provided further\n * recursion might be nessacary.\n */\nfunction resolveValue({\n  keySource,\n  pointer,\n  value,\n  propType,\n  filter,\n  spec,\n  actionValue,\n  store,\n  details,\n}: {\n  keySource: string;\n  pointer: string;\n  value: JSONValue;\n  spec?: JSONObject;\n  actionValue?: JSONValue;\n  propType: string;\n  filter?: string;\n  store: Store;\n  details: ProcessingSelectionDetails;\n}) {\n  if (value === undefined) {\n    details.hasMissing = true;\n\n    return;\n  } else if (value === null && isJSONObject(actionValue)) {\n    for (const item of Object.values(actionValue)) {\n      if (isTypeObject(item) && item[\"@type\"] === 'https://schema.org/PropertyValueSpecification') {\n        return;\n      }\n    }\n  }\n\n  if (\n    spec != null && (\n      // hit the for loop below if the action value\n      // has editable properties and the value is an\n      // array\n      !isIterable(value) || !isJSONObject(actionValue)\n    )\n  ) {\n    const pvs = resolvePropertyValueSpecification({\n      spec,\n      store,\n    });\n\n    if (isJSONObject(value) && isValueObject(value)) {\n      value = value['@value'];\n    }\n\n    details.result.push({\n      keySource: pointer,\n      pointer,\n      type: 'action-value',\n      propType,\n      value,\n      actionValue,\n      spec: pvs,\n      readonly: pvs.readonly,\n    });\n\n    return;\n  }\n\n  if (!isTraversable(value)) {\n    details.result.push({\n      keySource: pointer,\n      pointer: pointer,\n      type: 'value',\n      propType,\n      value,\n    });\n\n    return;\n  } else if (isIterable(value)) {\n    const list = getIterableValue(value);\n\n    for (let index = 0; index < list.length; index++) {\n      const item = list[index];\n\n      if (!isIRIObject(item)) {\n        keySource = makePointer(keySource, index);\n      }\n\n      resolveValue({\n        keySource,\n        pointer: makePointer(pointer, index),\n        value: item,\n        spec,\n        actionValue,\n        propType,\n        filter,\n        store,\n        details,\n      });\n\n      if (details.hasErrors || details.hasMissing) {\n        return;\n      }\n    }\n\n    return;\n  }\n  if (typeof filter === 'string' && !passesFilter({ value, filter })) {\n    return;\n  }\n\n  if (isValueObject(value)) {\n    resolveValue({\n      keySource,\n      pointer,\n      value: value['@value'],\n      propType,\n      store,\n      details,\n    });\n\n    return;\n  } else if (isMetadataObject(value)) {\n    selectEntity({\n      keySource,\n      pointer,\n      iri: value['@id'],\n      filter,\n      store,\n      details,\n    });\n\n    return;\n  }\n\n  if (isIRIObject(value)) {\n    const iri = value['@id'];\n\n    details.result.push({\n      keySource,\n      pointer,\n      type: 'entity',\n      iri,\n      ok: true,\n      value,\n    });\n\n    return;\n  }\n\n  details.result.push({\n    keySource,\n    pointer,\n    type: 'value',\n    propType,\n    value,\n  });\n}\n\n/**\n * Selects a type from a json value, handling invalid situations.\n */\nfunction selectTypedValue({\n  keySource,\n  pointer,\n  propType,\n  value,\n  actionValue,\n  filter,\n  store,\n  details,\n}: {\n  keySource: string;\n  pointer: string;\n  propType: string;\n  value: JSONValue;\n  actionValue?: JSONObject;\n  filter?: string;\n  store: Store;\n  details: ProcessingSelectionDetails;\n}): void {\n  pointer = makePointer(pointer, propType);\n\n  if (!isTraversable(value)) {\n    return;\n  }\n\n  if (isIterable(value)) {\n    const list = getIterableValue(value);\n\n    for (let index = 0; index < list.length; index++) {\n      const item = list[index];\n\n      if (!isIRIObject(item)) {\n        keySource = makePointer(keySource, index);\n      }\n\n      selectTypedValue({\n        keySource,\n        pointer: makePointer(pointer, index),\n        propType,\n        value: item,\n        actionValue,\n        filter,\n        store,\n        details,\n      });\n\n      if (details.hasErrors || details.hasMissing) {\n        return;\n      }\n    }\n\n    return;\n  }\n\n  if (isMetadataObject(value) && isIRIObject(value)) {\n    selectEntity({\n      keySource,\n      pointer,\n      iri: value['@id'],\n      selector: [{ subject: propType, filter }],\n      store,\n      details,\n    });\n\n    return;\n  } else if (isMetadataObject(value)) {\n    return;\n  }\n\n  let spec: JSONObject | undefined;\n\n  if (isJSONObject(actionValue) && actionValue[`${propType}-input`] == null) {\n    // selecting for an action but the type is not editable\n    return;\n  } else if (isJSONObject(actionValue)) {\n    spec = actionValue[`${propType}-input`] as JSONObject;\n  }\n\n  resolveValue({\n    keySource,\n    pointer,\n    value: value[propType],\n    spec,\n    actionValue: actionValue?.[propType],\n    propType,\n    filter,\n    store,\n    details,\n  });\n}\n\n/**\n * Recurses through the selection until there are no further selection items.\n */\nfunction traverseSelector({\n  keySource,\n  pointer,\n  selector,\n  value,\n  actionValue,\n  store,\n  details,\n  defaultValue,\n}: {\n  keySource: string;\n  pointer: string;\n  selector: SelectorObject[];\n  value: JSONValue;\n  actionValue?: JSONObject;\n  store: Store;\n  details: ProcessingSelectionDetails;\n  defaultValue?: JSONValue;\n}): void {\n  if (selector.length === 0) {\n    return;\n  } else if (!isTraversable(value)) {\n    return;\n  }\n\n  if (isIterable(value)) {\n    const list = getIterableValue(value);\n\n    for (let index = 0; index < list.length; index++) {\n      const item = list[index];\n\n      if (!isIRIObject(item)) {\n        keySource = makePointer(keySource, index);\n      }\n\n      // keep nesting on the full selector\n      // as only objects can be subscripted\n      // with terms\n      traverseSelector({\n        keySource,\n        pointer: makePointer(pointer, index),\n        selector,\n        value: item,\n        actionValue,\n        store,\n        details,\n        defaultValue,\n      });\n\n      if (details.hasErrors || details.hasMissing) {\n        return;\n      }\n    }\n\n    return;\n  } else if (isValueObject(value)) {\n    traverseSelector({\n      keySource,\n      pointer,\n      selector,\n      value: value['@value'],\n      actionValue,\n      store,\n      details,\n      defaultValue,\n    });\n  }\n\n  if (isMetadataObject(value) && isIRIObject(value)) {\n    selectEntity({\n      keySource,\n      pointer,\n      selector,\n      iri: value['@id'],\n      store,\n      details,\n    });\n\n    return;\n  }\n\n  // edit selections are a special case in that an input\n  // should render even when no value is present.\n  if (\n    isJSONObject(value) &&\n    actionValue !== undefined &&\n    value[selector[0].subject] == null\n  ) {\n    value = { [selector[0].subject]: defaultValue ?? null };\n  }\n\n  const [next, ...rest] = selector;\n  const { subject: propType, filter } = next;\n\n  // null is a placeholder for action payload types with no value.\n  // jsonld drops null values otherwise.\n  if (value[propType] === undefined) {\n    details.hasMissing = true;\n\n    return;\n  }\n\n  if (rest.length === 0 && isJSONObject(actionValue?.[propType])) {\n    pointer = makePointer(pointer, propType);\n\n    resolveValue({\n      keySource: pointer,\n      pointer,\n      value: value[propType],\n      propType,\n      details,\n      store,\n      actionValue: actionValue?.[propType],\n      spec: actionValue[`${propType}-input`] as SCMPropertyValueSpecification,\n      filter,\n    });\n\n    return;\n  } else if (rest.length === 0) {\n    selectTypedValue({\n      keySource,\n      pointer,\n      propType: propType,\n      filter,\n      value,\n      actionValue,\n      store,\n      details,\n    });\n\n    return;\n  }\n\n  if (typeof filter === 'string' && !passesFilter({ value, filter })) {\n    return;\n  }\n\n  let traversedActionValue: JSONObject | undefined;\n\n  if (isJSONObject(actionValue?.[propType])) {\n    traversedActionValue = actionValue[propType];\n  }\n\n  traverseSelector({\n    keySource: makePointer(keySource, propType),\n    pointer: makePointer(pointer, propType),\n    selector: rest,\n    value: value[propType],\n    actionValue: traversedActionValue,\n    store,\n    details,\n  });\n}\n\n/**\n * Selects an entity from the store and continues the selection\n * if the branch has not completed.\n */\nfunction selectEntity({\n  keySource,\n  pointer,\n  iri,\n  fragment,\n  accept,\n  filter,\n  selector,\n  store,\n  details,\n  handledIRIs,\n}: {\n  keySource: string;\n  pointer: string;\n  iri: string;\n  fragment?: string;\n  accept?: string;\n  filter?: string;\n  selector?: SelectorObject[];\n  store: Store;\n  details: ProcessingSelectionDetails;\n  handledIRIs?: Set<string>;\n}): void {\n  keySource = makePointer(keySource, iri);\n  pointer = makePointer(pointer, iri);\n\n  const cache: EntityState | null = store.entity(iri, accept)\n\n  details.dependencies.push(iri);\n\n  // if loading is required mark found as false\n  if (cache == null || cache.loading) {\n    if (!details.required.includes(iri)) {\n      details.required.push(iri);\n      details.accept = accept;\n      details.fragment = fragment;\n    }\n\n    return;\n  }\n\n  if (!cache.ok) {\n    details.hasErrors = true;\n\n    if (selector == null || selector.length === 0) {\n      return;\n    }\n\n    details.result.push({\n      keySource,\n      pointer,\n      type: 'entity',\n      iri: cache.iri,\n      ok: false,\n      status: cache.status,\n      value: cache.value,\n      reason: cache.reason,\n    });\n\n    return;\n  }\n\n  if (cache.type === 'alternative-success') {\n    details.result.push({\n      keySource,\n      pointer,\n      type: 'alternative',\n      contentType: cache.integration.contentType,\n      integration: cache.integration,\n    });\n\n    return;\n  }\n\n  const value = cache.value;\n\n  if (isMetadataObject(value)) {\n    // in theory serveral entities could be metadata objects\n    // referencing each other and end up looping around...\n    if (handledIRIs == null) {\n      handledIRIs = new Set([value['@id']]);\n    } else if (!handledIRIs.has(value['@id'])) {\n      handledIRIs.add(value['@id']);\n    } else {\n      throw new CircularSelectionError(`Circular selection loop detected`);\n    }\n\n    // select the entity this entity is referencing\n    return selectEntity({\n      keySource,\n      pointer,\n      iri: value['@id'],\n      filter,\n      selector,\n      details,\n      store,\n      handledIRIs,\n    });\n  }\n\n  // if the entity does not match the filter it is not relevant to the final selection\n  if (typeof filter === 'string' && !passesFilter({ filter, value })) {\n    return;\n  }\n\n  if (typeof selector === 'undefined') {\n    details.result.push({\n      keySource,\n      pointer,\n      type: 'entity',\n      iri: cache.iri,\n      ok: true,\n      value: cache.value as JSONObject,\n    });\n\n    return;\n  }\n\n  traverseSelector({\n    keySource,\n    pointer,\n    value,\n    selector,\n    store,\n    details,\n  });\n\n  return;\n}\n", "import type m from \"mithril\";\nimport { actionSelectionFactory } from '../factories/actionSelectionFactory.ts';\nimport type { ActionSelectionParentArgs, ActionSelectionRendererArgs, ActionSelectView, CommonRendererArgs, OctironActionSelection, OctironActionSelectionArgs, OctironSelectArgs, OctironSelection, SelectionParentArgs, Selector, Update } from '../types/octiron.ts';\nimport type { ActionSelectionResult, SelectionDetails } from '../types/store.ts';\nimport { getSelection } from '../utils/getSelection.ts';\nimport { isJSONObject } from '../utils/isJSONObject.ts';\nimport { mithrilRedraw } from '../utils/mithrilRedraw.ts';\nimport type { JSONObject, Mutable } from '../types/common.ts';\nimport { selectionFactory } from '../factories/selectionFactory.ts';\nimport type { InstanceHooks } from \"../factories/octironFactory.ts\";\n\n\nexport type ActionSelectionRendererAttrs = {\n  value: JSONObject;\n  actionValue: JSONObject;\n  selector: Selector;\n  parentArgs: ActionSelectionParentArgs;\n  args: OctironActionSelectionArgs;\n  view: ActionSelectView;\n  selectionArgs?: OctironActionSelectionArgs;\n};\n\nexport const ActionSelectionRenderer: m.FactoryComponent<ActionSelectionRendererAttrs> = (\n  vnode,\n) => {\n  let currentAttrs = vnode.attrs;\n  let details: SelectionDetails<ActionSelectionResult>;\n\n  const instances: Record<string, {\n    rendererArgs: ActionSelectionRendererArgs;\n    selection: OctironSelection;\n    octiron: OctironActionSelection & InstanceHooks;\n    selectionResult: ActionSelectionResult;\n  }> = {};\n\n  function createInstances() {\n    let hasChanges = false;\n    const { parentArgs, selectionArgs } = currentAttrs;\n\n    const nextKeys: Array<string> = [];\n\n    for (let index = 0; index < details.result.length; index++) {\n      const selectionResult = details.result[index];\n\n      nextKeys.push(selectionResult.pointer);\n\n      if (instances[selectionResult.pointer] != null) {\n        const { rendererArgs, octiron } = instances[selectionResult.pointer];\n\n        const update: Update = (value) => {\n          return parentArgs.updatePointer(\n            selectionResult.pointer,\n            value,\n            selectionArgs,\n          );\n        };\n\n        rendererArgs.value = octiron.value = selectionResult.value;\n        rendererArgs.spec = selectionResult.spec;\n        rendererArgs.update = update;\n\n        continue;\n      }\n\n      hasChanges = true;\n\n      const update: Update = (value) => {\n        return parentArgs.updatePointer(\n          selectionResult.pointer,\n          value,\n          selectionArgs,\n        );\n      };\n\n      const actionValueRendererArgs: CommonRendererArgs = {\n        index,\n        value: selectionResult.actionValue,\n        propType: selectionResult.propType,\n      }\n\n      const actionValue = selectionFactory(\n        currentAttrs.args as OctironSelectArgs,\n        parentArgs as unknown as SelectionParentArgs,\n        actionValueRendererArgs,\n      );\n\n      const rendererArgs: ActionSelectionRendererArgs = {\n        index,\n        update,\n        actionValue,\n        pointer: selectionResult.pointer,\n        propType: selectionResult.propType,\n        value: selectionResult.value,\n        spec: selectionResult.spec,\n      };\n\n      const actionSelection = actionSelectionFactory(\n        currentAttrs.args,\n        parentArgs,\n        rendererArgs,\n      );\n\n      instances[selectionResult.pointer] = {\n        rendererArgs,\n        selection: actionValue,\n        octiron: actionSelection,\n        selectionResult,\n      };\n    }\n\n    const prevKeys = Object.keys(instances);\n\n    for (const key of prevKeys) {\n      if (!nextKeys.includes(key)) {\n        hasChanges = true;\n\n        delete instances[key];\n      }\n    }\n\n    if (hasChanges && typeof window !== 'undefined') {\n      mithrilRedraw();\n    }\n  }\n\n  function updateSelection() {\n    const { selector, value, actionValue } = currentAttrs;\n    const { store } = currentAttrs.parentArgs;\n\n    if (!isJSONObject(value)) {\n      return;\n    }\n\n    details = getSelection<ActionSelectionResult>({\n      selector,\n      store,\n      actionValue,\n      value,\n      defaultValue: currentAttrs.args.initialValue,\n    });\n\n    createInstances();\n  }\n\n  return {\n    oninit: ({ attrs }) => {\n      currentAttrs = attrs;\n\n      updateSelection();\n    },\n    onbeforeupdate: ({ attrs }) => {\n      currentAttrs = attrs;\n\n      for (const instance of Object.values(instances)) {\n        instance.octiron._updateArgs('args', attrs.args);\n      }\n\n      updateSelection();\n    },\n    view: ({ attrs: { view, args } }) => {\n      if (details == null) {\n        return null;\n      }\n\n      const {\n        pre,\n        sep,\n        post,\n        fallback,\n      } = args;\n\n      if (typeof view === 'undefined') {\n        return;\n      }\n\n      const list = Object.values(instances);\n      const children = [pre];\n\n      for (let index = 0; index < list.length; index++) {\n        const { octiron, selectionResult } = list[index];\n\n        (octiron as Mutable<OctironActionSelection>).position = index + 1;\n\n        if (index !== 0) {\n          children.push(sep);\n        }\n\n        if (selectionResult.value == null && typeof fallback === 'function') {\n          children.push(null)\n          // children.push(fallback(octiron));\n        } else if (selectionResult.value == null && fallback != null) {\n          children.push(fallback as m.Children);\n        } else {\n          children.push(view(octiron));\n        }\n      }\n\n      children.push(post);\n\n      return children;\n    },\n  };\n};\n", "import type m from 'mithril';\nimport { actionFactory } from '../factories/actionFactory.ts';\nimport { selectionFactory } from '../factories/selectionFactory.ts';\nimport type { JSONObject, Mutable } from '../types/common.ts';\nimport type { ActionParentArgs, CommonRendererArgs, OctironAction, OctironPerformArgs, OctironSelection, PerformRendererArgs, PerformView, SelectionParentArgs, Selector } from '../types/octiron.ts';\nimport type { Failure, ReadonlySelectionResult, SelectionDetails } from '../types/store.ts';\nimport { isIRIObject } from '../utils/isIRIObject.ts';\nimport { mithrilRedraw } from '../utils/mithrilRedraw.ts';\nimport type { InstanceHooks } from \"../factories/octironFactory.ts\";\nimport { render } from \"mithril\";\n\nexport type PerformRendererAttrs = {\n  parentArgs: SelectionParentArgs & ActionParentArgs,\n  selector?: Selector;\n  args: OctironPerformArgs;\n  view: PerformView;\n};\n\nexport const PerformRenderer: m.FactoryComponent<PerformRendererAttrs> = ({ attrs }) => {\n  const key = Symbol('PerformRenderer');\n  let currentAttrs = attrs;\n  let details: SelectionDetails<ReadonlySelectionResult>;\n\n  const instances: Record<string, {\n    octiron: OctironSelection;\n    action: OctironAction & InstanceHooks;\n    selectionResult: ReadonlySelectionResult;\n  }> = {};\n\n  function createInstances() {\n    let hasChanges = false;\n    const { args, parentArgs } = currentAttrs;\n\n    const nextKeys: Array<string> = [];\n\n    for (let index = 0; index < details.result.length; index++) {\n      const selectionResult = details.result[index];\n\n      nextKeys.push(selectionResult.pointer);\n\n      if (Object.hasOwn(instances, selectionResult.pointer)) {\n        const next = selectionResult;\n        const prev = instances[selectionResult.pointer].selectionResult;\n\n        if (\n          prev.type === 'value' &&\n          next.type === 'value' &&\n          next.value === prev.value\n        ) {\n          continue;\n        } else if (\n          prev.type === 'entity' &&\n          next.type === 'entity' &&\n          (\n            next.ok !== prev.ok ||\n            next.status !== prev.status ||\n            next.value !== prev.value\n          )\n        ) {\n          continue;\n        }\n        continue;\n      }\n\n      hasChanges = true;\n\n      const actionValueRendererArgs: CommonRendererArgs = {\n        index,\n        value: selectionResult.value,\n      } as PerformRendererArgs;\n\n      const actionValue = selectionFactory(\n        args,\n        parentArgs,\n        actionValueRendererArgs,\n      );\n\n      const rendererArgs = {\n        index,\n        value: selectionResult.value,\n        actionValue,\n      } as PerformRendererArgs;\n\n      const action = actionFactory(\n        args,\n        parentArgs,\n        rendererArgs,\n      );\n\n      instances[selectionResult.pointer] = {\n        action,\n        octiron: actionValue,\n        selectionResult,\n      };\n    }\n\n    const prevKeys = Object.keys(instances);\n\n    for (const key of prevKeys) {\n      if (!nextKeys.includes(key)) {\n        hasChanges = true;\n\n        delete instances[key];\n      }\n    }\n\n    if (hasChanges) {\n      mithrilRedraw();\n    }\n  }\n\n  async function fetchRequired(required: string[]) {\n    if (required.length === 0) {\n      return;\n    }\n\n    // deno-lint-ignore no-explicit-any\n    const promises: Promise<any>[] = [];\n\n    for (const iri of required) {\n      promises.push(currentAttrs.parentArgs.store.fetch(iri));\n    }\n\n    await Promise.allSettled(promises);\n  }\n\n  function listener(next: SelectionDetails<ReadonlySelectionResult>) {\n    let required: string[] = [];\n\n    if (typeof details === 'undefined') {\n      required = next.required;\n    } else {\n      for (const iri of next.required) {\n        if (!details.required.includes(iri)) {\n          required.push(iri);\n        }\n      }\n    }\n\n    details = next;\n\n    if (required.length > 0) {\n      fetchRequired(required);\n    }\n\n    createInstances();\n  }\n\n  function subscribe() {\n    const { selector, parentArgs } = currentAttrs;\n\n    if (selector == null) {\n      // The value is the action\n      let result: ReadonlySelectionResult;\n\n      if (isIRIObject(parentArgs.parent.value)) {\n        result = {\n          pointer: '/local',\n          key: Symbol.for('/local'),\n          type: 'entity',\n          iri: parentArgs.parent.value['@id'],\n          ok: true,\n          value: parentArgs.parent.value,\n        };\n      } else {\n        result = {\n          pointer: '/local',\n          key: Symbol.for('/local'),\n          type: 'value',\n          value: parentArgs.parent.value,\n        };\n      }\n\n      details = {\n        selector: '',\n        complete: true,\n        hasErrors: false,\n        hasMissing: false,\n        dependencies: [],\n        required: [],\n        result: [result],\n      };\n    } else {\n      // Perform needs to select the action value\n      details = parentArgs.store.subscribe({\n        key,\n        selector: selector,\n        value: parentArgs.parent.value as JSONObject,\n        listener,\n      });\n\n      fetchRequired(details.required);\n    }\n\n    createInstances();\n  }\n\n  return {\n    oninit: ({ attrs }) => {\n      currentAttrs = attrs;\n\n      subscribe();\n    },\n    onbeforeupdate: ({ attrs }) => {\n      if (attrs.selector !== currentAttrs.selector) {\n        attrs.parentArgs.store.unsubscribe(key);\n\n        subscribe();\n      }\n\n      currentAttrs = attrs;\n\n      for (const instance of Object.values(instances)) {\n        instance.action._updateArgs('args', attrs.args);\n      }\n    },\n    onbeforeremove: ({ attrs }) => {\n      currentAttrs = attrs;\n\n      attrs.parentArgs.store.unsubscribe(key);\n    },\n    view: ({ attrs: { view, args } }): m.Children => {\n      if (details == null || !details.complete) {\n        return args.loading;\n      }\n\n      const {\n        pre,\n        sep,\n        post,\n        fallback,\n      } = args;\n\n      if (typeof view === 'undefined') {\n        return;\n      }\n\n      const list = Object.values(instances);\n      const children = [pre];\n\n      for (let index = 0; index < list.length; index++) {\n        const { selectionResult, action, octiron } = list[index];\n\n        (action as Mutable<OctironAction>).position = index + 1;\n\n        if (index !== 0) {\n          children.push(sep);\n        }\n\n        if (selectionResult.type === 'value') {\n          children.push(view(action));\n        } else if (!selectionResult.ok && typeof fallback === 'function') {\n          children.push(fallback(octiron, selectionResult.reason as Failure));\n        } else if (!selectionResult.ok) {\n          children.push(fallback as m.Children);\n        } else {\n          children.push(view(action));\n        }\n      }\n\n      children.push(post);\n\n      return children;\n    },\n  };\n};\n", "import type { CommonParentArgs, OctironRoot } from '../types/octiron.ts';\nimport { octironFactory } from \"./octironFactory.ts\";\n\n\nexport function rootFactory(\n  parentArgs: CommonParentArgs,\n): OctironRoot {\n  const factoryArgs = {};\n  const self = octironFactory(\n    'root',\n    factoryArgs,\n    parentArgs,\n  );\n\n  return self as unknown as OctironRoot;\n}\n", "import m from 'mithril';\nimport {processTemplate} from '@longform/longform';\nimport type { HTMLFragmentsHandler, HTMLFragmentsHandlerResult, IntegrationState } from \"../types/store.ts\";\nimport type { Octiron } from \"../types/octiron.ts\";\nimport {isBrowserRender} from '../consts.ts';\n\nfunction fragmentToHTML(fragment: Element[]) {\n  let html: string = '';\n\n  for (let i = 0; i < fragment.length; i++) {\n    html += fragment[i].outerHTML;\n  }\n\n  return html;\n}\n\nexport type HTMLFragmentsIntegrationComponentAttrs = {\n  o: Octiron;\n  integration: HTMLFragmentsIntegration;\n  fragment?: string;\n  output: HTMLFragmentsHandlerResult;\n};\n\nexport type HTMLFragmentsIntegrationComponentType = m.ComponentTypes<HTMLFragmentsIntegrationComponentAttrs>;\n\nexport const HTMLFragmentsIntegrationComponent: HTMLFragmentsIntegrationComponentType = () => {\n  let fragment: string | undefined;\n  let html: string | Element[] | undefined;\n\n  function setDomServer(attrs: HTMLFragmentsIntegrationComponentAttrs) {\n    if (fragment === attrs.fragment) {\n      return;\n    }\n    fragment = attrs.fragment;\n    \n    if (attrs.fragment == null) {\n      html = attrs.output.root;\n      return;\n    }\n\n    const [id, rest] = attrs.fragment.split('?');\n\n    if (rest == null) {\n      html = attrs.output.fragments[id]?.html;\n      return;\n    }\n\n    const template = attrs.output.templates[id];\n\n    if (template == null) {\n      return;\n    }\n\n    try {\n      const args = Object.fromEntries(new URLSearchParams(rest));\n\n      html = processTemplate(template, args, (fragment) => {\n        return attrs.output.fragments[fragment]?.html;\n      });\n    } catch (err) {\n      console.error(err);\n    }\n  }\n\n  function setDomClient(attrs: HTMLFragmentsIntegrationComponentAttrs) {\n    if (attrs.fragment == null) {\n      if (attrs.output.root != null && attrs.output.dom == null) {\n        const template = document.createElement('template');\n        template.innerHTML = attrs.output.root;\n        attrs.output.dom = Array.from(template.content.children);\n      }\n      html = attrs.output.dom;\n\n      return;\n    }\n\n    const [id, rest] = attrs.fragment.split('?');\n    const isTemplate = rest != null || attrs.output.templates[id] != null;\n\n\n    if (!isTemplate) {\n      const fragment = attrs.output.fragments[id];\n\n      if (fragment == null) {\n        return;\n      } else if (fragment.type === 'text') {\n        html = fragment.html;\n\n        return;\n      } else if (fragment.dom == null && fragment.html != null) {\n        const template = document.createElement('template');\n        template.innerHTML = fragment.html;\n        fragment.dom = Array.from(template.content.children);\n      } else if (fragment.dom == null) {\n        return;\n      }\n\n      html = fragment.dom;\n\n      return;\n    }\n\n    const template = attrs.output.templates[id];\n\n    if (template == null) {\n      return;\n    }\n\n    try {\n      const args = Object.fromEntries(new URLSearchParams(rest));\n    \n      html = processTemplate(template, args, (ref) => {\n        if (attrs.output.fragments[ref] != null &&\n            attrs.output.fragments[ref].html == null &&\n            attrs.output.fragments[ref].dom != null\n        ) {\n          attrs.output.fragments[ref].html = fragmentToHTML(attrs.output.fragments[ref].dom);\n        }\n\n        return attrs.output.fragments[ref]?.html;\n      });\n    } catch (err) {\n      console.error(err);\n    }\n  }\n\n  return {\n    oninit({ attrs }) {\n      if (isBrowserRender) {\n        setDomClient(attrs);\n      } else {\n        setDomServer(attrs);\n      }\n    },\n    view() {\n      if (isBrowserRender && Array.isArray(html)) {\n        return m.dom(html);\n      } else if (typeof html === 'string') {\n        return m.trust(html);\n      }\n\n      return null;\n    },\n  };\n};\n\nexport type HTMLFragmentsIntegrationArgs = {\n  iri: string;\n  contentType: string;\n  output: HTMLFragmentsHandlerResult;\n};\n\nexport type FragmentState = {\n  type: 'embed' | 'bare' | 'range';\n  id: string;\n  rendered: boolean;\n  selector: string;\n};\n\ntype HTMLFragmentsStateInfo = {\n  iri: string,\n  contentType: string,\n  rendered?: boolean;\n  selector?: string;\n  fragments: FragmentState[];\n  texts: Record<string, string>;\n  templates: Record<string, string>;\n};\n\nexport class HTMLFragmentsIntegration implements IntegrationState {\n  static type = 'html-fragments' as const;\n\n  readonly integrationType = 'html-fragments' as const;\n\n  #rootRendered: boolean = false;\n  #rendered: Set<string> = new Set();\n  #iri: string;\n  #contentType: string;\n  #handler: HTMLFragmentsHandler;\n  #output: HTMLFragmentsHandlerResult;\n\n  constructor(handler: HTMLFragmentsHandler, {\n    iri,\n    contentType,\n    output,\n  }: HTMLFragmentsIntegrationArgs) {\n    this.#handler = handler;\n    this.#iri = iri;\n    this.#contentType = contentType;\n    this.#output = output;\n  }\n\n  get iri(): string {\n    return this.#iri;\n  }\n\n  get contentType(): string {\n    return this.#contentType;\n  }\n\n  get output(): HTMLFragmentsHandlerResult {\n    return this.#output;\n  }\n\n  getFragment(fragment?: string): string | Node | null {\n    return fragment != null\n      ? this.#output.fragments[fragment]?.html ?? null\n      : this.#output.root ?? null;\n  }\n\n  #fragmentHTML(fragment: DocumentFragment): string {\n    let html = '';\n\n    for (let i = 0; i < fragment.children.length; i++) {\n      html += fragment.children[i].outerHTML;\n    }\n\n    return html;\n  }\n\n  /**\n   * Returns a text representaion of a fragment.\n   */\n  public text(fragment?: string): string | undefined {\n    if (fragment == null) {\n      if (this.output.root == null && this.#output.dom) {\n        this.output.root = this.#fragmentHTML(this.#output.dom);\n      }\n\n      return this.output.root;\n    }\n\n    const [id, rest] = fragment.split('?');\n\n    if (rest == null) {\n      const fragment = this.#output.fragments[id];\n\n      if (fragment == null) {\n        return;\n      }\n\n      if (fragment.html == null && fragment.dom) {\n        fragment.html = this.#fragmentHTML(fragment.dom);\n      }\n\n      return fragment.html;\n    }\n\n    const template = this.#output.templates[id];\n\n    if (template == null) {\n      return;\n    }\n    \n    try {\n      const args = Object.fromEntries(new URLSearchParams(rest));\n\n      return processTemplate(\n        template,\n        args,\n        (ref) => {\n          const fragment = this.#output.fragments[ref];\n          if (fragment == null) return;\n          if (fragment.html == null && fragment.dom != null) {\n            fragment.html = this.#fragmentHTML(fragment.dom);\n          }\n\n          return fragment.html;\n        }\n      );\n    } catch (err) {\n      console.error(err);\n    }\n  }\n\n  public render(o: Octiron, fragment?: string) {\n    if (!isBrowserRender) {\n      if (fragment == null) {\n        this.#rootRendered = true;\n      } else {\n        this.#rendered.add(fragment);\n      }\n    }\n\n    return m(HTMLFragmentsIntegrationComponent, {\n      o,\n      integration: this,\n      fragment,\n      output: this.#output,\n    });\n  }\n\n  public getStateInfo(): HTMLFragmentsStateInfo {\n    const texts: Record<string, string> = {};\n    const fragments: FragmentState[] = [];\n    const entries = Object.values(this.#output.fragments);\n\n    for (let i = 0; i < entries.length; i++) {\n      if (entries[i].type === 'text') {\n        texts[entries[i].id] = entries[i].html as string;\n      } else {\n        fragments.push({\n          id: entries[i].id,\n          type: entries[i].type as 'embed' | 'bare' | 'range',\n          selector: entries[i].selector,\n          rendered: this.#rendered.has(entries[i].id),\n        });\n      }\n    }\n\n    return {\n      iri: this.#iri,\n      contentType: this.#contentType,\n      rendered: this.#rootRendered,\n      selector: this.#output.selector,\n      templates: this.#output.templates,\n      texts,\n      fragments,\n    };\n  }\n\n  public toInitialState(): string {\n    let html = '';\n    const entries = Object.values(this.#output.fragments);\n\n    if (this.#output.root != null && !this.#rootRendered) {\n      html += `<template id=\"htmlfrag:${this.#iri}|${this.#contentType}\">${this.#output.root}</template>\\n`;\n    }\n\n    for (let i = 0; i < entries.length; i++) {\n      if (entries[i].type === 'text') {\n        continue;\n      }\n\n      if (!this.#rendered.has(entries[i].id)) {\n        html += `<template data-htmlfrag=\"${entries[i].id}\">${entries[i].html}</template>\\n`;\n      } \n    }\n\n    return html;\n  }\n\n  static fromInitialState(handler: HTMLFragmentsHandler, {\n    iri,\n    contentType,\n    rendered,\n    selector,\n    texts,\n    fragments,\n    templates,\n  }: HTMLFragmentsStateInfo): HTMLFragmentsIntegration | null {\n    const output: HTMLFragmentsHandlerResult = Object.create(null);\n\n    output.fragments = Object.create(null);\n    output.templates = templates;\n\n    if (selector != null && rendered) {\n      const element = document.querySelector(selector);\n\n      if (element != null) {\n        output.root = element.outerHTML;\n      }\n    } else if (selector != null) {\n      const template = document.getElementById(`htmlfrag:${iri}|${contentType}`);\n\n      output.root = template?.textContent;\n    }\n\n    const textEntries = Object.entries(texts);\n\n    for (let i = 0; i < textEntries.length; i++) {\n      output.fragments[textEntries[i][0]] = {\n        id: textEntries[i][0],\n        type: 'text',\n        html: textEntries[i][1],\n        selector: '',\n      };\n    }\n\n    for (let i = 0; i < fragments.length; i++) {\n      const fragment = fragments[i];\n      const dom = document.createDocumentFragment();\n\n      if (fragment.rendered) {\n        let element: Element | undefined;\n\n        switch (fragment.type) {\n          case 'embed': {\n            element = document.getElementById(fragment.id) as Element;\n\n            if (element == null) {\n              break;\n            }\n            \n            output.fragments[fragment.id] = {\n              id: fragment.id,\n              type: fragment.type,\n              dom: [element],\n              selector: fragment.selector,\n            };\n            break;\n          }\n          case 'bare': {\n            element = document.querySelector(fragment.selector) as Element;\n\n            if (element == null) {\n              break;\n            }\n\n            output.fragments[fragment.id] = {\n              id: fragment.id,\n              type: fragment.type,\n              dom: [element],\n              selector: fragment.selector,\n            };\n            break;\n          }\n          case 'range': {\n            const elements = document.querySelectorAll(fragment.selector);\n\n            output.fragments[fragment.id] = {\n              id: fragment.id,\n              type: fragment.type,\n              selector: fragment.selector,\n              dom: Array.from(elements),\n            };\n          }\n        }\n      } else {\n        const template = document.querySelector(`[data-htmlfrag=\"${fragment.id}\"]`) as HTMLTemplateElement;\n        \n        if (template == null) {\n          continue;\n        }\n\n        output.fragments[fragment.id] = {\n          id: fragment.id,\n          type: fragment.type,\n          dom: Array.from(template.content.children),\n          selector: fragment.selector,\n        };\n      }\n    }\n\n    return new HTMLFragmentsIntegration(handler, {\n      contentType,\n      iri,\n      output,\n    });\n  }\n}\n", "import type { Children } from 'mithril';\nimport type { Failure, HTTPErrorView, ContentParsingView } from './types/store.ts';\n\n\nexport class UndefinedFailure implements Failure {\n  undefined(children: Children): Children {\n    return children;\n  }\n\n  http(children: Children): Children;\n  http(view: HTTPErrorView): Children;\n  http(): Children {\n    return null;\n  }\n\n  unparserable(children: Children): Children;\n  unparserable(view: ContentParsingView): Children;\n  unparserable(): Children {\n    return null;\n  }\n}\n\nexport class HTTPFailure implements Failure {\n  #status: number;\n  #res: Response;\n\n  constructor(status: number, res: Response) {\n    this.#status = status;\n    this.#res = res;\n  }\n\n  get status(): number {\n    return this.#status;\n  }\n\n  get res(): Response {\n    return this.#res;\n  }\n\n  undefined(): Children {\n    return null;\n  }\n\n  http(children: Children): Children;\n  http(view: HTTPErrorView): Children;\n  http(arg: Children | HTTPErrorView): Children {\n    if (typeof arg === 'function') {\n      return arg(this.#status);\n    }\n\n    return arg;\n  }\n\n  unparserable(children: Children): Children;\n  unparserable(view: ContentParsingView): Children;\n  unparserable(): Children {\n    return null;\n  }\n}\n\nexport class ContentHandlingFailure implements Failure {\n  #error: Error;\n\n  constructor(error: Error) {\n    this.#error = error;\n  }\n\n  get error(): Error {\n    return this.#error;\n  }\n\n  undefined(): Children {\n    return null;\n  }\n\n  http(children: Children): Children;\n  http(view: HTTPErrorView): Children;\n  http(): Children {\n    return null;\n  }\n\n  unparserable(children: Children): Children;\n  unparserable(view: ContentParsingView): Children;\n  unparserable(arg: Children | ContentParsingView): Children {\n    if (typeof arg === 'function') {\n      return arg(this.#error);\n    }\n\n    return arg;\n  }\n}\n", "import type { IRIObject, JSONValue } from '../types/common.ts';\nimport { getIterableValue } from \"./getIterableValue.ts\";\nimport { isIRIObject } from \"./isIRIObject.ts\";\nimport { isIterable } from \"./isIterable.ts\";\nimport { isJSONObject } from \"./isJSONObject.ts\";\nimport { isMetadataObject } from \"./isMetadataObject.ts\";\nimport { isValueObject } from \"./isValueObject.ts\";\n\n\n/**\n * @description\n * Locates all IRI objects in a potentially deeply nested JSON-ld structure and\n * returns an array of the located IRI objects.\n *\n * Objects identified as IRI objects are not modified beyond being placed in\n * an array together.\n *\n * @param value - The value to flatten.\n * @param agg - An array to fill with the flattened IRI objects.\n *              This is required for the internal recursing performed by this\n *              function and isn't required by upstream callers.\n */\nexport function flattenIRIObjects(value: JSONValue, agg: IRIObject[] = []): IRIObject[] {\n  if (Array.isArray(value)) {\n    for (const item of value) {\n      flattenIRIObjects(item, agg);\n    }\n  } else if (isJSONObject(value)) {\n    if (isMetadataObject(value)) {\n      return agg;\n    }\n\n    if (isIRIObject(value)) {\n      agg.push(value);\n    }\n\n    if (isValueObject(value)) {\n      flattenIRIObjects(value['@value'], agg);\n    } else if (isIterable(value)) {\n      flattenIRIObjects(getIterableValue(value), agg);\n    } else {\n      for (const [term, item] of Object.entries(value)) {\n        if (term.startsWith('@')) {\n          continue;\n        }\n\n        flattenIRIObjects(item, agg);\n      }\n    }\n  }\n\n  return agg;\n}\n", "import type { AlternativesState, Context, PrimaryState, Fetcher, Handler, IntegrationStateInfo, IntegrationType, JSONLDHandlerResult, ReadonlySelectionResult, ResponseHook, SelectionDetails, SelectionListener, EntityState, SubmitArgs, Aliases, EntitySelectionResult, ValueSelectionResult, IntegrationState, AlternativeSelectionResult } from \"./types/store.ts\";\nimport { HTMLFragmentsIntegration } from \"./alternatives/htmlFragments.ts\";\n// import { HTMLIntegration } from \"./alternatives/html.ts\";\nimport { isBrowserRender } from \"./consts.ts\";\nimport type { JSONObject } from \"./types/common.ts\";\nimport { HTTPFailure } from \"./failures.ts\";\nimport { flattenIRIObjects } from \"./utils/flattenIRIObjects.ts\";\nimport { getSelection } from './utils/getSelection.ts';\nimport type { FailureEntityState, SuccessEntityState } from \"./types/store.ts\";\nimport { mithrilRedraw } from \"./utils/mithrilRedraw.ts\";\n\nconst defaultAccept = 'application/problem+json, application/ld+json';\nconst integrationClasses = {\n  // [HTMLIntegration.type]: HTMLIntegration,\n  [HTMLFragmentsIntegration.type]: HTMLFragmentsIntegration,\n};\n\ntype StateInfo = {\n  primary: Record<string, EntityState>;\n  alternatives: Record<string, IntegrationStateInfo[]>;\n  acceptMap: Record<string, Array<[string, string]>>;\n};\n\ntype Dependencies = Map<string, Set<symbol>>;\ntype Listener = (details: SelectionDetails<ReadonlySelectionResult>) => void;\ntype ListenerDetails = {\n  key: symbol;\n  selector?: string;\n  value?: JSONObject;\n  fragment?: string;\n  accept?: string;\n  required: string[];\n  dependencies: string[];\n  listener: Listener;\n  cleanup: () => void;\n};\ntype Listeners = Map<symbol, ListenerDetails>;\n\nfunction getJSONLdValues(vocab?: string, aliases?: Record<string, string>): [Map<string, string>, Context] {\n  const aliasMap: Map<string, string> = new Map<string, string>();\n  const context: Context = {};\n\n  if (vocab != null) {\n    context['@vocab'] = vocab;\n  }\n\n  if (aliases == null) {\n    return [aliasMap, context];\n  }\n\n  for (const [key, value] of Object.entries(aliases)) {\n    context[key] = value;\n    aliasMap.set(key, value);\n  }\n\n  return [aliasMap, context];\n}\n\nfunction getInternalHeaderValues(\n  headers?: Record<string, string>,\n  origins?: Record<string, Record<string, string>>,\n): [Headers, Map<string, Headers>] {\n  const internalHeaders = new Headers([['accept', defaultAccept ]]);\n  const internalOrigins = new Map<string, Headers>();\n\n  if (headers != null) {\n    for (const [key, value] of Object.entries(headers)) {\n      internalHeaders.set(key, value);\n    }\n  }\n\n  if (origins != null) {\n    for (const [origin, headers] of Object.entries(origins)) {\n      const internalHeaders = new Headers([['accept', defaultAccept]]);\n\n      for (const [key, value] of Object.entries(headers)) {\n        internalHeaders.set(key, value);\n      }\n\n      internalOrigins.set(origin, internalHeaders);\n    }\n  }\n\n  return [internalHeaders, internalOrigins];\n}\n\nexport type StoreArgs = {\n  /**\n   * Root endpoint of the API.\n   */\n  rootIRI: string;\n\n  /**\n   * Headers to send when making requests to endpoints\n   * sharing origins with the `rootIRI`.\n   */\n  headers?: Record<string, string>;\n\n  /**\n   * A map of origins and the headers to use when sending\n   * requests to them. Octiron will only send requests\n   * to endpoints which share origins with the `rootIRI`\n   * or are configured in the origins object. Aside\n   * from the accept header which has a common default\n   * value, headers are not shared between origins.\n   */\n  origins?: Record<string, Record<string, string>>;\n\n  /**\n   * The JSON-ld @vocab to use for octiron selectors.\n   */\n  vocab?: string;\n\n  /**\n   * Map of JSON-ld aliases to their values.\n   */\n  aliases?: Record<string, string>;\n\n  /**\n   * Primary initial state.\n   */\n  primary?: Record<string, EntityState>;\n\n  acceptMap?: Record<string, Array<[string, string]>>;\n\n  /**\n   * Alternatives initial state.\n   */\n  alternatives?: AlternativesState;\n\n  /**\n   * Handler objects.\n   */\n  handlers: Handler[];\n\n  /**\n   * Function which performs fetch.\n   */\n  fetcher?: Fetcher;\n\n  /**\n   * Hook used by SSR for awaiting response promises.\n   */\n  responseHook?: ResponseHook;\n};\n\nexport class Store {\n\n    #rootIRI: string;\n    #rootOrigin: string;\n    #headers: Headers;\n    #origins: Map<string, Headers>;\n    #vocab?: string | undefined;\n    #aliases: Map<string, string>;\n    #primary: PrimaryState = new Map();\n    #loading: Set<string> = new Set();\n    #integrations: AlternativesState = new Map();\n    #handlers: Map<string, Handler>;\n    #keys: Set<string> = new Set();\n    #context: Context;\n    #termExpansions: Map<symbol, string | null> = new Map();\n    #fetcher?: Fetcher;\n    #responseHook?: ResponseHook;\n    #dependencies: Dependencies = new Map();\n    #listeners: Listeners = new Map();\n\n    // iri => accept => [loading, contentType]\n    #acceptMap: Map<string, Map<string, string>> = new Map();\n\n    constructor(args: StoreArgs) {\n      this.#rootIRI = args.rootIRI;\n      this.#rootOrigin = new URL(args.rootIRI).origin;\n      this.#vocab = args.vocab;\n      this.#fetcher = args.fetcher;\n      this.#responseHook = args.responseHook;\n\n      [this.#headers, this.#origins] = getInternalHeaderValues(args.headers, args.origins);\n      [this.#aliases,this.#context] = getJSONLdValues(args.vocab, args.aliases);\n\n      this.#handlers = new Map(args.handlers?.map?.((handler) => [handler.contentType, handler]));\n\n      if (args.primary != null) {\n        this.#primary = new Map(Object.entries(args.primary));\n      }\n\n      if (!this.#headers.has('accept')) {\n        this.#headers.set('accept', defaultAccept);\n      }\n\n      for (const origin of Object.values(this.#origins)) {\n        if (!origin.has('accept')) {\n          origin.set('accept', defaultAccept);\n        }\n      }\n\n      if (args.acceptMap != null) {\n        for (const [accept, entries] of Object.entries(args.acceptMap)) {\n          this.#acceptMap.set(accept, new Map(entries));\n        }\n      }\n\n      if (args.alternatives != null) {\n        this.#integrations = args.alternatives;\n      }\n    }\n\n    public get rootIRI() {\n      return this.#rootIRI;\n    }\n\n    /**\n     * Retrieves an entity state object relating to an IRI.\n     */\n    public entity(iri: string, accept?: string): EntityState | null {\n      if (accept == null) {\n        return this.#primary.get(iri) ?? null;\n      }\n\n      //const key = this.#getLoadingKey(iri, 'get', accept);\n      //const loading = this.#loading.has(key);\n\n      //if (loading) {\n      //  return {\n      //    type: 'entity-loading',\n      //    iri,\n      //    loading: true,\n      //  };\n      //}\n\n      const contentType = this.#acceptMap.get(iri)?.get?.(accept);\n\n      if (contentType == null) {\n        return null;\n      }\n\n      const integration = this.#integrations.get(contentType)?.get(iri);\n\n      if (integration == null) {\n        return null;\n      }\n    \n      return {\n        type: 'alternative-success',\n        iri,\n        loading: false,\n        ok: true,\n        integration,\n      };\n    }\n\n    /**\n     * Retrieves a text representation of a value in the store\n     * if it is supported by the int4egration.\n     */\n    public text(iri: string, accept?: string): string | undefined {\n      const [key, fragment] = iri.split('#');\n      const entity = this.entity(key, accept);\n\n      if (entity == null) {\n        return;\n      }\n    \n      if (entity?.type === 'alternative-success') {\n        return entity.integration.text(fragment);\n      }\n    }\n\n    public get vocab(): string | undefined {\n      return this.#vocab;\n    }\n\n    public get aliases(): Aliases {\n      return Object.fromEntries(\n        this.#aliases.entries()\n          .map(([key, value]) => [key.replace(/^/, ''), value])\n      );\n    }\n\n\n    public get context(): Context {\n      return this.#context;\n    }\n\n    /**\n     * Expands a term to a type.\n     *\n     * If an already expanded JSON-ld type is given it will\n     * return the input value.\n     */\n    public expand(termOrType: string): string {\n      const sym = Symbol.for(termOrType);\n      const cached = this.#termExpansions.get(sym);\n\n      if (cached != null) {\n        return cached;\n      }\n\n      let expanded: string | undefined;\n\n      if (this.#vocab != null && !/^[\\w\\d]+\\:/.test(termOrType)) {\n        expanded = this.#vocab + termOrType;\n      } else if (/https?:\\/\\//.test(termOrType)) {\n        // is a type\n        expanded = termOrType;\n      } else {\n        for (const [key, value] of this.#aliases) {\n          const reg = new RegExp(`^${key}:`);\n          if (reg.test(termOrType)) {\n            expanded = termOrType.replace(reg, value);\n            break;\n          }\n        }\n      }\n\n      this.#termExpansions.set(sym, expanded ?? termOrType);\n\n      return expanded ?? termOrType;\n    }\n\n    public select(selector: string, value?: JSONObject, {\n      accept,\n    }: {\n      accept?: string;\n    } = {}): SelectionDetails {\n      return getSelection({\n        selector,\n        value,\n        accept,\n        store: this,\n      });\n    }\n\n    /**\n     * Generates a unique key for server rendering only.\n     */\n    public key(): string {\n      while (true) {\n        const key = `oct-${Math.random().toString(36).slice(2, 7)}`;\n\n        if (!this.#keys.has(key)) {\n          this.#keys.add(key);\n\n          return key;\n        }\n      }\n    }\n\n    /**\n     * Creates a cleanup function which should be called\n     * when a subscriber unlistens.\n     */\n    #makeCleanupFn(key: symbol, details: SelectionDetails) {\n      return () => {\n        this.#listeners.delete(key);\n\n        for (const dependency of details.dependencies) {\n          this.#dependencies.delete(dependency);\n\n          if (isBrowserRender) {\n            setTimeout(() => {\n              if (this.#dependencies.get(dependency)?.size === 0) {\n                this.#primary.delete(dependency);\n              }\n            }, 5000);\n          }\n        }\n      }\n    }\n\n    /**\n     * Creates a unique key for the ir, method and accept headers\n     * to be used to mark the request's loading status.\n     */\n    #getLoadingKey(iri: string, method: string, accept?: string): string {\n      accept = accept ?? this.#headers.get('accept') ?? defaultAccept;\n\n      return `${method?.toLowerCase()}|${iri}|${accept.toLowerCase()}`;\n    }\n\n    public isLoading(iri: string): boolean {\n      const loadingKey = this.#getLoadingKey(iri, 'get');\n\n      return this.#loading.has(loadingKey);\n    }\n\n    /**\n     * Called on change to an entity. All listeners with dependencies in their\n     * selection for this entity have the latest selection result pushed to\n     * their listener functions.\n     */\n    #publish(iri: string, _contentType?: string): void {\n      const keys = this.#dependencies.get(iri);\n\n      if (keys == null) {\n        return;\n      }\n\n      for (const key of keys) {\n        const listenerDetails = this.#listeners.get(key);\n\n        if (listenerDetails == null) {\n          continue;\n        }\n\n        const details = getSelection<EntitySelectionResult | ValueSelectionResult | AlternativeSelectionResult>({\n          selector: listenerDetails.selector,\n          value: listenerDetails.value,\n          fragment: listenerDetails.fragment,\n          accept: listenerDetails.accept,\n          store: this,\n        } as Parameters<typeof getSelection>[0]);\n\n        const cleanup = this.#makeCleanupFn(key, details);\n\n        for (const dependency of details.dependencies) {\n          let depSet = this.#dependencies.get(dependency);\n\n          if (depSet == null) {\n            depSet = new Set([key]);\n\n            this.#dependencies.set(dependency, depSet);\n          } else {\n            depSet.add(key);\n          }\n        }\n\n        listenerDetails.cleanup = cleanup;\n        listenerDetails.listener(details);\n      }\n    }\n\n    #handleJSONLD({\n      iri,\n      res,\n      output,\n    }: {\n      iri: string;\n      res: Response;\n      output: JSONLDHandlerResult,\n    }): void {\n      const iris = [iri];\n\n      if (res.ok) {\n        this.#primary.set(iri, {\n          type: 'entity-success',\n          iri,\n          loading: false,\n          ok: true,\n          value: output.jsonld,\n        })\n      } else {\n        const reason = new HTTPFailure(res.status, res);\n\n        this.#primary.set(iri, {\n          type: 'entity-failure',\n          iri,\n          loading: false,\n          ok: false,\n          value: output.jsonld,\n          status: res.status,\n          reason,\n        });\n      }\n\n      for (const entity of flattenIRIObjects(output.jsonld)) {\n        if (iris.includes(entity['@id'])) {\n          continue;\n        }\n\n        this.#primary.set(entity['@id'], {\n          type: 'entity-success',\n          iri: entity['@id'],\n          loading: false,\n          ok: true,\n          value: entity,\n        });\n      }\n\n      for (const iri of iris) {\n        this.#publish(iri);\n      }\n    }\n\n    async handleResponse(\n      res: Response,\n      iri: string = res.url.toString(),\n    ) {\n      const contentType = res.headers.get('content-type')?.split?.(';')?.[0];\n\n      if (contentType == null) {\n        throw new Error('Content type not specified in response');\n      }\n\n      const handler = this.#handlers.get(contentType);\n\n      if (handler == null) {\n        throw new Error(`No handler configured for content type \"${contentType}\"`);\n      }\n\n      if (handler.integrationType === 'jsonld') {\n        const output = await handler.handler({\n          res,\n          store: this,\n        });\n\n        this.#handleJSONLD({\n          iri,\n          res,\n          output,\n        });\n      } else if (handler.integrationType === 'problem-details') {\n        throw new Error('Problem details response types not supported yet');\n      //} else if (handler.integrationType === 'html') {\n      //  const output = await handler.handler({\n      //    res,\n      //    store: this,\n      //  });\n      //  let integrations = this.#integrations.get(contentType);\n\n      //  if (integrations == null) {\n      //    integrations = new Map();\n\n      //    this.#integrations.set(contentType, integrations);\n      //  }\n\n      //  integrations.set(iri, new HTMLIntegration(handler, {\n      //    iri,\n      //    contentType,\n      //    html: output.html,\n      //    id: output.id,\n      //  }));\n      } else if (handler.integrationType === 'html-fragments') {\n        const output = await handler.handler({\n          res,\n          store: this,\n        });\n        let integrations = this.#integrations.get(contentType);\n\n        if (integrations == null) {\n          integrations = new Map();\n\n          this.#integrations.set(contentType, integrations);\n        }\n\n        integrations.set(iri, new HTMLFragmentsIntegration(handler, {\n          iri,\n          contentType,\n          output,\n        }));\n      }\n\n      if (handler.integrationType !== 'jsonld') {\n        this.#publish(iri, contentType);\n      }\n    }\n\n    async #callFetcher(iri: string, args: {\n      method?: string;\n      accept?: string;\n      body?: string;\n      contentType?: string;\n    } = {}): Promise<void> {\n      let headers: Headers;\n      const url = new URL(iri);\n      const method = args.method || 'get';\n      const accept = args.accept ?? this.#headers.get('accept') ?? defaultAccept;\n\n      url.hash = '';\n      const dispatchURL = url.toString();\n      const loadingKey = this.#getLoadingKey(dispatchURL, method, args.accept);\n\n\n      if (url.origin === this.#rootOrigin) {\n        headers = new Headers(this.#headers);\n      } else if (this.#origins.has(url.origin)) {\n        headers = new Headers(this.#origins.get(url.origin));\n      } else {\n        throw new Error('Unconfigured origin');\n      }\n\n      if (args.body != null && args.contentType != null) {\n        headers.set('content-type', args.contentType);\n      }\n\n      if (accept != null) {\n        headers.set('accept', accept);\n      } else if (headers.get('accept') == null) {\n        headers.set('accept', defaultAccept);\n      }\n\n      this.#loading.add(loadingKey);\n\n      mithrilRedraw();\n\n      // This promise wrapping is so SSR can hook in and await the promise.\n      const promise = new Promise<Response>((resolve) => {\n        (async () => {\n          let res: Response | null = null;\n\n          if (this.#fetcher != null) {\n            res = await this.#fetcher(dispatchURL, {\n              method,\n              headers,\n              body: args.body,\n            });\n          } else {\n            res = await fetch(dispatchURL, {\n              method,\n              headers,\n              body: args.body,\n            });\n          }\n\n          if (args.accept != null && this.#acceptMap.has(dispatchURL)) {\n            this.#acceptMap.get(dispatchURL)?.set(args.accept, res.headers.get('content-type') as string);\n          } else if (args.accept != null) {\n            this.#acceptMap.set(dispatchURL, new Map([[args.accept, res.headers.get('content-type') as string]]));\n          }\n\n          await this.handleResponse(res, iri);\n\n          this.#loading.delete(loadingKey);\n\n          mithrilRedraw();\n\n          resolve(res);\n        })();\n      });\n\n      if (this.#responseHook != null) {\n        this.#responseHook(promise);\n      }\n\n      await promise;\n    }\n\n    public subscribe({\n      key,\n      selector,\n      fragment,\n      accept,\n      value,\n      listener,\n    }: {\n      key: symbol;\n      selector: string;\n      fragment?: string;\n      accept?: string;\n      value?: JSONObject;\n      listener: SelectionListener;\n    }) {\n      const details = getSelection<ReadonlySelectionResult>({\n        selector,\n        fragment,\n        accept,\n        value,\n        store: this,\n      });\n      const cleanup = this.#makeCleanupFn(key, details);\n\n      for (const dependency of details.dependencies) {\n        const depSet = this.#dependencies.get(dependency);\n\n        if (depSet == null) {\n          this.#dependencies.set(dependency, new Set([key]));\n        } else {\n          depSet.add(key);\n        }\n      }\n\n      this.#listeners.set(key, {\n        key,\n        selector,\n        value,\n        fragment,\n        accept,\n        required: details.required,\n        dependencies: details.dependencies,\n        listener,\n        cleanup,\n      });\n\n      return details;\n    }\n\n    public unsubscribe(key: symbol) {\n      this.#listeners.get(key)?.cleanup();\n    }\n\n    public async fetch(iri: string, accept?: string): Promise<SuccessEntityState | FailureEntityState> {\n      await this.#callFetcher(iri, { accept });\n\n      return this.#primary.get(iri) as SuccessEntityState | FailureEntityState;\n    }\n\n    /**\n     * Submits an action. Like fetch this will overwrite\n     * entities in the store with any entities returned\n     * in the response.\n     *\n     * @param {string} iri                The iri of the request.\n     * @param {SubmitArgs} [args]         Arguments to pass to the fetch call.\n     * @param {string} [args.method]      The http submit method.\n     * @param {string} [args.contentType] The content type header value.\n     * @param {string} [args.body]        The body of the request.\n     */\n    public async submit(iri: string, args: SubmitArgs): Promise<SuccessEntityState | FailureEntityState> {\n      await this.#callFetcher(iri, {\n        ...args,\n        contentType: 'application/ld+json',\n      });\n\n      return this.entity(iri) as SuccessEntityState | FailureEntityState;\n    }\n\n    /**\n     * Creates an Octiron store from initial state written to the page's HTML.\n     *\n     * @param rootIRI       The root endpoint of the API.\n     * @param [disableLogs] Disables warning and error logs if the initial state\n     *                      is not present or corrupt.\n     * @param [vocab]       The JSON-ld @vocab to use for Octiron selectors.\n     * @param [aliases]     The JSON-ld aliases to use for Octiron selectors.\n     * @param [headers]     Headers to send when making requests to endpoints sharing\n     *                      origins with the `rootIRI`.\n     * @param [origins]     A map of origins and the headers to use when sending\n     *                      requests to them. Octiron will only send requests\n     *                      to endpoints which share origins with the `rootIRI`\n     *                      or are configured in the origins object. Aside\n     *                      from the accept header, which has a common default\n     *                      value, headers are not shared between origins.\n     */\n    static fromInitialState({\n      disableLogs,\n      rootIRI,\n      vocab,\n      aliases,\n      headers,\n      origins,\n      handlers = [],\n    }: {\n      disableLogs?: boolean;\n      rootIRI: string;\n      vocab?: string;\n      aliases?: Record<string, string>;\n      headers?: Record<string, string>;\n      origins?: Record<string, Record<string, string>>;\n      handlers?: Handler[];\n    }): Store {\n      performance.mark('octiron:from-initial-state:start')\n      const storeArgs = {\n        rootIRI,\n        vocab,\n        aliases,\n        handlers,\n        headers,\n        origins,\n      };\n\n      try {\n        const el = document.getElementById('oct-state') as HTMLScriptElement;\n\n        if (el == null) {\n          if (!disableLogs) {\n            console.warn('Failed to construct Octiron state from initial state');\n          }\n\n          return new Store(storeArgs);\n        }\n\n        const stateInfo = JSON.parse(el.innerText) as StateInfo;\n        const alternatives: AlternativesState = new Map();\n        const handlersMap: Record<string, Handler> = handlers.reduce((acc, handler) => ({\n          ...acc,\n          [handler.contentType]: handler,\n        }), {});\n\n        for (const [integrationType, entities] of Object.entries(stateInfo.alternatives)) {\n          for (const stateInfo of entities) {\n            const handler = handlersMap[stateInfo.contentType];\n            const cls = integrationClasses[integrationType as IntegrationType];\n\n            if (cls.type !== handler.integrationType) {\n              continue;\n            }\n\n            const state = cls.fromInitialState(handler, stateInfo);\n\n            if (state == null) {\n              continue;\n            }\n\n            let integrations = alternatives.get(state.contentType);\n\n            if (integrations == null) {\n              integrations = new Map();\n\n              alternatives.set(state.contentType, integrations);\n            }\n\n            integrations.set(state.iri, state);\n          }\n        }\n\n        const store = new Store({\n          ...storeArgs,\n          alternatives,\n          primary: stateInfo.primary,\n          acceptMap: stateInfo.acceptMap,\n        });\n        performance.mark('octiron:from-initial-state:end')\n        performance.measure('octiron:from-initial-state:duration', 'octiron:from-initial-state:start', 'octiron:from-initial-state:end');\n\n        return store;\n      } catch (err) {\n        if (!disableLogs) {\n          console.warn('Failed to construct Octiron state from initial state');\n          console.error(err)\n        }\n\n        const store = new Store(storeArgs);\n        performance.mark('octiron:from-initial-state:end')\n        performance.measure('octiron:from-initial-state:duration', 'octiron:from-initial-state:start', 'octiron:from-initial-state:end');\n        return store;\n      }\n    }\n\n    /**\n     * Writes the Octiron store's state to a string to be embedded\n     * near the end of a HTML document. Ideally this is placed before\n     * the closing of the document's body tag. Octiron uses ids prefixed\n     * with `oct-`, avoid using these ids to prevent id collision.\n     */\n    public toInitialState(): string {\n      let html = '';\n      const stateInfo: StateInfo = {\n        primary: Object.fromEntries(this.#primary),\n        alternatives: {},\n        acceptMap: {},\n      };\n\n      for (const [accept, map] of this.#acceptMap.entries()) {\n        stateInfo.acceptMap[accept] = Array.from(map.entries());\n      }\n\n      for (const alternative of this.#integrations.values()) {\n        for (const integration of alternative.values()) {\n          if (stateInfo.alternatives[integration.integrationType] == null) {\n            stateInfo.alternatives[integration.integrationType] = [\n              integration.getStateInfo(),\n            ];\n          } else {\n            stateInfo.alternatives[integration.integrationType].push(integration.getStateInfo());\n          }\n\n          html += integration.toInitialState();\n        }\n      }\n\n      html += `<script id=\"oct-state\" type=\"application/json\">${JSON.stringify(stateInfo)}</script>`\n\n      return html;\n    }\n\n}\n", "import { Store } from \"../store.ts\";\nimport type { TypeDef, TypeDefs } from \"../types/octiron.ts\";\n\n\nexport function makeTypeDefs<\n  const Type extends string = string,\n  // deno-lint-ignore no-explicit-any\n  const TypeDefList extends TypeDef<any, Type> = TypeDef<any, Type>,\n>(\n  store: Store,\n  ...typeDefs: Readonly<TypeDefList[]>\n): TypeDefs<Type, TypeDefList>;\n\nexport function makeTypeDefs<\n  const Type extends string = string,\n  // deno-lint-ignore no-explicit-any\n  const TypeDefList extends TypeDef<any, Type> = TypeDef<any, Type>,\n>(\n  ...typeDefs: Readonly<TypeDefList[]>\n): TypeDefs<Type, TypeDefList>;\n\n/**\n * @description\n * Aggregates a list of type defs into an easier to access\n * type def config object.\n *\n * @param typeDefs The type defs to aggregate.\n */\nexport function makeTypeDefs<\n  const Type extends string = string,\n  // deno-lint-ignore no-explicit-any\n  const TypeDefList extends TypeDef<any, Type> = TypeDef<any, Type>,\n>(\n  // deno-lint-ignore no-explicit-any\n  storeOrTypeDef: Store | TypeDef<any, Type>,\n  ...typeDefs: Readonly<TypeDefList[]>\n): TypeDefs<Type, TypeDefList> {\n  const config = {} as TypeDefs<Type, TypeDefList>;\n\n  if (storeOrTypeDef instanceof Store) {\n    for (const typeDef of typeDefs) {\n      // deno-lint-ignore no-explicit-any\n      (config as any)[storeOrTypeDef.expand(typeDef.type)] = typeDef;\n    }\n  } else {\n    // deno-lint-ignore no-explicit-any\n    (config[storeOrTypeDef.type] as any) = storeOrTypeDef;\n    for (const typeDef of typeDefs) {\n      // deno-lint-ignore no-explicit-any\n      (config as any)[typeDef.type] = typeDef;\n    }\n  }\n\n  return config;\n}\n", "\ntype ClassArg =\n  | undefined\n  | null\n  | string\n  | string[]\n  | Record<string, boolean | undefined>\n;\n\n/**\n * Merges arguments into a single css class string\n */\nexport function classes(...classArgs: ClassArg[]) {\n  const cls: string[] = [];\n\n  for (const classArg of classArgs) {\n    if (typeof classArg === 'undefined' || classArg === null) {\n      continue;\n    } else if (typeof classArg === 'string') {\n      cls.push(classArg);\n    } else if (Array.isArray(classArg)) {\n      for (const name of classArg) {\n        cls.push(name);\n      }\n    } else {\n      for (const [name, active] of Object.entries(classArg)) {\n        if (active) {\n          cls.push(name);\n        }\n      }\n    }\n  }\n\n  return cls.join(' ');\n}\n", "import type { JSONValue } from '../types/common.ts';\nimport type { TypeDef } from '../types/octiron.ts';\n\n/**\n * @description\n * Utility for creating a well typed typeDef.\n *\n * @param typeDef An object to property define the types for.\n */\nexport function makeTypeDef<\n  const Model extends JSONValue = JSONValue,\n  const Type extends string = string,\n>(\n  typeDef: TypeDef<Model, Type>,\n): TypeDef<Model, Type> {\n  return typeDef;\n}\n", "import type { Handler } from \"../types/store.ts\";\nimport { isJSONObject } from '../utils/isJSONObject.ts';\nimport jsonld from 'jsonld';\n\n\nexport const jsonLDHandler: Handler = {\n  integrationType: 'jsonld',\n  contentType: 'application/ld+json',\n  handler: async ({ res }) => {\n    const json = await res.json();\n\n    // cannot use json-ld ops on scalar types\n    if (!isJSONObject(json) && !Array.isArray(json)) {\n      throw new Error('JSON-LD Document should be an object');\n    }\n\n    const expanded = await jsonld.expand(json, {\n      documentLoader: async (url: string) => {\n        const res = await fetch(url, {\n          headers: {\n            'accept': 'application/ld+json',\n          }\n        });\n        const document = await res.json();\n\n        return {\n          documentUrl: url,\n          document,\n        };\n      }\n    });\n\n    const compacted = await jsonld.compact(expanded, {});\n\n    return {\n      jsonld: compacted,\n    };\n  },\n};\n", "import type { Handler } from \"../types/store.ts\";\nimport { longform } from '@longform/longform';\n\nexport const longformHandler: Handler = {\n  integrationType: 'html-fragments',\n  contentType: 'text/longform',\n  handler: async ({ res }) => {\n    return longform(await res.text());\n  },\n};\n", "import m from 'mithril';\nimport type { JSONArray, JSONObject, JSONPrimitive, JSONValue } from \"../types/common.ts\";\nimport { isJSONObject } from \"../utils/isJSONObject.ts\";\n\n\nexport type OctironJSONAttrs = {\n  // If given object keys will be rendered as clickable links to their own\n  // selection. This is used by `OctironExplorer` to allow navigation of the\n  // API serving the JSON-ld.\n  selector?: string;\n\n  // The JSON-ld value to render.\n  value: JSONValue;\n\n  location?: URL;\n};\n\nexport const OctironJSON: m.ClosureComponent<OctironJSONAttrs> = () => {\n  function renderIRI(iri: string) {\n    return m('code', [\n      m('span.oct-json-quote', '\"'),\n      m('a.oct-json-iri', {\n        href: iri,\n      }, iri),\n      m('span.oct-json-quote', '\"'),\n    ]);\n  }\n\n  function renderPrimitive(value: JSONPrimitive) {\n    const className = typeof value === 'boolean'\n      ? 'oct-json-boolean'\n      : typeof value === 'number'\n      ? 'oct-json-number'\n      : 'oct-json-string';\n\n    let presentValue: m.Children;\n\n    if (typeof value === 'boolean' && value) {\n      presentValue = 'true';\n    } else if (typeof value === 'boolean') {\n      presentValue === 'false';\n    } else if (typeof value === 'string') {\n      presentValue = [\n        m('span.oct-json-quote', '\"'),\n        value,\n        m('span.oct-json-quote', '\"'),\n      ];\n    } else {\n      presentValue = value;\n    }\n\n    return m('code', { className }, presentValue);\n  }\n\n  function renderArray(list: JSONArray, url?: URL, selector: string = '') {\n    const children: m.Children[] = [];\n\n    for (let index = 0; index < list.length; index++) {\n      const value = list[index];\n      children.push(\n        m(\n          'li.oct-json-arr-item',\n          maybeRenderDetails(null, value, url, selector),\n        ),\n      );\n    }\n\n    return m('ul.oct-json-arr', children);\n  }\n\n  const terminalTypes = ['@id', '@type', '@context'];\n  function renderObject(value: JSONObject, url?: URL, selector: string = '') {\n    const items: m.Children[] = [];\n    const list = Object.entries(value).toSorted();\n\n    for (let index = 0; index < list.length; index++) {\n      const [term, value] = list[index];\n      let children: m.Children;\n      const summary = [\n        m('span.oct-json-quote', '\"'),\n        m('span.oct-json-obj-key', term),\n        m('span.oct-json-quote', '\"'),\n        m('span.oct-json-obj-colon', ': '),\n      ];\n\n      if (term === '@id') {\n        children = [m('code', summary), renderIRI(value as string)];\n      } else if (url == null || terminalTypes.includes(term)) {\n        children = maybeRenderDetails(summary, value);\n      } else if (term.startsWith('@')) {\n        children = maybeRenderDetails(summary, value, url, selector);\n      } else {\n        const currentSelector = `${selector} ${term}`;\n        const currentURL = new URL(url);\n\n        currentURL.searchParams.set('selector', currentSelector);\n\n        const summary = [\n          m('span.oct-json-quote', '\"'),\n          m(\n            'span.oct-json-obj-key',\n            m(\n              'a',\n              { href: currentURL },\n              term,\n            ),\n          ),\n          m('span.oct-json-quote', '\"'),\n          m('span.oct-json-obj-colon', ': '),\n        ];\n        children = maybeRenderDetails(summary, value, url, currentSelector);\n      }\n\n      items.push(m('li.oct-json-obj-item', children));\n    }\n\n    return m('ul.oct-json-obj', items);\n  }\n\n  function maybeRenderDetails(\n    summary: m.Children,\n    value: JSONValue,\n    url?: URL,\n    selector: string = '',\n  ) {\n    if (isJSONObject(value)) {\n      return [\n        m(\n          'details.oct-json-details',\n          { open: true },\n          m(\n            'summary.oct-json-details-sum',\n            m('code', summary, m('span.oct-json-obj-open', '{')),\n          ),\n          renderValue(value, url, selector),\n        ),\n        m('code.oct-json-obj-close', '}'),\n      ];\n    } else if (Array.isArray(value)) {\n      return [\n        m(\n          'details.oct-json-details',\n          { open: true },\n          m(\n            'summary.oct-json-details-sum',\n            m('code', summary, m('span.oct-json-obj-open', '[')),\n          ),\n          renderValue(value, url, selector),\n        ),\n        m('code.oct-json-obj-close', ']'),\n      ];\n    }\n\n    return [m('code', summary), renderValue(value, url, selector)];\n  }\n\n  function renderValue(value: JSONValue, url?: URL, selector: string = '') {\n    if (isJSONObject(value)) {\n      return renderObject(value, url, selector);\n    } else if (Array.isArray(value)) {\n      return renderArray(value, url, selector);\n    }\n\n    return renderPrimitive(value);\n  }\n\n  return {\n    view: ({ attrs: { value, selector, location } }) => {\n      const url = location != null ? new URL(location) : undefined;\n\n      return m('.oct-json', [\n        maybeRenderDetails(\n          null,\n          value,\n          url,\n          typeof selector === 'string' ? selector.trim() : undefined,\n        ),\n      ]);\n    },\n  };\n};\n", "import m from 'mithril';\nimport * as jsonld from 'jsonld';\nimport { mithrilRedraw } from \"../utils/mithrilRedraw.ts\";\nimport type { JSONObject } from \"../types/common.ts\";\nimport type { Octiron } from \"../types/octiron.ts\";\nimport { OctironJSON } from \"./OctironJSON.ts\";\nimport { flattenIRIObjects } from \"../utils/flattenIRIObjects.ts\";\n\nexport type OctironDebugPresentationStyle =\n  | 'value'\n  | 'action-value'\n  | 'component'\n;\n\nexport type OctironDebugAttrs = {\n  o: Octiron;\n  selector?: string;\n  location?: URL;\n  initialPresentationStyle?: OctironDebugPresentationStyle;\n  availableControls?: OctironDebugPresentationStyle[];\n};\n\nexport const OctironDebug: m.ClosureComponent<OctironDebugAttrs> = ({\n  attrs,\n}) => {\n  let currentAttrs = attrs;\n  let value = attrs.o.value as JSONObject;\n  let rendered: m.Children;\n  let presentationStyle: OctironDebugPresentationStyle = attrs.initialPresentationStyle ?? 'value';\n\n  function onRender(redraw: boolean = true) {\n    const { o } = currentAttrs;\n    if (presentationStyle === 'value') {\n      rendered = m(OctironJSON, {\n        value,\n        selector: currentAttrs.selector,\n        location: currentAttrs.location,\n      });\n    } else if (\n      presentationStyle === 'action-value' && (\n        o.octironType === 'action' ||\n        o.octironType === 'action-selection'\n      )\n    ) {\n      rendered = m(OctironJSON, { value: o.actionValue.value, selector: currentAttrs.selector, location: currentAttrs.location })\n    }\n    if (redraw) {\n      mithrilRedraw();\n    }\n  }\n\n  function onSetValue(e: MouseEvent & { redraw: boolean }) {\n    e.redraw = false;\n    presentationStyle = 'value';\n\n    onRender();\n  }\n\n  function onSetActionValue(e: MouseEvent & { redraw: boolean }) {\n    e.redraw = false;\n    presentationStyle = 'action-value';\n\n    onRender();\n  }\n\n  function onSetComponent(e: MouseEvent & { redraw: boolean }) {\n    e.redraw = false;\n    presentationStyle = 'component';\n\n    onRender();\n  }\n\n  return {\n    oninit: ({ attrs }) => {\n      currentAttrs = attrs;\n\n      onRender(false);\n    },\n    onbeforeupdate: ({ attrs }) => {\n      if (attrs.o.value !== value) {\n        value = attrs.o.value as JSONObject;\n\n        onRender(true);\n      }\n    },\n    view: ({ attrs: { o, availableControls } }) => {\n      let children: m.Children;\n      let actionValueAction: m.Children;\n      const controls: m.Children = [];\n\n      if (presentationStyle === 'component') {\n        children = m('.oct-debug-body', o.default());\n      } else {\n        children = m('.oct-debug-body', rendered);\n      }\n\n      if (o.octironType === 'action' || o.octironType === 'action-selection') {\n        actionValueAction = m('button.oct-button', { type: 'button', onclick: onSetActionValue }, 'Action value');\n      }\n\n      if (availableControls == null || availableControls.includes('value')) {\n        controls.push(\n            m('button.oct-button', { type: 'button', onclick: onSetValue }, 'Value'),\n        );\n      } else if (\n        actionValueAction != null && (\n          availableControls == null ||\n          availableControls.includes('action-value')\n      )) {\n        controls.push(actionValueAction);\n      } else if (availableControls == null || availableControls.includes('component')) {\n        controls.push(\n            m('button.oct-button', { type: 'button', onclick: onSetComponent }, 'Component'),\n        );\n      } else if (availableControls == null || availableControls.includes('log')) {\n        controls.push(\n            m('button.oct-button', { type: 'button', onclick: () => console.debug(o) }, 'Log'),\n        );\n      }\n\n      return m(\n        'aside.oct-debug',\n        m(\n          '.oct-debug-controls',\n          m(\n            '.oct-button-group',\n            ...controls,\n          ),\n        ),\n        children,\n      );\n    },\n  };\n};\n", "import m from 'mithril';\nimport type { AnyComponent, Octiron } from \"../types/octiron.ts\";\nimport { OctironDebug } from \"./OctironDebug.ts\";\n\n\nexport type OctironExplorerAttrs = {\n  autofocus?: boolean;\n  selector?: string;\n  presentationStyle?: 'debug' | 'components';\n  childControls?: boolean;\n  onChange?: (\n    selector: string,\n    presentationStyle: 'debug' | 'components',\n  ) => void;\n  location?: URL;\n  o: Octiron;\n};\n\nexport const OctironExplorer: m.ClosureComponent<OctironExplorerAttrs> = ({\n  attrs,\n}) => {\n  let value: string = attrs.selector || '';\n  let previousSelector: string = value;\n  let selector: string = value;\n  let presentationStyle: 'debug' | 'components' = attrs.presentationStyle || 'debug';\n  let onChange = attrs.onChange;\n  const fallbackComponent: AnyComponent = {\n    view: ({ attrs: { o } }) => {\n      return m(OctironDebug, { o, location: attrs.location });\n    },\n  };\n\n  function onSearch(evt: KeyboardEvent) {\n    value = (evt.target as HTMLInputElement).value;\n  }\n\n  function onEnter(evt: KeyboardEvent) {\n    if (evt.key === 'Enter') {\n      onApply();\n    }\n  }\n\n  function onApply() {\n    selector = value;\n\n    if (typeof onChange === 'function') {\n      onChange(selector, presentationStyle);\n    }\n  }\n\n  function onSetDebug(evt: Event) {\n    evt.preventDefault();\n    presentationStyle = 'debug';\n\n    if (typeof onChange === 'function') {\n      onChange(selector, presentationStyle);\n    }\n  }\n\n  function onSetComponents(evt: Event) {\n    evt.preventDefault();\n    presentationStyle = 'components';\n\n    if (typeof onChange === 'function') {\n      onChange(selector, presentationStyle);\n    }\n  }\n\n  return {\n    oninit: ({ attrs }) => {\n      onChange = attrs.onChange;\n    },\n    onbeforeupdate: ({ attrs }) => {\n      selector = attrs.selector ?? '';\n\n      if (selector !== previousSelector) {\n        value = previousSelector = selector;\n      }\n\n      onChange = attrs.onChange;\n    },\n    view: ({ attrs: { autofocus, o } }) => {\n      let children: m.Children;\n      let upURL: URL;\n      let debugURL: URL;\n      let componentsURL: URL;\n\n      if (selector.length !== 0 && presentationStyle === 'debug') {\n        children = o.root(selector, (o) => m(OctironDebug, {\n          o,\n          selector,\n          location: attrs.location,\n          initialPresentaionStyle: attrs.presentationStyle,\n          availableControls: !!attrs.childControls == false ? undefined : [],\n        }));\n      } else if (selector.length !== 0) {\n        children = o.root(\n          selector,\n          (o) =>\n            m('div', o.default({ fallbackComponent, attrs: { selector } })),\n        );\n      } else if (presentationStyle === 'debug') {\n        children = o.root((o) => m(OctironDebug, {\n          o, selector,\n          location: attrs.location,\n          initialPresentaionStyle: attrs.presentationStyle,\n          availableControls: !!attrs.childControls ? undefined : [],\n        }));\n      } else {\n        children = o.root((o) =>\n          m('div', o.default({ fallbackComponent, attrs: { selector } }))\n        );\n      }\n\n      if (attrs.location != null && selector.length !== 0) {\n        const upSelector =\n          attrs.selector.trim().includes(' ')\n            ? attrs.selector.replace(/\\s+([^\\s]+)$/, '')\n            : '';\n        \n        upURL = new URL(attrs.location);\n        if (upSelector != null) {\n          upURL.searchParams.set('selector', upSelector);\n        } else {\n          upURL.searchParams.delete('selector');\n        }\n      }\n\n      if (attrs.location != null) {\n        debugURL = new URL(attrs.location);\n        componentsURL = new URL(attrs.location);\n\n        debugURL.searchParams.set('presentationStyle', 'debug');\n        componentsURL.searchParams.set('presentationStyle', 'components');\n      }\n\n      return m('.oct-explorer', m('.oct-explorer-controls',\n          m('form.oct-form-group', {\n            action: attrs.location?.toString?.(),\n            onsubmit: (evt: Event) => {\n              evt.preventDefault();\n\n              onApply();\n            },\n          }, [\n            upURL != null\n              ? m('a.oct-button', { href: upURL.toString() }, 'Up')\n              : m('button.oct-button', { type: 'button', disabled: true }, 'Up'),\n            m('input', {\n              name: 'selector',\n              value,\n              autofocus,\n              oninput: onSearch,\n              onkeypress: onEnter,\n            }),\n            m(\n              'button.oct-button',\n              {\n                type: 'submit',\n                disabled: selector === value && typeof window !== 'undefined',\n              },\n              'Apply',\n            ),\n          ]),\n\n          m('.oct-button-group',\n            presentationStyle === 'debug' || debugURL == null\n              ? m('button.oct-button', {\n                  type: 'button',\n                  disabled: typeof window === 'undefined',\n                  onclick: onSetDebug,\n                }, 'Debug')\n              : m('a.oct-button', {\n                  href: debugURL.toString(),\n                  onclick: onSetDebug,\n                }, 'Debug'),\n\n            presentationStyle === 'components' || componentsURL == null\n              ? m('button.oct-button', {\n                  type: 'button',\n                  disabled: typeof window === 'undefined',\n                  onclick: onSetComponents,\n                }, 'Components')\n              : m('a.oct-button', {\n                  href: componentsURL.toString(),\n                  onclick: onSetComponents,\n                }, 'Components'),\n          ),\n        ),\n        m('pre.oct-explorer-body', children),\n      ); },\n  };\n};\n", "import m from 'mithril';\nimport type { OctironAction } from \"../types/octiron.ts\";\n\nexport type OctironFormAttrs = {\n  o: OctironAction;\n  id?: string;\n  class?: string;\n};\n\nexport const OctironForm: m.ClosureComponent<OctironFormAttrs> = (vnode) => {\n  const o = vnode.attrs.o;\n  const method = o.method?.toUpperCase() as 'GET' || 'POST' || 'GET';\n  const enctypes = {\n    GET: 'application/x-www-form-urlencoded',\n    POST: 'multipart/form-data',\n  } as const;\n\n  return {\n    view: ({ attrs: { o, ...attrs }, children }) => {\n      return m(\n        'form.oct-form',\n        {\n          ...attrs,\n          method,\n          enctype: enctypes[method || 'GET'],\n          action: o.url,\n          onsubmit: (evt: SubmitEvent) => {\n            evt.preventDefault();\n\n            o.submit();\n          },\n        },\n        children,\n      );\n    },\n  };\n};\n", "import m from 'mithril';\nimport type { OctironAction } from \"../types/octiron.ts\";\nimport { classes } from \"../utils/classes.ts\";\n\nexport type OctironSubmitButtonAttrs = {\n  o: OctironAction;\n  id?: string;\n  class?: string;\n};\n\nexport const OctironSubmitButton: m.ClosureComponent<\n  OctironSubmitButtonAttrs\n> = () => {\n  return {\n    view: ({ attrs, children }) => {\n      return m(\n        'button.oct-button.oct-submit-button',\n        {\n          id: attrs.id,\n          type: 'submit',\n          class: classes(attrs.class),\n        },\n        children,\n      );\n    },\n  };\n};\n", "import type { OctironRoot, TypeDef } from \"./types/octiron.ts\";\nimport { rootFactory } from \"./factories/rootFactory.ts\";\nimport { makeTypeDefs } from \"./utils/makeTypeDefs.ts\";\nimport { Store } from \"./store.ts\";\n\nexport * from './types/common.ts';\nexport * from './types/store.ts';\nexport * from './types/octiron.ts';\nexport * from './store.ts';\nexport * from './utils/classes.ts';\nexport * from './utils/makeTypeDef.ts';\nexport * from './utils/makeTypeDefs.ts';\nexport * from './handlers/jsonLDHandler.ts';\nexport * from './handlers/longformHandler.ts';\nexport * from './components/OctironJSON.ts';\nexport * from './components/OctironDebug.ts';\nexport * from './components/OctironExplorer.ts';\nexport * from './components/OctironForm.ts';\nexport * from './components/OctironSubmitButton.ts';\n\n/**\n * Creates a root octiron instance.\n */\nexport default function octiron({\n  typeDefs,\n  ...storeArgs\n}: ConstructorParameters<typeof Store>[0] & {\n  // deno-lint-ignore no-explicit-any\n  typeDefs?: TypeDef<any>[];\n}): OctironRoot {\n  const store = new Store(storeArgs);\n  const config = typeDefs != null\n    ? makeTypeDefs(store, ...typeDefs)\n    : {};\n\n  return rootFactory({\n    store,\n    typeDefs: config,\n  });\n}\n\noctiron.fromInitialState = ({\n  typeDefs,\n  ...storeArgs\n}: Parameters<typeof Store.fromInitialState>[0] & {\n  // deno-lint-ignore no-explicit-any\n  typeDefs?: TypeDef<any>[];\n}) => {\n  const store = Store.fromInitialState({\n    ...storeArgs,\n  });\n  const config = typeDefs != null\n    ? makeTypeDefs(store, ...typeDefs)\n    : {};\n\n  return rootFactory({\n    store,\n    typeDefs: config,\n  });\n}\n"],
  "mappings": "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",
  "names": ["require_uri_templates", "__commonJSMin", "exports", "module", "global", "factory", "uriTemplateGlobalModifiers", "uriTemplateSuffices", "urlEscapedChars", "notReallyPercentEncode", "string", "doubleEncoded", "isPercentEncoded", "uriTemplateSubstitution", "spec", "modifier", "separator", "prefix", "shouldEscape", "showVariables", "trimEmptyString", "varNames", "varList", "varSpecs", "varSpecMap", "i", "varName", "truncate", "parts", "suffices", "varSpec", "subFunction", "valueFunction", "result", "startIndex", "value", "j", "first", "key", "guessFunction", "stringValue", "resultObj", "strict", "arrayValue", "hasEquals", "innerArrayValue", "objectValue", "innerValue", "innerVarName", "k", "specIndexMap", "firstStarred", "lastStarred", "UriTemplate", "template", "textParts", "prefixes", "substitutions", "unSubstitutions", "part", "remainder", "funcs", "substitution", "substituted", "options", "nextPart", "offset", "endPart", "nextPartPos", "obj", "uri", "m", "isJSONObject", "value", "unravelArgs", "arg1", "arg2", "arg3", "selector", "args", "view", "o", "m", "selectionFactory", "args", "parentArgs", "rendererArgs", "factoryArgs", "childArgs", "octironFactory", "m", "isBrowserRender", "mithrilRedraw", "isBrowserRender", "m", "preKey", "postKey", "shouldReselect", "next", "prev", "SelectionRenderer", "vnode", "key", "deferring", "currentAttrs", "details", "instances", "createInstances", "hasChanges", "initialDetails", "nextKeys", "prevKeys", "mithrilRedraw", "index", "selectionResult", "rendererArgs", "octiron", "selectionFactory", "fetchRequired", "required", "__async", "isBrowserRender", "promises", "iri", "listener", "subscribe", "entity", "selector", "value", "store", "isJSONObject", "attrs", "reselect", "view", "pre", "sep", "post", "start", "end", "predicate", "loading", "fallback", "children", "list", "instance", "m", "m", "getComponent", "style", "propType", "type", "firstPickComponent", "typeDefs", "fallbackComponent", "_a", "_b", "_c", "item", "isTypeObject", "value", "isJSONObject", "item", "getDataType", "value", "isTypeObject", "selectComponentFromArgs", "style", "parentArgs", "rendererArgs", "args", "factoryArgs", "_a", "_b", "_c", "_d", "attrs", "firstPickComponent", "fallbackComponent", "component", "getComponent", "getDataType", "PresentRenderer", "args", "factoryArgs", "parentArgs", "rendererArgs", "attrs", "component", "selectComponentFromArgs", "o", "children", "m", "isIterable", "value", "isJSONObject", "getIterableValue", "value", "m", "replace", "source", "find", "repl", "res", "rem", "beg", "end", "decodeFragmentSegments", "segments", "i", "len", "encodeFragmentSegments", "decodePointerSegments", "encodePointerSegments", "decodePointer", "ptr", "encodePointer", "path", "decodeUriFragmentIdentifier", "encodeUriFragmentIdentifier", "InvalidRelativePointerError", "decodeRelativePointer", "first", "toArrayIndexReference", "arr", "idx", "cursor", "compilePointerDereference", "body", "it", "_", "setValueAtPath", "target", "val", "force", "step", "p", "n", "unsetValueAtPath", "looksLikeFragment", "pickDecoder", "decodePtrInit", "isObject", "value", "shouldDescend", "obj", "JsonReference", "descendingVisit", "visitor", "encoder", "distinctObjects", "q", "JsonPointer", "j", "keys", "$ptr", "$frg", "$get", "_JsonPointer", "pointer", "fragmentId", "v", "decoded", "r", "name", "other", "parent", "$pointer", "candidate", "ref", "ActionStateRenderer", "submitResult", "o", "setInstance", "attrs", "rendererArgs", "selectionFactory", "_a", "_b", "_c", "_d", "type", "selector", "args", "view", "__objRest", "children", "shouldRender", "import_uri_templates", "getSubmitDetails", "payload", "action", "urlTemplate", "body", "method", "contentType", "encodingType", "target", "item", "isJSONObject", "fillArgs", "submitBody", "type", "value", "isTypeObject", "valueName", "propType", "url", "uriTemplates", "m", "m", "EditRenderer", "args", "factoryArgs", "parentArgs", "rendererArgs", "attrs", "component", "selectComponentFromArgs", "o", "children", "m", "expandValue", "store", "value", "expanded", "key", "item", "actionSelectionFactory", "args", "parentArgs", "rendererArgs", "_a", "_b", "_c", "factoryArgs", "childArgs", "self", "octironFactory", "pointer", "value", "interceptor", "prev", "isJSONObject", "next", "ptr", "JsonPointer", "arg1", "__async", "mithrilRedraw", "arg2", "arg3", "selector", "view", "unravelArgs", "m", "ActionSelectionRenderer", "EditRenderer", "_args", "parentValue", "isIterable", "arrValue", "getIterableValue", "termOrType", "nextValue", "type", "lastValue", "expandValue", "escapeJSONPointerParts", "parts", "part", "isIRIObject", "value", "isJSONObject", "isMetadataObject", "value", "keys", "term", "isValueObject", "value", "selectorRe", "parseSelectorString", "selector", "store", "_a", "_b", "match", "selectors", "subject", "filter", "httpRe", "scmCtxRe", "scmTypeRe", "resolvePropertyValueSpecification", "spec", "store", "_a", "pvs", "scmAlias", "scmVocab", "key", "value", "term", "type", "result", "CircularSelectionError", "transformProcessedDetails", "processing", "index", "element", "getSelection", "selectorStr", "value", "fragment", "accept", "actionValue", "defaultValue", "store", "details", "subject", "filter", "selector", "parseSelectorString", "iri", "iriFragment", "selectEntity", "traverseSelector", "makePointer", "pointer", "addition", "escapeJSONPointerParts", "passesFilter", "isTraversable", "resolveValue", "keySource", "propType", "spec", "isJSONObject", "item", "isTypeObject", "isIterable", "pvs", "resolvePropertyValueSpecification", "isValueObject", "list", "getIterableValue", "isIRIObject", "isMetadataObject", "selectTypedValue", "next", "rest", "traversedActionValue", "handledIRIs", "cache", "ActionSelectionRenderer", "vnode", "currentAttrs", "details", "instances", "createInstances", "hasChanges", "parentArgs", "selectionArgs", "nextKeys", "index", "selectionResult", "rendererArgs", "octiron", "update", "value", "actionValueRendererArgs", "actionValue", "selectionFactory", "actionSelection", "actionSelectionFactory", "prevKeys", "key", "mithrilRedraw", "updateSelection", "selector", "store", "isJSONObject", "getSelection", "attrs", "instance", "view", "args", "pre", "sep", "post", "fallback", "list", "children", "actionFactory", "args", "parentArgs", "rendererArgs", "factoryArgs", "payload", "submitResult", "isJSONObject", "expandValue", "submit", "__async", "url", "method", "body", "contentType", "encodingType", "getSubmitDetails", "self", "mithrilRedraw", "err", "update", "value", "prev", "next", "__spreadValues", "childArgs", "pointer", "_args", "ptr", "JsonPointer", "octironFactory", "arg1", "arg2", "arg3", "selector", "view", "unravelArgs", "m", "ActionSelectionRenderer", "termOrType", "type", "prevValue", "nextValue", "__spreadProps", "makeInitialStateMethod", "not", "children", "ActionStateRenderer", "makeActionStateMethod", "submitDetails", "PerformRenderer", "attrs", "key", "currentAttrs", "details", "instances", "createInstances", "hasChanges", "args", "parentArgs", "nextKeys", "index", "selectionResult", "next", "prev", "actionValueRendererArgs", "actionValue", "selectionFactory", "rendererArgs", "action", "actionFactory", "prevKeys", "mithrilRedraw", "fetchRequired", "required", "__async", "promises", "iri", "listener", "subscribe", "selector", "result", "isIRIObject", "instance", "view", "pre", "sep", "post", "fallback", "list", "children", "octiron", "TypeKeys", "octironFactory", "octironType", "factoryArgs", "parentArgs", "rendererArgs", "childArgs", "_a", "_b", "_c", "_d", "_e", "_f", "typeKey", "name", "isIRIObject", "self", "predicate", "children", "typeOrTerm", "getDataType", "termOrType", "isJSONObject", "type", "value", "isIterable", "getIterableValue", "arg1", "arg2", "arg3", "selector", "args", "view", "unravelArgs", "m", "SelectionRenderer", "rootChildArgs", "__spreadProps", "__spreadValues", "childSelector", "PresentRenderer", "o", "PerformRenderer", "updateArgs", "currentArgs", "key", "rootFactory", "parentArgs", "octironFactory", "m", "processTemplate", "fragmentToHTML", "fragment", "html", "i", "HTMLFragmentsIntegrationComponent", "setDomServer", "attrs", "_a", "id", "rest", "template", "args", "processTemplate", "err", "setDomClient", "ref", "isBrowserRender", "m", "_rootRendered", "_rendered", "_iri", "_contentType", "_handler", "_output", "_HTMLFragmentsIntegration_instances", "fragmentHTML_fn", "_HTMLFragmentsIntegration", "handler", "iri", "contentType", "output", "__privateAdd", "__publicField", "__privateSet", "__privateGet", "_b", "_c", "__privateMethod", "o", "texts", "fragments", "entries", "rendered", "selector", "templates", "element", "textEntries", "dom", "elements", "HTMLFragmentsIntegration", "_status", "_res", "HTTPFailure", "status", "res", "__privateAdd", "__privateSet", "__privateGet", "arg", "flattenIRIObjects", "value", "agg", "item", "isJSONObject", "isMetadataObject", "isIRIObject", "isValueObject", "isIterable", "getIterableValue", "term", "defaultAccept", "integrationClasses", "HTMLFragmentsIntegration", "getJSONLdValues", "vocab", "aliases", "aliasMap", "context", "key", "value", "getInternalHeaderValues", "headers", "origins", "internalHeaders", "internalOrigins", "origin", "_rootIRI", "_rootOrigin", "_headers", "_origins", "_vocab", "_aliases", "_primary", "_loading", "_integrations", "_handlers", "_keys", "_context", "_termExpansions", "_fetcher", "_responseHook", "_dependencies", "_listeners", "_acceptMap", "_Store_instances", "makeCleanupFn_fn", "getLoadingKey_fn", "publish_fn", "handleJSONLD_fn", "callFetcher_fn", "_Store", "args", "__privateAdd", "_a", "_b", "__privateSet", "__privateWrapper", "handler", "__privateGet", "accept", "entries", "iri", "_c", "_d", "contentType", "integration", "fragment", "entity", "termOrType", "sym", "cached", "expanded", "reg", "selector", "getSelection", "loadingKey", "__privateMethod", "_0", "__async", "res", "output", "integrations", "listener", "details", "cleanup", "dependency", "depSet", "__spreadProps", "__spreadValues", "disableLogs", "rootIRI", "handlers", "storeArgs", "el", "stateInfo", "alternatives", "handlersMap", "acc", "integrationType", "entities", "cls", "state", "store", "err", "html", "map", "alternative", "isBrowserRender", "method", "_contentType", "keys", "listenerDetails", "iris", "reason", "HTTPFailure", "flattenIRIObjects", "url", "dispatchURL", "mithrilRedraw", "promise", "resolve", "Store", "makeTypeDefs", "storeOrTypeDef", "typeDefs", "config", "Store", "typeDef", "classes", "classArgs", "cls", "classArg", "name", "active", "makeTypeDef", "typeDef", "jsonld", "jsonLDHandler", "_0", "__async", "res", "json", "isJSONObject", "expanded", "jsonld", "url", "document", "longform", "longformHandler", "_0", "__async", "res", "longform", "m", "OctironJSON", "renderIRI", "iri", "m", "renderPrimitive", "value", "className", "presentValue", "renderArray", "list", "url", "selector", "children", "index", "maybeRenderDetails", "terminalTypes", "renderObject", "items", "term", "summary", "currentSelector", "currentURL", "isJSONObject", "renderValue", "location", "m", "OctironDebug", "attrs", "_a", "currentAttrs", "value", "rendered", "presentationStyle", "onRender", "redraw", "o", "m", "OctironJSON", "mithrilRedraw", "onSetValue", "e", "onSetActionValue", "onSetComponent", "availableControls", "children", "actionValueAction", "controls", "m", "OctironExplorer", "attrs", "value", "previousSelector", "selector", "presentationStyle", "onChange", "fallbackComponent", "o", "m", "OctironDebug", "onSearch", "evt", "onEnter", "onApply", "onSetDebug", "onSetComponents", "_a", "autofocus", "_b", "children", "upURL", "debugURL", "componentsURL", "upSelector", "m", "OctironForm", "vnode", "_a", "method", "enctypes", "_b", "_c", "_d", "_e", "o", "attrs", "__objRest", "children", "m", "__spreadProps", "__spreadValues", "evt", "m", "OctironSubmitButton", "attrs", "children", "m", "classes", "octiron", "_a", "_b", "typeDefs", "storeArgs", "__objRest", "store", "Store", "config", "makeTypeDefs", "rootFactory", "__spreadValues"]
}
